import{createApp}from"/src/helpers/vue.esm-browser.prod.js";import{loadGameplayModules}from"/src/constants/gameplay.js";import{version}from"/src/constants/version.js";async function loadHelpers(){const{SaveData:t,GetData:e,RemoveData:a,ClearStore:s}=await import("/src/helpers/db-helper.min.js"),{GetUniqueWords:i,GetJustWords:r}=await import("/src/helpers/word-helper.min.js");return{SaveData:t,GetData:e,RemoveData:a,ClearStore:s,GetUniqueWords:i,GetJustWords:r}}async function LoadAllModules(){const t=await loadGameplayModules();return{...await loadHelpers(version),...t}}LoadAllModules().then((t=>{const e=createApp({data:()=>({appDataVersion:version,appDataGuessingFirstRunItems:t.firstRunGuessingMessages,appDataCreatorFirstRunItems:t.firstRunCreatingMessages,appDataReviewingFirstRunItems:t.firstRunReviewingMessages,appDataActionButtonTexts:{send:"Send",guess:"Guess",reply:"Reply",copy:"Copy",respond:"Respond",create:"Create",share:"Share",quit:"Give up"},appDataCards:[],appDataCardsParked:[],appDataLanguages:t.allLanguages,appDataConfirmationObject:{message:"Did they have the right answer?",target:"correct"},appDataDraggedCard:new t.CardObject({}),appDataDraggedCardStartedInParkingLot:!1,appDataEmptyCard:new t.CardObject({id:"ghost"}),appDataGameCatchphrase:"A Puzzle Game of Words and Wits!",appDataGameName:"Facets",appDataGhostX:0,appDataGhostY:0,appDataParkingScrollLeft:0,appDataGlobalCreatedGames:[],appDataDailyGames:[],appDataUserDailyGamesStarted:[],appDataHints:[],appDataMessage:"",appDataParkingInputValue:"",appDataPlayerCurrent:new t.PlayerObject({}),appDataPlayerCreator:new t.PlayerObject({}),appDataPlayerSender:new t.PlayerObject({}),appDataPlayerStats:{g1:0,g2:0,beyond2:0,quit:0,total:0},appDataShareURL:"",appDataTimeoutCardRotation:null,appDataTimeoutTrayRotation:null,appDataTimeoutNotification:null,appDataTransitionLong:0,appDataTransitionShort:0,appDataWordSets:[...t.wordSets],appCurrentDailyGameKey:-1,appDailyIsFreshToday:!0,appDataNumberOfNewDailies:1,appDataDailyGamesStats:[],appDataInc:0,appDataAIResult:null,appDataHues:[215,265,315,355,25,140,184],appStateForceAutoCheck:!1,debounceTimeout:null,appStateAutoAdvanceTips:!0,appStateIsDragging:!1,appStateIsGettingTinyURL:!1,appStateIsGettingAnonymousGames:!1,appStateIsGettingDailyGames:!1,appStateIsGettingDailyGameStats:!1,appStateIsGettingUserStats:!1,appStateSolving:!1,appStateIsGuessing:!1,appStateIsModalShowing:!1,appStateIsNewVersionAvailable:!1,appStatePageHasLoaded:!1,appStateUserHasCreatedAGame:!1,appStateShowCatChooser:!1,appStateShowConfirmation:!1,appStateShowGlobalCreated:!1,appStateShowDailyGames:!1,appStateDailyCongrats:!1,appStateShowInfo:!1,appStateShowIntro:!1,appStateShowOOBE:!1,appStatePointerLocation:{left:-4e4,top:-4e4},appStatePointerArrowLocation:{x:-4e4,y:-4e4,arrowRotate:0},appStateFirstRunGuessingIndex:-1,appStateFirstRunCreatingIndex:-1,appStateFirstRunReviewingIndex:-1,appStateShowStats:!1,appStateShowSettings:!1,appStateShowTutorial:!1,appStateTrayIsRotating:!1,appStateTrayRotation:0,appStateUseNotifications:UseDebug,appStateUsePortraitLayout:!1,appStateShowNotification:!1,appParkingRightButtonDisabled:!1,appStateShowMeta:!0,vsShowDaily:!0,appStateUseFlower:!1,appStateBrowserNotificationInterval:null,appStateShareError:!1,currentGameGuessCount:0,currentGameGuessersName:"",currentGameLanguage:"",currentGameGuessingCardCount:4,currentGameGuessingWordSet:t.wordSets.find((t=>"100"===t.id)),currentGameReviewIsFinal:!1,currentGameSolutionActual:"",currentGameSolutionGuessing:[],currentGameWordSet:t.wordSets.find((t=>"100"===t.id)),userSettingsUseExtraCard:!1,userSettingsHideStats:!1,userSettingsUsesLightTheme:!1,userSettingsHueIndex:0,userSettingsUsesSimplifiedTheme:!1,userSettingsUseMultiColoredGems:!0,userSettingsUseWordSetThemes:!0,userSettingsUserWantsDailyReminder:!1,userSettingsShowAllCards:!0,appStateShowCreateOOBE:!1,userSettingsStreaks:[],vsUseFocus:!0,userSettingsLanguage:"en-us",userSettingsLegalAccepted:!1,tempName:"",tempID:0,tempShareURLCode:"",tempUseMultiColoredGems:!0,tempUserSettingsUsesLightTheme:!1,tempUserSettingsHueIndex:0,tempUserSettingsUsesSimplifiedTheme:!1,tempUserSettingsShowAllCards:!0,tempUseWordSetThemes:!0,tempUserWantsDailyReminder:!1,tempUserSettingsHideStats:!1,tempWordSetName:"",tempUsePortraitLayout:!1,tempUseExtraCard:!1,tempWordSets:[],tempUserSettingsLanguage:"en-us",documentCssRoot:document.querySelector(":root"),cssStyles:window.getComputedStyle(document.querySelector(":root"))}),methods:{ToggleShowTutorial(t){note("ToggleShowTutorial()"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.appStateShowTutorial=!this.appStateShowTutorial,this.appStateShowCreateOOBE=!1},ToggleUseLightTheme(t){note("ToggleUseLightTheme()"),this.userSettingsUsesLightTheme=t,this.userSettingsUsesLightTheme?document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 92%)":document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 3%)"},ToggleUseSimplifedTheme(t){note("ToggleUseSimplifedTheme()"),this.userSettingsUsesSimplifiedTheme=t,this.userSettingsUsesSimplifiedTheme&&(this.tempUseMultiColoredGems=!0)},ToggleShowAllCards(t){note("ToggleShowAllCards()"),this.userSettingsShowAllCards=t},ToggleFocus(){note("ToggleFocus()"),window.innerWidth<=660&&(this.vsUseFocus=!this.vsUseFocus)},async ToggleShowGlobalCreated(t){note("ToggleShowGlobalCreated()"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.appStateShowGlobalCreated=!this.appStateShowGlobalCreated,0===this.appDataGlobalCreatedGames.length&&this.GetRecentAnonymousGames()},async ToggleShowDailyGames(t){note("ToggleShowDailyGames()"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.appStateShowDailyGames=!this.appStateShowDailyGames},ToggleShowInfo(t){note("ToggleShowInfo()"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.appStateShowInfo=!this.appStateShowInfo},ToggleShowMeta(t){note("ToggleShowMeta()"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.appStateShowMeta=!this.appStateShowMeta},SetTempLanguage(t){note("SetTempLanguage()"),this.tempUserSettingsLanguage=t},ToggleTempUseWordSetThemes(){note("ToggleTempUseWordSetThemes()"),this.tempUseWordSetThemes=!this.tempUseWordSetThemes},async ToggleTempUserWantsDailyReminder(){if(note("ToggleTempUserWantsDailyReminder()"),this.tempUserWantsDailyReminder=!this.tempUserWantsDailyReminder,this.tempUserWantsDailyReminder&&this.isNotificationSupported){let t=await this.EnableDailyReminders();this.userSettingsUserWantsDailyReminder=this.tempUserWantsDailyReminder=!!t}},SetHueIndex(t){note("SetHueIndex()"),this.tempUserSettingsHueIndex=t},ToggleTempUseLightTheme(){note("ToggleTempUseLightTheme()"),this.tempUserSettingsUsesLightTheme=!this.tempUserSettingsUsesLightTheme},ToggleTempHideStats(){note("ToggleTempHideStats()"),this.tempUserSettingsHideStats=!this.tempUserSettingsHideStats},ToggleTempUseSimplifiedTheme(){note("ToggleTempUseSimplifiedTheme()"),this.tempUserSettingsUsesSimplifiedTheme=!this.tempUserSettingsUsesSimplifiedTheme},ToggleTempShowAllCards(){note("ToggleTempShowAllCards()"),this.tempUserSettingsShowAllCards=!this.tempUserSettingsShowAllCards},ToggleTempUsePortraitLayout(){note("ToggleTempUsePortraitLayout()"),this.tempUsePortraitLayout=!this.tempUsePortraitLayout},ToggleTempUseMultiColoredGems(){note("ToggleTempUseMultiColoredGems()"),this.tempUseMultiColoredGems=!this.tempUseMultiColoredGems},ToggleTempUseExtraCard(){note("ToggleTemp≈UseExtraCard()"),this.tempUseExtraCard=!this.tempUseExtraCard},ShowCategoryPicker(){note("ShowCategoryPicker()"),this.tempWordSetName=this.currentSelectedTempWordSetName},ShowSettings(t){note("ShowSettings()"),null!=t&&(t.stopPropagation(),t.preventDefault()),this.appStateIsModalShowing=!0,this.appStateShowSettings=!0,this.GetCategoryNames()},GetCategoryNames(){this.tempWordSets=[],this.tempWordSetName=this.currentSelectedTempWordSetName,this.appDataWordSets.forEach((e=>{this.tempWordSets.push(new t.WordSetObject(e))})),this.tempName=this.appDataPlayerCurrent.name},AdvanceFirstRunIndexes(){if(this.isUserFocusedOnGame&&!this.appStateTipIsAnimating)switch(note("AdvanceFirstRunIndexes()"),this.appDataPlayerCurrent.role){case"guesser":this.isPlayerGuessing&&this.appStateFirstRunGuessingIndex<this.appDataGuessingFirstRunItems.length&&!this.isSolved&&(this.appStateTipIsAnimating=!0,setTimeout((()=>{this.appStateFirstRunGuessingIndex++,this.appStateTipIsAnimating=!1}),240));break;case"creator":this.isPlayerCreating&&this.appStateFirstRunCreatingIndex<this.appDataCreatorFirstRunItems.length&&(this.appStateTipIsAnimating=!0,setTimeout((()=>{this.appStateFirstRunCreatingIndex++,requestAnimationFrame((()=>{this.isPlayerCreating&&3===this.appStateFirstRunCreatingIndex?document.getElementById("hint0").select():document.getElementById("hint0").blur(),this.appStateTipIsAnimating=!1}))}),240));break;case"reviewer":this.isPlayerReviewing&&this.appStateFirstRunReviewingIndex<this.appDataReviewingFirstRunItems.length&&(this.appStateTipIsAnimating=!0,setTimeout((()=>{this.appStateFirstRunReviewingIndex++,this.appStateTipIsAnimating=!1}),240));break}},RetreatFirstRunIndexes(){if(this.isUserFocusedOnGame&&!this.appStateTipIsAnimating)switch(note("RetreatFirstRunIndexes()"),this.appDataPlayerCurrent.role){case"guesser":this.isPlayerGuessing&&this.appStateFirstRunGuessingIndex>0&&!this.isSolved&&(this.appStateTipIsAnimating=!0,setTimeout((()=>{this.appStateTipIsAnimating=!1,this.appStateFirstRunGuessingIndex--}),240));break;case"creator":this.isPlayerCreating&&this.appStateFirstRunCreatingIndex>0&&(this.appStateTipIsAnimating=!0,setTimeout((()=>{this.appStateTipIsAnimating=!1,this.appStateFirstRunCreatingIndex--}),240));break;case"reviewer":this.isPlayerReviewing&&this.appStateFirstRunReviewingIndex>0&&(this.appStateTipIsAnimating=!0,setTimeout((()=>{this.appStateTipIsAnimating=!1,this.appStateFirstRunReviewingIndex--}),240));break}},async ResetFirstRun(){note("ResetFirstRun()"),this.ClearTrayOfCards(),this.appStateFirstRunCreatingIndex=0,this.appStateFirstRunReviewingIndex=0,this.appStateFirstRunGuessingIndex=this.isPlayerGuessing&&4===this.fullCardsInTray.length?1:0,await t.RemoveData("appStateFirstRunCreatingIndex"),await t.RemoveData("appStateFirstRunReviewingIndex"),await t.RemoveData("appStateFirstRunGuessingIndex")},EndAllFirstRunTips(){this.isUserFocusedOnGame&&!this.appStateTipIsAnimating&&(this.appStateFirstRunGuessingIndex=this.appDataGuessingFirstRunItems.length,this.appStateFirstRunCreatingIndex=this.appDataCreatorFirstRunItems.length,this.appStateFirstRunReviewingIndex=this.appDataReviewingFirstRunItems.length)},ReloadApp(){window.location.reload()},SetWordSetTheme(t){if(note("SetWordSetTheme()"),this.tempUseWordSetThemes)this.documentCssRoot.style.setProperty("--texture2","url("+t.textureImage+")"),this.documentCssRoot.style.setProperty("--textureSize",t.textureSize),this.documentCssRoot.style.setProperty("--textureBlendMode",t.textureBlendMode),this.documentCssRoot.style.setProperty("--textureHue",t.textureHue);else{let t=this.documentCssRoot.style.getPropertyValue("--textureSource");this.documentCssRoot.style.setProperty("--texture2",t),this.documentCssRoot.style.setProperty("--textureSize","cover"),this.documentCssRoot.style.setProperty("--textureBlendMode","normal");let e=this.documentCssRoot.style.getPropertyValue("--textureHueSource");this.documentCssRoot.style.setProperty("--textureHue",e)}this.documentCssRoot.style.setProperty("--wordScale",t.scale)},async LoadTranslatedWords(){note("LoadTranslatedWords()");let t=await this.GetCurrentGameWordSet(),e={};t.forEach((t=>{e[t.id]=t})),this.appDataCards.forEach((t=>{t.words.forEach((t=>{e[t.id]&&(t.value=e[t.id].value)}))})),this.appDataCardsParked.forEach((t=>{t.words.forEach((t=>{e[t.id]&&(t.value=e[t.id].value)}))}))},async GetCurrentGameWordSet(){note("GetCurrentGameWordSet()");let t=[],e=""===this.userSettingsLanguage?"":this.userSettingsLanguage+"/";""!==this.currentGameLanguage&&(e=this.currentGameLanguage);let a=this.currentGameWordSet.data.map((async t=>{let a=t.toString().replace("./data/","./data/"+e);this.currentGameWordSet.noLanguage&&(a=t.toString().replace("./data/","./data/common/"));const s=await fetch(a);return await s.json()}));try{let e=await Promise.all(a);t=[].concat(...e)}catch(t){error(t)}return t},async GetGuessingGameWordSet(){note("GetGuessingGameWordSet()");let t=""===this.userSettingsLanguage?"":this.userSettingsLanguage+"/";""!==this.currentGameLanguage&&(t=this.currentGameLanguage+"/");let e=[],a=this.currentGameGuessingWordSet.data.map((async e=>{let a=e.toString().replace("./data/","./data/"+t);this.currentGameGuessingWordSet.noLanguage&&(a=e.toString().replace("./data/","./data/common/"));const s=await fetch(a);return await s.json()}));try{let t=await Promise.all(a);e=[].concat(...t)}catch(t){error(t)}return e},async UpdateGameGuessesCount(e,a=!1){note("UpdateGameGuessesCount()");let s=this.GetUserStartedGame(e)??e;s&&!s.solved&&(s.solved=a,this.currentDaily.quit?s.quit=!0:s.guesses++,1e7!==this.appDataPlayerCurrent.id&&await t.SaveData("dailyGames",JSON.stringify(this.appDataUserDailyGamesStarted))),this.UpdateDailyGameFromStartedGameData(s)},async UpdateDailyGameFromStartedGameData(t){note("UpdateDailyGameFromStartedGameData()"),this.ResetTrayAfterRotation();let e=this.appDataDailyGames.find((e=>e.key===t.key));e.guesses=t.guesses,e.solved=t.solved,this.currentDaily.quit&&(e.quit=!0),e.solved&&await this.SendGameStatsToServer(e),this.RotateTray(8)},async SendGameStatsToServer(t){if(!this.appStateSolving&&1e7!==this.appDataPlayerCurrent.id){note("SendGameStatsToServer()");let e=`id=${this.appDataPlayerCurrent.id}&key=${t.key}&guesses=${t.guesses}`;t.quit&&(e=`id=${this.appDataPlayerCurrent.id}&key=${t.key}&guesses=${t.guesses}&quit=true`);const a=`https://facets-save-gamestats.bigtentgames.workers.dev/${e}`;await fetch(a,{method:"GET",headers:{Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then((t=>(t.ok||error(t.status),t.json()))).catch((t=>{error(t)})).finally((()=>{this.GetDailyGameStats()}))}},async IsCurrentGuessCorrect(){if(note("IsCurrentGuessCorrect()"),4===this.numberOfCardsThatHaveBeenPlacedOnTray){this.currentGameGuessCount++;let t=[];this.appDataHints.forEach((e=>{t.push(e.value)})),this.appDataCards.forEach((t=>{t.failedCheckAlready=!1})),this.appDataCardsParked.forEach((t=>{t.failedCheckAlready=!1}));let e=this.currentGameSolutionActual.split(":"),a=this.GetCurrentSolutionParamString().split(":"),s=[];for(let t=0;t<e.length;t+=3)for(let i=0;i<a.length;i+=3)if(e[t]===a[i]){s.push(a[i],a[i+1],a[i+2]);break}if(this.currentGameSolutionGuessing=s.join(":"),this.currentGameSolutionActual===this.currentGameSolutionGuessing&&(this.RotateTray(8),window.history.pushState({},document.title,window.location.pathname)),this.currentDaily&&await this.UpdateGameGuessesCount(this.currentDaily,this.currentGameSolutionActual===this.currentGameSolutionGuessing),s[1]!==e[1]){let t=this.appDataCards.find((t=>t.words.some((t=>t.id===parseInt(s[1])))));t.wrongGuesses.s0.includes(s[1])||t.wrongGuesses.s0.push(s[1]),this.SwapCards(t,this.firstAvailableParkingSpot)}if(s[2]!==e[2]){let t=this.appDataCards.find((t=>t.words.some((t=>t.id===parseInt(s[2])))));t.wrongGuesses.s1.includes(s[2])||t.wrongGuesses.s1.push(s[2]),this.SwapCards(t,this.firstAvailableParkingSpot)}if(s[10]!==e[10]){let t=this.appDataCards.find((t=>t.words.some((t=>t.id===parseInt(s[10])))));t.wrongGuesses.s2.includes(s[10])||t.wrongGuesses.s2.push(s[10]),this.SwapCards(t,this.firstAvailableParkingSpot)}if(s[11]!==e[11]){let t=this.appDataCards.find((t=>t.words.some((t=>t.id===parseInt(s[11])))));t.wrongGuesses.s3.includes(s[11])||t.wrongGuesses.s3.push(s[11]),this.SwapCards(t,this.firstAvailableParkingSpot)}return this.appDataMessage=this.GetMessageBasedOnTrayCount(!0,""),this.appStateShowNotification=!0,this.appDataTimeoutNotification=setTimeout((()=>{this.appStateShowNotification=!1}),1700),this.CheckIfAnyCardsGuesssAlreadyTried(),this.ScrollParking(null,"beginning"),!1}},CheckIfAnyCardsGuesssAlreadyTried(){let t=this.currentGameSolutionActual.split(":"),e=this.GetCurrentSolutionParamString().split(":");if(12===e.length&&"creator"!==this.appDataPlayerCurrent.role){note("CheckIfAnyCardsGuesssAlreadyTried()");let a=[];for(let s=0;s<t.length;s+=3)for(let i=0;i<e.length;i+=3)if(t[s]===e[i]){a.push(e[i],e[i+1],e[i+2]);break}if(this.appDataCards.forEach((t=>{t.failedCheckAlready=!1})),this.appDataCardsParked.forEach((t=>{t.failedCheckAlready=!1})),"-1"!==a[1]&&a[1]!==t[1]){let t=this.appDataCards.find((t=>t.words.some((t=>t.id===parseInt(a[1])))));t.wrongGuesses.s0.includes(a[1])&&(t.failedCheckAlready=t.wrongGuesses.s0.includes(a[1]))}if("-1"!==a[2]&&a[2]!==t[2]){let t=this.appDataCards.find((t=>t.words.some((t=>t.id===parseInt(a[2])))));t.wrongGuesses.s1.includes(a[2])&&(t.failedCheckAlready=t.wrongGuesses.s1.includes(a[2]))}if("-1"!==a[10]&&a[10]!==t[10]){let t=this.appDataCards.find((t=>t.words.some((t=>t.id===parseInt(a[10])))));t.wrongGuesses.s2.includes(a[10])&&(t.failedCheckAlready=t.wrongGuesses.s2.includes(a[10]))}if("-1"!==a[11]&&a[11]!==t[11]){let t=this.appDataCards.find((t=>t.words.some((t=>t.id===parseInt(a[11])))));t.wrongGuesses.s3.includes(a[11])&&(t.failedCheckAlready=t.wrongGuesses.s3.includes(a[11]))}}},async FillParkingLot(){note("FillParkingLot()"),this.appDataPlayerCreator.id=this.appDataPlayerCurrent.id,this.appStateIsGuessing=!0;let e=[new t.CardObject({}),new t.CardObject({}),new t.CardObject({}),new t.CardObject({})],a=0;this.currentGameSolutionActual=this.GetCurrentSolutionParamString(),this.appDataCards.concat(this.appDataCardsParked).forEach((t=>{t.id=this.appDataPlayerCurrent.value+a++,t.rotation=(1===getRandomInt(0,1)?1:-1)*getRandomInt(0,4)})),this.ResetCardsAfterRotation(!1),this.appDataCardsParked=this.appDataCards;let s=[];this.appDataCards.forEach((t=>{t.words.forEach((t=>{s.push(t)}))}));let i=await this.GetCurrentGameWordSet();if(5===this.currentGameGuessingCardCount&&(this.appDataCardsParked.push(new t.CardObject({words:t.GetUniqueWords(i,4,t.GetJustWords(s))})),UseDebug)){this.appDataCards.forEach((t=>{note(JSON.stringify(t.words))}));for(let t=this.appDataCardsParked.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1));[this.appDataCardsParked[t],this.appDataCardsParked[e]]=[this.appDataCardsParked[e],this.appDataCardsParked[t]]}}4===this.currentGameGuessingCardCount&&this.appDataCardsParked.push(new t.CardObject({})),this.appDataCardsParked.push(new t.CardObject({}));for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}this.appDataCards=e,await this.ShareBoard(!1,!0),this.GetRecentAnonymousGames()},async RestoreGame(e){note("RestoreGame()");var a=new URLSearchParams(window.location.search);this.appDataPlayerSender.name=a.has("sendingName")?a.get("sendingName"):this.appDataPlayerSender.name,this.currentGameGuessersName=this.appDataPlayerSender.name,this.currentGameLanguage=a.has("lang")?a.get("lang"):"en-us",this.appDataPlayerCreator.name=a.has("puzzleName")?a.get("puzzleName"):this.appDataPlayerCreator.name,this.appDataPlayerSender.id=a.has("sendingID")?parseInt(a.get("sendingID")):this.appDataPlayerSender.id,this.appDataPlayerCreator.id=a.has("puzzleID")?parseInt(a.get("puzzleID")):this.appDataPlayerCreator.id,this.appCurrentDailyGameKey=a.has("key")?a.get("key").toString():this.appCurrentDailyGameKey,this.currentGameGuessingWordSet=a.has("wordSetID")?this.appDataWordSets.find((t=>t.id===a.get("wordSetID"))):this.currentGameWordSet,this.currentGameGuessingCardCount=a.has("useExtraCard")&&JSON.parse(a.get("useExtraCard"))?5:4,this.appStateForceAutoCheck=0===this.appDataPlayerCreator.id,this.appDataPlayerSender.id===this.appDataPlayerCreator.id||this.appDataPlayerCreator.id===this.appDataPlayerCurrent.id||this.appStateForceAutoCheck||(this.appStateIsModalShowing=!0,this.appDataConfirmationObject={message:`Are you "${this.appDataPlayerCreator.name}," the original creator of this puzzle?`,target:"creator"},this.appStateShowConfirmation=!0);let s=!1;if(e.length>=40){this.appDataShareURL=window.location.href;let i=await this.GetGuessingGameWordSet();this.appDataCards=[new t.CardObject({}),new t.CardObject({}),new t.CardObject({}),new t.CardObject({})],this.appDataCardsParked=[new t.CardObject({}),new t.CardObject({}),new t.CardObject({}),new t.CardObject({}),new t.CardObject({}),new t.CardObject({})],this.appDataHints=[new t.WordObject({}),new t.WordObject({}),new t.WordObject({}),new t.WordObject({})];let r=0;this.appDataCards.forEach((t=>{for(let a=0;a<4;a++){if(""!==e[r]){let a=i.find((t=>t.id===parseInt(e[r])));void 0===a&&(s=!0),t.words.push(a)}r++}})),this.appDataCardsParked.forEach((t=>{for(let a=0;a<4;a++){if(""!==e[r]){let a=i.find((t=>t.id===parseInt(e[r])));void 0===a&&(s=!0),t.words.push(a)}r++}})),this.appDataHints.forEach((t=>{t.value=e[r++]})),a.has("sol")?(this.currentGameSolutionActual=a.get("sol"),a.has("final")&&(this.currentGameSolutionGuessing=this.currentGameSolutionActual,this.appDataMessage=`${this.appDataPlayerCurrent.name}, here's the solution to ${this.appDataPlayerSender.name}'s puzzle.`,this.currentGameReviewIsFinal=!0)):this.currentGameSolutionActual=[],this.SetWordSetTheme(this.currentGameGuessingWordSet),this.documentCssRoot.style.setProperty("--wordScale",this.currentGameGuessingWordSet.scale),this.appDataPlayerCurrent.role=this.appDataPlayerCreator.id===this.appDataPlayerCurrent.id&&this.appDataPlayerCurrent.id!==this.appDataPlayerSender.id?"reviewer":"guesser",this.isPlayerReviewing&&0!==this.appDataPlayerCreator.id&&(this.appDataReviewingFirstRunItems[0][0]=this.appDataReviewingFirstRunItems[0][0].replace("Your friend ",this.appDataPlayerSender.name+" ")),this.isPlayerGuessing&&(0!==this.appDataPlayerCreator.id||this.isAIGenerated)?this.appDataGuessingFirstRunItems[0][0]=this.appDataGuessingFirstRunItems[0][0].replace("Your friend ",this.appDataPlayerSender.name+" "):this.isPlayerGuessing&&0===this.appDataPlayerCreator.id&&!this.isAIGenerated&&(this.appDataGuessingFirstRunItems[0][1]="Hi, An anonymous player created this puzzle for their friends to solve. Can you solve it too?")}this.appStateIsGuessing=!0,s&&this.NewGame(null,"😕 - Something went wrong.")},async CreateCardsForPlayer(e){note("CreateCardsForPlayer()");let a=await this.GetCurrentGameWordSet(),s=t.GetUniqueWords(a);for(let e=0;e<4;e++){const a=new t.CardObject({position:e});3===e&&(a.position=2),2===e&&(a.position=3),a.words=s.slice(0+4*e,4+4*e),this.appDataCards.push(a)}},async GetAISolution(){let t,e;note("GetAISolution()"),t=[],e=document.getElementsByTagName("word"),note(`wordElements.length = ${e.length}`);for(let a=0;a<e.length;a++){const s=e[a];t.push(s.innerHTML)}t=t.join(",");const a=`https://facets-get-ai-solution.bigtentgames.workers.dev/?${encodeURIComponent(t)}`;try{const t=await fetch(a,{method:"GET",headers:{Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}});t.ok||error(t.status);const e=await t.text();this.SetAIHints(JSON.parse(e).result),this.FillParkingLot()}catch(t){error(t)}this.ToggleShowMeta(null)},SetAIHints(t){if(note("SetAIHints()"),!Array.isArray(t))this.appDataAIResult=t,this.appDataHints[0].value=t.clue1[0],this.appDataHints[1].value=t.clue2[0],this.appDataHints[2].value=t.clue3[0],this.appDataHints[3].value=t.clue4[0];else for(let e=0;e<this.appDataHints.length;e++){this.appDataHints[e].value=t[e]}},SelectWordSet(t,e){note("SelectWordSet()"),null!==t&&(t.preventDefault(),t.stopPropagation()),this.tempWordSets.forEach((t=>{t.isSelected=!1})),e.isSelected=!0,this.documentCssRoot.style.setProperty("--wordScale",e.scale)},GetCurrentSolutionParamString(){note("GetCurrentSolutionParamString()");let t=[];return this.appDataHints.forEach((t=>{t.value=t.value.trim()})),t.push(this.appDataHints[0].value),t.push(4===this.appDataCards[0].words.length?this.appDataCards[0].words[0].id:-1),t.push(4===this.appDataCards[1].words.length?this.appDataCards[1].words[0].id:-1),t.push(this.appDataHints[1].value),t.push(4===this.appDataCards[1].words.length?this.appDataCards[1].words[1].id:-1),t.push(4===this.appDataCards[3].words.length?this.appDataCards[3].words[1].id:-1),t.push(this.appDataHints[2].value),t.push(4===this.appDataCards[2].words.length?this.appDataCards[2].words[3].id:-1),t.push(4===this.appDataCards[0].words.length?this.appDataCards[0].words[3].id:-1),t.push(this.appDataHints[3].value),t.push(4===this.appDataCards[3].words.length?this.appDataCards[3].words[2].id:-1),t.push(4===this.appDataCards[2].words.length?this.appDataCards[2].words[2].id:-1),t.join(":")},GetUniqueCardId(t){if(note("GetUniqueCardId()"),0===t.length)return 0;let e="";t.forEach((t=>{e+=t.value.toLowerCase()})),e=e.split(""),e=e.sort(),e=e.join("");let a=0;for(let t=0;t<e.length;t++)a=(26*a+(e.charCodeAt(t)-"a".charCodeAt(0)+1))%1000000007;return a},CheckIfCardIsInTray(t){return note("CheckIfCardIsInTray()"),!(!t.words||0===t.words.length)&&(this.appDataCards.forEach((e=>{if(this.GetUniqueCardId(e.words)===this.GetUniqueCardId(t.words))return!0})),!1)},async GetRecentAnonymousGames(){if(!this.appStateIsGettingAnonymousGames&&(note("GetRecentAnonymousGames()"),window.location.href!==window.location.origin+"/generate.html?generated=true")){this.appStateIsGettingAnonymousGames=!0,this.appDataGlobalCreatedGames=[];await fetch("https://facets-get-recent-anonymous-games.bigtentgames.workers.dev/",{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then((t=>(t.ok||error(t.status),t.text()))).then((t=>{this.appDataGlobalCreatedGames=JSON.parse(t)})).catch((t=>{error(t)})).finally((()=>{this.appStateIsGettingAnonymousGames=!1}))}},async GetDailyGames(){if(note("GetDailyGames()"),this.appStateIsGettingDailyGames||this.GetTodaysDaily())this.appStateIsGettingDailyGames=!1,this.appStateIsGettingUserStats=!this.userSettingsHideStats,this.GetDailyGameStats();else if(note("fetching daily games"),this.vsShowDaily&&window.location.href!==window.location.origin+"/generate.html?generated=true"){this.appStateIsGettingDailyGames=!0,this.appStateIsGettingUserStats=!this.userSettingsHideStats;let t=[];await fetch("https://facets-get-last-10-daily-games.bigtentgames.workers.dev/",{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then((t=>(t.ok||error(t.status),t.text()))).then((e=>{t=JSON.parse(e),t.forEach((t=>{let e=this.GetUserStartedGame(t);t.guesses=0,e&&(t.solved=e.solved,t.guesses=e.guesses,e.quit&&(t.quit=e.quit))})),this.GetDailyGameStats(),this.appDataDailyGames=t})).catch((t=>{error(t)})).finally((()=>{this.appStateIsGettingDailyGames=!1}))}},async GetDailyGameStats(){if(!this.appStateIsGettingDailyGameStats){note("GetDailyGameStats()"),this.appStateIsGettingDailyGameStats=!0;await fetch("https://facets-get-daily-gamestats.bigtentgames.workers.dev/",{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then((t=>(t.ok||error(t.status),t.text()))).then((t=>{this.appDataDailyGamesStats=JSON.parse(t),this.appDataDailyGames.forEach((t=>{t.showStats=!1,t.stats={guesscounts:{beyond2:0}};for(const e of this.appDataDailyGamesStats)if(e.hasOwnProperty(t.key)){t.stats=e[t.key];break}(t.stats&&void 0===t.stats.avg||null===t.stats.avg)&&(t.stats.avg=0),void 0!==t.stats.guesscounts.beyond2&&null!==t.stats.guesscounts.beyond2||(t.stats.guesscounts.beyond2=0)}))})).catch((t=>{error(t)})).finally((()=>{this.GetUsersStats(),this.appStateIsGettingDailyGameStats=!1}))}},async GetUsersStats(){note("GetUsersStats()"),this.appStateIsGettingUserStats=!0;var t="https://facets-get-users-stats.bigtentgames.workers.dev/"+this.appDataPlayerCurrent.id;await fetch(t,{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then((t=>(t.ok||error(t.status),204===t.status?null:t.text()))).then((t=>{if(!t)return;let e=JSON.parse(t);e.forEach((t=>{for(const e of this.appDataDailyGames)t.key===e.key&&(e.guesses=t.guesses,null!==t.quit&&void 0!==t.quit&&(e.quit=t.quit),e.solved=!0)})),this.appDataPlayerStats={g1:0,g2:0,beyond2:0,quit:0,total:0};for(let t=0;t<e.length;t++){const a=e[t];null!==a.quit&&void 0!==a.quit?this.appDataPlayerStats.quit++:1===a.guesses?this.appDataPlayerStats.g1++:2===a.guesses?this.appDataPlayerStats.g2++:this.appDataPlayerStats.beyond2++,this.appDataPlayerStats.total++}})).catch((t=>{error(t)})).finally((()=>{this.appStateIsGettingUserStats=!1}))},HandleSubmitButtonPress(){note("HandleSubmitButtonPress()"),"reviewer"===this.appDataPlayerCurrent.role&&4===this.numberOfCardsThatHaveBeenPlacedOnTray?(this.appStateIsModalShowing=!0,this.appDataConfirmationObject={message:`Did ${this.appDataPlayerSender.name} have the right answer?`,target:"correct"},this.appStateShowConfirmation=!0):this.appStateIsGuessing?this.currentGameSolutionGuessing===this.currentGameSolutionActual?this.GetIsAIGenerated()?this.ShareWin(null):this.HandleNewGameClick():this.currentDaily||this.appStateForceAutoCheck?this.submitButtonText===this.appDataActionButtonTexts.quit?(this.appDataConfirmationObject={message:"Give up and see the solution?",target:"quit"},this.appStateShowConfirmation=!0):this.IsCurrentGuessCorrect():this.ShareBoard():this.FillParkingLot()},GetUserStartedGame(t){return this.appDataUserDailyGamesStarted.find((e=>e.key===t.key))},HasUserStartedGame(t){let e=!1;return e=!!this.GetUserStartedGame(t),e},async HandleOldGameClick(e,a,s=!1){note("HandleOldGameClick()"),null!==e&&(e.preventDefault(),e.stopPropagation());let i=["?"];if(this.currentGameSolutionGuessing="",this.appDataMessage="",i.push("sendingName=Player 1"),i.push("&generated="+encodeURIComponent(this.isAIGenerating?this.isAIGenerating:a.generated)),i.push("&key="+encodeURIComponent(a.key)),i.push("&puzzleName=Player 1"),i.push("&puzzleID="+encodeURIComponent(a.puzzleID)),i.push("&lang="+encodeURIComponent(a.lang)),i.push("&wordSetID="+encodeURIComponent(a.wordSetID)),i.push("&useExtraCard="+encodeURIComponent(a.useExtraCard)),i.push("&sol="+encodeURIComponent(a.sol)),i.push("&board="+encodeURIComponent(a.board)),this.appCurrentDailyGameKey=-1,a.date&&a.key){if(i.push("&key="+encodeURIComponent(a.key)),!this.HasUserStartedGame(a)){let e={key:a.key,guesses:0,solved:!1};this.appDataUserDailyGamesStarted.push(e),1e7!==this.appDataPlayerCurrent.id&&await t.SaveData("dailyGames",JSON.stringify(this.appDataUserDailyGamesStarted))}this.appCurrentDailyGameKey=a.key}let r=i.join(""),n=location.origin+r;note(n),history.pushState(null,null,n),this.appStateShowDailyGames&&this.ToggleShowDailyGames(e),this.appStateShowMeta||this.ToggleShowMeta(e),this.appStateShowGlobalCreated&&this.ToggleShowGlobalCreated(e),await this.LoadPage(),this.appStateShowNotification=!0,this.RotateTray(-4)},async HandleGoButtonClick(e){note("HandleGoButtonClick()"),this.SubmitSettings(e),this.appStateShowCreateOOBE=!1,await t.SaveData("userHasSeenFirstTimeCreatingTutorial",!0),this.appStateShowCatChooser=!1},HandleNewGameClick(){note("HandleNewGameClick()"),this.GetCategoryNames(),this.appStateShowCatChooser=!0,this.appStateUserHasCreatedAGame=!0},HandleGameLinkClick(t,e){note("HandleGameLinkClick()"),t.stopPropagation(),t.preventDefault(),e.solved&&e.guesses>0?this.HandleSolvedPuzzleButtonClick(t,e):this.HandleOldGameClick(t,e)},async HandleSolvedPuzzleButtonClick(t,e){note("HandleSolvedPuzzleButtonClick()"),t.stopPropagation(),t.preventDefault(),this.appStateSolving=!0,await this.HandleOldGameClick(t,e,!0),this.appStateShowNotification=!1,this.SolvePuzzleCurrent(),this.appStateSolving=!1,this.appStateShowNotification=!1,history.pushState(null,null,window.location.origin+window.location.pathname)},ClearTrayOfCards(){if(this.isPlayerGuessing)for(let t=0;t<this.appDataCards.length;t++){const e=this.appDataCards[t];if(0!==e.words.length){let t=this.appDataCardsParked.find((t=>0===t.words.length));this.SwapCards(e,t)}}},SolvePuzzleCurrent(){note("SolvePuzzleCurrent()");let t=this.currentGameSolutionActual.split(":"),e=t[0],a=this.appDataHints.findIndex((t=>t.value===e));this.RotateTrayBasedOnInputFocus(a,!1);let s=[parseInt(t[1]),parseInt(t[4]),parseInt(t[7]),parseInt(t[10])];this.ClearTrayOfCards();for(let t=0;t<this.appDataCards.length;t++){const e=this.appDataCards[t];if(0===e.words.length){let a=this.appDataCardsParked.find((e=>e.words.find((e=>e.id===s[t]))));if(a){let i=a.words.findIndex((e=>e.id===s[t])),r=0;switch(t){case 1:r=1;break;case 2:r=-1;break;case 3:r=2;break}a.rotation=4-i+r,this.SwapCards(e,a)}}}this.ResetCardsAfterRotation(),this.IsCurrentGuessCorrect()},async HandleYesNo(e,a){switch(note("HandleYesNo()"),e){case"quit":if(a){this.currentDaily.quit=!0,this.SolvePuzzleCurrent();break}case"correct":this.ShareBoard(a);break;case"newgame":a&&this.NewGame(null);break;case"creator":a&&(confirm=window.confirm(`Are you sure you are, (${this.appDataPlayerCreator.name}), the original creator?`),confirm&&(this.tempID=this.appDataPlayerCreator.id,this.appDataPlayerCurrent.id=this.appDataPlayerCreator.id,this.appDataPlayerCurrent.role="reviewer",await t.SaveData("userID",this.appDataPlayerCurrent.id)));break;default:break}this.appStateShowConfirmation=!1,this.appStateIsModalShowing=!1},HandlePointerMoveEvent(t){this.appDataGhostX=t.clientX,this.appDataGhostY=t.clientY},HandlePreviousTipButtonPointerUp(t){t.preventDefault(),t.stopPropagation(),this.RetreatFirstRunIndexes()},HandleAdvanceTipButtonPointerUp(t){t.preventDefault(),t.stopPropagation(),this.AdvanceFirstRunIndexes()},HandleBodyPointerUp(t,e){this.appStateShareError=!1,this.appStateIsModalShowing?this.appDataDraggedCard.isSelected=!1:(this.appStateIsDragging=!1,this.appDataDraggedCard=this.appDataEmptyCard)},HandleBodyPointerDown(t){this.appDataGhostX=t.clientX,this.appDataGhostY=t.clientY},HandleCardPointerDown(t,e){this.appStateIsGuessing&&this.currentGameSolutionGuessing===this.currentGameSolutionActual||(null!==t&&(t.preventDefault(),t.stopPropagation(),this.appDataGhostX=t.clientX,this.appDataGhostY=t.clientY,t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)),this.appDataDraggedCard=e,this.appStateIsDragging=!0)},HandleCardPointerUp(t,e,a="tray"){if(!this.appStateIsGuessing||this.currentGameSolutionGuessing!==this.currentGameSolutionActual){if(t.preventDefault(),t.stopPropagation(),this.appDataMessage="",this.selectedCard&&this.selectedCard===e)return this.appDataDraggedCard=this.appDataEmptyCard,void(this.appStateIsDragging=!1);this.appDataDraggedCard.words.length>0&&this.SwapCards(e,this.appDataDraggedCard),this.CheckIfAnyCardsGuesssAlreadyTried()}},ScrollParking(t,e){note("ScrollParking()");const a=document.getElementById("parking"),s=parseInt(this.cssStyles.getPropertyValue("--cardSize")),i=parseFloat(this.cssStyles.getPropertyValue("--scale"));"left"===e?this.appDataParkingScrollLeft=a.scrollLeft+2*i*s:"right"===e?this.appDataParkingScrollLeft=a.scrollLeft-2*i*s:"beginning"===e&&(this.appDataParkingScrollLeft=0),a&&a.scrollTo({left:this.appDataParkingScrollLeft,behavior:"smooth"}),setTimeout((()=>{this.appParkingRightButtonDisabled=a.scrollWidth-a.clientWidth<=a.scrollLeft}),300)},HandlePageVisibilityChange(){note("HandlePageVisibilityChange()"),document.hidden||this.GetDailyGames()},CancelSettings(t){note("CancelSettings()"),null!==t&&(t.preventDefault(),t.stopPropagation()),this.appStateShowCatChooser=!1,this.appStateIsModalShowing=!1,this.appStateShowSettings=!1,this.appStateShowIntro=!1,this.tempID=this.appDataPlayerCurrent.id,this.tempUseMultiColoredGems=this.userSettingsUseMultiColoredGems,this.tempUseWordSetThemes=this.userSettingsUseWordSetThemes,this.tempUserWantsDailyReminder=this.userSettingsUserWantsDailyReminder,this.tempUserSettingsLanguage=this.userSettingsLanguage,this.tempUserSettingsUsesLightTheme=this.userSettingsUsesLightTheme,this.tempUserSettingsHueIndex=this.userSettingsHueIndex,this.tempUseExtraCard=this.userSettingsUseExtraCard,this.tempUserSettingsHideStats=this.userSettingsHideStats,this.tempUserSettingsUsesSimplifiedTheme=this.userSettingsUsesSimplifiedTheme,this.tempUserSettingsShowAllCards=this.userSettingsShowAllCards},HandleIntroButtonClick(t){note("HandleIntroButtonClick()"),this.SubmitSettings(null),this.appStateShowOOBE=!0},async SubmitSettings(e){if(note("SubmitSettings()"),null!==e&&(e.preventDefault(),e.stopPropagation()),this.appDataPlayerCurrent.name=""!==this.tempName?this.tempName.trim():this.appDataPlayerCurrent.name,this.appStateIsGuessing||(this.appDataPlayerCreator.name=this.appDataPlayerCurrent.name),await t.SaveData("name",this.appDataPlayerCurrent.name),this.appStateShowSettings||this.appStateShowCatChooser){this.userSettingsLanguage=this.tempUserSettingsLanguage;let a=this.tempWordSets.find((t=>t.name===this.tempWordSetName));this.SelectWordSet(e,a);let s=!1;s=this.appDataWordSets.find((t=>!0===t.isSelected)).id!==this.tempWordSets.find((t=>!0===t.isSelected)).id,this.appDataWordSets=this.tempWordSets,this.currentGameWordSet=this.appDataWordSets.find((t=>!0===t.isSelected)),(s&&!this.appStateIsGuessing||this.appStateShowCatChooser)&&(this.NewGame(),this.SetWordSetTheme(this.currentGameGuessingWordSet));let i=this.appDataPlayerCurrent.id!==this.tempID;this.appDataPlayerCurrent.id=this.tempID,this.userSettingsUseWordSetThemes=this.tempUseWordSetThemes,this.userSettingsUserWantsDailyReminder=this.tempUserWantsDailyReminder,this.userSettingsUseExtraCard=this.tempUseExtraCard,this.userSettingsHideStats=this.tempUserSettingsHideStats,this.ToggleUseLightTheme(this.tempUserSettingsUsesLightTheme),this.userSettingsHueIndex=this.tempUserSettingsHueIndex,this.ToggleUseSimplifedTheme(this.tempUserSettingsUsesSimplifiedTheme),this.ToggleShowAllCards(this.tempUserSettingsShowAllCards),this.userSettingsUseMultiColoredGems=this.tempUseMultiColoredGems,"creator"===this.appDataPlayerCurrent.role&&(this.currentGameGuessingCardCount=this.userSettingsUseExtraCard?5:4),this.SetWordSetTheme(this.currentGameGuessingWordSet),await t.SaveData("userID",this.appDataPlayerCurrent.id),await t.SaveData("useWordSetThemes",this.userSettingsUseWordSetThemes),await t.SaveData("userSettingsUserWantsDailyReminder",this.userSettingsUserWantsDailyReminder),await t.SaveData("userSettingsLanguage",this.userSettingsLanguage),await t.SaveData("userSettingsUsesLightTheme",this.userSettingsUsesLightTheme),await t.SaveData("userSettingsHueIndex",this.userSettingsHueIndex),await t.SaveData("userSettingsUsesSimplifiedTheme",this.userSettingsUsesSimplifiedTheme),await t.SaveData("userSettingsShowAllCards",this.userSettingsShowAllCards),await t.SaveData("useMultiColoredGems",this.userSettingsUseMultiColoredGems),await t.SaveData("useExtraCard",this.userSettingsUseExtraCard),await t.SaveData("userSettingsHideStats",this.userSettingsHideStats),await t.SaveData("wordSet",this.currentGameWordSet.id),i&&(localStorage.removeItem("dailyGames"),await this.GetDailyGameStats(),window.location.reload())}this.appStateIsModalShowing=!1,this.appStateShowSettings=!1,this.appStateShowIntro=!1},async GetUserSettings(){if(note("GetUserSettings()"),null!==localStorage.getItem("userID")){note("Migrating user settings from localStorage to IndexedDB");const e=["wordSet","appStateFirstRunCreatingIndex","appStateFirstRunGuessingIndex","appStateFirstRunReviewingIndex","dailyGames","name","useExtraCard","useMultiColoredGems","userHasSeenFirstTimeCreatingTutorial","userID","userSettingsHideStats","userSettingsLanguage","userSettingsShowAllCards","userSettingsUserWantsDailyReminder","userSettingsUsesLightTheme","userSettingsUsesSimplifiedTheme","useWordSetThemes"];for(const a of e){let e=localStorage.getItem(a);null!==e&&(await t.SaveData(a,e),localStorage.removeItem(a))}note("Migration complete. LocalStorage data transferred to IndexedDB.")}let e=await t.GetData("appStateFirstRunGuessingIndex");this.appStateFirstRunGuessingIndex=e?parseInt(e):-1;let a=await t.GetData("appStateFirstRunCreatingIndex");this.appStateFirstRunCreatingIndex=a?parseInt(a):this.isPlayerGuessing?-1:0;let s=await t.GetData("appStateFirstRunReviewingIndex");this.appStateFirstRunReviewingIndex=s?parseInt(s):this.isPlayerReviewing?-1:0,this.AdvanceFirstRunIndexes();let i=await t.GetData("userID");null!=i?(i=JSON.parse(i),this.appDataPlayerCurrent.id=i):(this.appDataPlayerCurrent.id=getRandomInt(1e7,1e15),await t.SaveData("userID",this.appDataPlayerCurrent.id),this.appStateShowOOBE=""!==window.location.search),this.tempID=parseInt(this.appDataPlayerCurrent.id);let r=await t.GetData("dailyGames");null!=r&&(this.appDataUserDailyGamesStarted=JSON.parse(r));let n=await t.GetData("name");null!=n?this.appDataPlayerCurrent.name=n:(this.appStateIsModalShowing=!0,this.appStateShowIntro=!0,setTimeout((()=>{document.getElementById("nameInput").focus()}),410)),this.appDataWordSets.forEach((t=>{t.isSelected=!1}));let o=await t.GetData("wordSet");null!=o&&this.appDataWordSets.find((t=>t.id===o))?this.currentGameWordSet=this.appDataWordSets.find((t=>t.id===o)):this.currentGameWordSet=t.wordSets.find((t=>"100"===t.id)),this.currentGameWordSet.isSelected=!0;let p=await t.GetData("userSettingsLanguage");null!=p&&(this.userSettingsLanguage=p,this.tempUserSettingsLanguage=this.userSettingsLanguage);let h=await t.GetData("useWordSetThemes");null!=h&&(this.userSettingsUseWordSetThemes=JSON.parse(h),this.tempUseWordSetThemes=this.userSettingsUseWordSetThemes,this.SetWordSetTheme(this.currentGameWordSet));let l=await t.GetData("userSettingsUserWantsDailyReminder");null!=l&&(this.userSettingsUserWantsDailyReminder=JSON.parse(l),this.tempUserWantsDailyReminder=this.userSettingsUserWantsDailyReminder),this.appStateIsGuessing?this.documentCssRoot.style.setProperty("--wordScale",this.currentGameGuessingWordSet.scale):this.documentCssRoot.style.setProperty("--wordScale",this.currentGameWordSet.scale);let d=await t.GetData("useExtraCard");null!=d&&(this.userSettingsUseExtraCard=JSON.parse(d),this.tempUseExtraCard=this.userSettingsUseExtraCard);let u=await t.GetData("userSettingsHideStats");null!=u&&(this.userSettingsHideStats=JSON.parse(u),this.tempUserSettingsHideStats=this.userSettingsHideStats);let g=await t.GetData("userSettingsUsesLightTheme");null!=g&&(this.ToggleUseLightTheme(JSON.parse(g)),this.tempUserSettingsUsesLightTheme=this.userSettingsUsesLightTheme);let S=await t.GetData("userSettingsHueIndex");null==S&&(S=0),this.tempUserSettingsHueIndex=this.userSettingsHueIndex=S;let m=await t.GetData("userSettingsUsesSimplifiedTheme");null!=m&&(this.ToggleUseSimplifedTheme(JSON.parse(m)),this.tempUserSettingsUsesSimplifiedTheme=this.userSettingsUsesSimplifiedTheme);let c=await t.GetData("userSettingsShowAllCards");null!=c&&(this.ToggleShowAllCards(JSON.parse(c)),this.tempUserSettingsShowAllCards=this.userSettingsShowAllCards);let C=await t.GetData("useMultiColoredGems");null!=C&&(this.userSettingsUseMultiColoredGems=JSON.parse(C),this.tempUseMultiColoredGems=this.userSettingsUseMultiColoredGems)},HandleKeyDownEvent(t){if(!t.metaKey&&!t.ctrlKey&&!t.altKey)switch(t.key){case"Enter":note("HandleKeyDownEvent()"),t.preventDefault(),this.appStateAutoAdvanceTips&&this.AdvanceFirstRunIndexes(),this.appStateShowSettings||this.appStateShowTutorial||this.appStateShowIntro||this.appStateShowInfo||this.appStateShowConfirmation||this.appStateIsGuessing||4!==this.numberOfHintsThatHaveBeenFilled||this.FillParkingLot(),this.appStateShowIntro?this.HandleIntroButtonClick(null):this.appStateShowSettings?this.SubmitSettings(t):this.appStateShowTutorial?(this.appStateShowOOBE=!1,this.ToggleShowTutorial(null)):this.appStateShowConfirmation?this.HandleYesNo(this.appDataConfirmationObject.target,!0):this.appStateShowInfo?this.appStateShowInfo=!1:this.appStateShowGlobalCreated?this.appStateShowGlobalCreated=!1:this.appStateShowCatChooser&&this.HandleGoButtonClick(t);break;case"Tab":note("HandleKeyDownEvent()"),t.preventDefault(),this.appStateTrayIsRotating||this.RotateTray(t.shiftKey?1:-1);break;case":":case"?":case"&":case"=":note("HandleKeyDownEvent()"),t.preventDefault(),t.stopPropagation();break;case"Escape":this.appStateShowOOBE=!1,this.appStateShowSettings?this.CancelSettings(null):this.appStateShowDailyGames?this.ToggleShowDailyGames(null):this.appStateShowTutorial?this.ToggleShowTutorial(null):this.appStateShowCatChooser?this.appStateShowCatChooser=!1:this.appStateShowConfirmation?this.HandleYesNo(this.appDataConfirmationObject.target,!1):this.appStateShowInfo?this.appStateShowInfo=!1:this.appStateShowGlobalCreated?this.appStateShowGlobalCreated=!1:this.appStateShowNotification?this.appStateShowNotification=!1:this.appStateShowMeta?this.appStateShowMeta=!1:this.appStateShowMeta||(this.appStateShowMeta=!0);break;default:}t.ctrlKey&&"r"===t.key&&!t.metaKey&&this.ResetFirstRun()},HandleResize(){this.appStateUsePortraitLayout=document.body.offsetWidth/document.body.offsetHeight<.75},HandlePopState(){note("HandlePopState()"),window.location.search?this.LoadPage():this.NewGame(null)},UpdatePointerTargetLocation(){note("UpdatePointerTargetLocation()");const t=document.getElementsByTagName("pointer")[0];let e=-4e4,a=-4e4,s=!0,i=-4e4,r=-4e4,n=0;if(t){const o=t.getBoundingClientRect(),p=10,h=document.getElementsByClassName("pointout")[0];if(h){const t=h.getBoundingClientRect();a=t.top+window.scrollY-o.height-p-10,s=a>=20,n=s?n:180,a=s?a:t.top+t.height+10,e=t.left+window.scrollX,r=s?a+o.height+1:a-10,i=s?t.left-1+t.width/2-18:t.left+t.width/2-19,e=e>window.innerWidth-o.width+20?window.innerWidth-o.width-20:e,a=a,s?i>e+o.width-44&&(i=e+o.width-36):i>e+o.width-44&&(i=e+o.width-44)}else e=window.innerWidth/2-o.width/2,a=window.innerHeight/2-o.height/2-40}this.appStatePointerLocation={left:e,top:a},this.appStatePointerArrowLocation={x:i,y:r,rotate:n}},ShareWin(t,e=this.currentDaily){if(null!==t&&(t.stopPropagation(),t.preventDefault()),note("ShareWin()"),e.solved){let t=e&&this.todaysDaily===e?"Today's":`The ${e.date}`,a=`I solved ${t} Daily Facet in ${e.guesses} tries! 😀\nCan you do better?\n\n<https://facets.bigtentgames.com>`;this.ConstructAndSetShareURLForCurrentGame(),1===e.guesses&&(a=`🥳 I solved ${t} Daily Facet in 1 try! Can you?\n\n<https://facets.bigtentgames.com>`),e.quit&&(a=`😱 I gave up on ${t} Daily Facet! Can you solve it?\n\n<https://facets.bigtentgames.com>`),this.ShareText(a,""),history.pushState(null,null,window.location.origin+window.location.pathname)}},async CopyTextToClipboard(t){navigator.clipboard?window.ClipboardItem?await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([t],{type:"text/plain"})})]).then((()=>{note("Attempting to copy via navigator.clipboard.write"),this.appDataMessage="Message copied to the clipboard.",this.appStateShowNotification=!0})).catch((e=>{error(e),this.CopyToClipboardViaExecCommand(t)})):await navigator.clipboard.writeText(t).then((()=>{note("Attempting to copy via navigator.clipboard.writeText"),this.appDataMessage="Message copied to the clipboard.",this.appStateShowNotification=!0})).catch((e=>{error(e),this.CopyToClipboardViaExecCommand(t)})):this.CopyToClipboardViaExecCommand(t)},async CopyToClipboardViaExecCommand(t){note("CopyToClipboardViaExecCommand()");copyToClipboard(t);this.appDataMessage=""},async ShareText(t,e){if(note("ShareText()"),!this.isAIGenerating){this.appDataMessage="",note("_text = "+t),note("_url = "+e);let a={text:t+(""===e?"":" <"+e+">")};navigator.canShare&&!navigator.canShare(a)&&(a={text:t,url:""===e?window.location.origin:e}),navigator.share&&navigator.canShare(a)?await navigator.share(a).then((t=>{note("Message shared via navigator.share()")})).catch((a=>{this.CopyTextToClipboard(t+(""===e?"":" <"+e+">")),error("Failed to share via navigator.share(): ",a)})):this.CopyTextToClipboard(t+(""===e?"":" <"+e+">"))}},async ShareBoard(t=!1,e=!1){if(note("ShareBoard()"),!this.isAIGenerating&&this.isChromeAndiOSoriPadOS&&-1!==this.appDataShareURL.indexOf("facets.bigtentgames.com/game/?"))this.CopyTextToClipboard(this.GetShareTextBasedOnContext(t)+" <"+this.appDataShareURL+">"),note("Shortened URL exists, copying to clipboard");else{let s="reviewer"===this.appDataPlayerCurrent.role&&4===this.numberOfCardsThatHaveBeenPlacedOnTray,i=this.GetShareTextBasedOnContext(t);this.ConstructAndSetShareURLForCurrentGame(s,e),this.appStateIsGettingTinyURL=!0;var a=(this.isAIGenerating?"https://facets-save-ai-game.bigtentgames.workers.dev/":"https://facets-shorturl-api.bigtentgames.workers.dev/")+location.search.substring(1);note("Fetching short url"),await fetch(a,{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then((t=>t.ok?t.text():t.text().then((t=>{const e=JSON.parse(t);error("("+e.statusCode+") "+e.message)})))).then((t=>{this.appDataShareURL=location.origin+"/game/?"+t,this.ShareText(i,this.appDataShareURL)})).catch((t=>{error(t),UseDebug||(this.appStateShareError=!0)})).finally((()=>{this.appStateIsGettingTinyURL=!1})),UseDebug&&this.ShareText(i,this.appDataShareURL)}},ReportPuzzle(t,e){t.preventDefault(),t.stopPropagation(),note("ReportPuzzle()"),location.href="mailto:bigtentgames@icloud.com?subject=Facets Puzzle Reported&body=Puzzle ID# "+e.key+"%0D%0A This puzzle contains offensive language.%0D%0A"+e.hints},ConstructAndSetShareURLForCurrentGame(t,e=!1){if(note("ConstructAndSetShareURLForCurrentGame()"),this.appStateIsGuessing){this.currentGameSolutionGuessing!==this.currentGameSolutionActual&&(this.currentGameSolutionGuessing="");let a="",s="";this.appDataCards.concat(this.appDataCardsParked).forEach((t=>{0===t.words.length&&(s+="::::"),t.words.forEach((t=>{s+=t.id+":"}))})),this.appDataHints.forEach(((t,e)=>{t.value=t.value.trim();let a=encodeURIComponent(t.value);s+=a+(e===this.appDataHints.length-1?"":":")})),a=encodeURIComponent(a),a+="?sendingName="+encodeURIComponent(this.appDataPlayerCurrent.name),a+="&generated="+encodeURIComponent(!!this.currentDaily||this.isAIGenerating),this.currentDaily&&(a+="&key="+encodeURIComponent(this.currentDaily.key),this.currentDaily.quit&&(a+="&quit=true")),a+="&puzzleName="+encodeURIComponent(this.appDataPlayerCreator.name),a+="&puzzleID="+encodeURIComponent(this.appDataPlayerCreator.id),a+="&lang="+(!1===e?encodeURIComponent(this.currentGameLanguage):encodeURIComponent(this.userSettingsLanguage)),a+="&wordSetID="+encodeURIComponent(this.currentGameGuessingWordSet.id),e&&(a+="&isNew=true"),a+="&sendingID="+encodeURIComponent(this.appDataPlayerCurrent.id),a+="&useExtraCard="+encodeURIComponent(5===this.currentGameGuessingCardCount),a+="&sol="+encodeURIComponent(this.currentGameSolutionActual),t&&(a+="&final=true"),a=window.location.origin+window.location.pathname+a+"&board="+s,this.appDataShareURL=a,history.pushState(null,null,this.appDataShareURL)}},GetMessageBasedOnTrayCount(e,a){note("GetMessageBasedOnTrayCount()");let s=this.numberOfCardsThatHaveBeenPlacedOnTray,i="";this.numberOfCardsThatHaveBeenPlacedOnTray<4&&(i=s+"/4 "),4!==s||"reviewer"!==this.appDataPlayerCurrent.role||e||(s=5);let r=t.levelMessage[s][getRandomInt(0,t.levelMessage[s].length)],n=""!==a,o=n?a+", ":"",p=n&&0!==r.indexOf("I ");r=p?r.charAt(0).toLowerCase()+r.slice(1):r;let h=i+t.levelEmoji[s][getRandomInt(0,t.levelEmoji[s].length)]+" "+o+r;return 4===s&&this.currentDaily&&this.currentDaily.quit&&(h="AI is hard! \nWe're working hard to make these Daily Facets better to play."),h},GetShareTextBasedOnContext(t){note("GetShareTextBasedOnContext()");let e="",a=this.currentGameGuessingWordSet.startsWithVowel?"an ":"a ";return a=5===this.currentGameGuessingCardCount?"a ":a,e=this.appDataPlayerCurrent.id===this.appDataPlayerSender.id&&this.appDataPlayerCurrent.id===this.appDataPlayerCreator.id?"🧠"+this.currentGameGuessingWordSet.emoji+(5===this.currentGameGuessingCardCount?"⭐️":"")+" I created "+a+(5===this.currentGameGuessingCardCount?"5-card ":"")+'"'+this.currentGameGuessingWordSet.name+'" word puzzle for you to solve!':"reviewer"===this.appDataPlayerCurrent.role?this.GetMessageBasedOnTrayCount(t,this.currentGameGuessersName):"🤔 "+this.appDataPlayerCreator.name+", here's my guess!",e},SwapCards(e,a){note("SwapCards()");let s=new t.CardObject(e),i=new t.CardObject(a);e.words=i.words,e.rotation=i.rotation,e.isSelected=!1,e.justDropped=!0,e.wrongGuesses=i.wrongGuesses,a.words=s.words,a.rotation=s.rotation,a.isSelected=!1,a.justDropped=!0,a.wrongGuesses=s.wrongGuesses,setTimeout((()=>{this.appDataCards.concat(this.appDataCardsParked).forEach((t=>{t.justDropped=!1}))}),this.appDataTransitionLong),this.appStateIsDragging=!1,this.appDataDraggedCard=this.appDataEmptyCard,this.ConstructAndSetShareURLForCurrentGame()},HandleCardClick(t,e){t.preventDefault(),t.stopPropagation(),this.ToggleCardSelection(e)},ToggleCardSelection(t){if(this.appStateIsGuessing&&this.currentGameSolutionGuessing===this.currentGameSolutionActual)return;if(note("ToggleCardSelection()"),this.selectedCard&&this.selectedCard!==t)return void this.SwapCards(this.selectedCard,t);let e=!t.isSelected;this.appDataCards.forEach((t=>{t.isSelected=!1,t.isInTray=!0,t.justDropped=!1})),this.appDataCardsParked.forEach((t=>{t.isSelected=!1,t.isInTray=!1,t.justDropped=!1})),t.isSelected=0!==t.words.length&&e,document.body.offsetHeight<=660&&!this.appStateIsModalShowing&&(this.appStateIsModalShowing=!0),t.isSelected&&(this.appDataDraggedCard=t)},RotateCard(t,e,a){note("RotateCard()"),t.preventDefault(),t.stopPropagation(),this.appDataTransitionShort=parseInt(getComputedStyle(document.body).getPropertyValue("--mediumTransition").replace("ms","")),this.appStateIsGuessing&&(!this.vsUseFocus||this.vsUseFocus&&"parking"!==t.target.parentElement.parentElement.id)&&(this.appDataMessage="",this.appDataTimeoutCardRotation&&(clearTimeout(this.appDataTimeoutCardRotation),this.appDataTimeoutCardRotation=null),e.isSelected=!1,e.rotation=e.rotation+a,e.isRotating=!0,this.appDataTimeoutCardRotation=setTimeout((()=>{this.ResetCardsAfterRotation()}),this.appDataTransitionShort))},ResetCardsAfterRotation(t=!0){note("ResetCardsAfterRotation()"),this.appDataCards.concat(this.appDataCardsParked).forEach((t=>{if(0!==t.rotation){t.isRotating=!1;let e=t.words.length;if(e>0){let a=(t.rotation%e+e)%e;t.words=t.words.slice(-a).concat(t.words.slice(0,-a))}t.rotation=0}})),this.appStateIsGuessing&&t&&(this.ConstructAndSetShareURLForCurrentGame(),this.CheckIfAnyCardsGuesssAlreadyTried())},RotateTrayBasedOnInputFocus(t,e=!0){if(note("RotateTrayBasedOnInputFocus()"),0!=t)switch(t){case 0:this.RotateTray(0,e);break;case 1:this.RotateTray(-1,e);break;case 2:this.RotateTray(1,e);break;case 3:this.RotateTray(-2,e);break}},RotateTray(t,e=!0){if(note("RotateTray()"),!this.appStateTrayIsRotating)if(this.appDataMessage="",this.appStateTrayIsRotating=!0,this.appDataTimeoutTrayRotation&&(clearTimeout(this.appDataTimeoutTrayRotation),this.appDataTimeoutTrayRotation=null),this.selectedCard&&(this.selectedCard.isSelected=!1),this.appStateTrayRotation=this.appStateTrayRotation+t,document.getElementById("parkingInput").focus(),e&&!this.appStateSolving)this.appDataTimeoutTrayRotation=setTimeout((()=>{this.ResetTrayAfterRotation()}),this.appDataTransitionLong),this.appStateIsGuessing||setTimeout((()=>{let t=document.getElementById("hint0");this.appDataParkingInputValue="",t.focus()}),this.appDataTransitionLong);else if(this.ResetTrayAfterRotation(),!this.appStateIsGuessing){let t=document.getElementById("hint0");this.appDataParkingInputValue="",t.focus()}},ResetTrayAfterRotation(){if(note("ResetTrayAfterRotation()"),this.appStateTrayIsRotating=!1,this.appDataParkingInputValue="",this.appStateTrayRotation<3){if(0!==this.appStateTrayRotation){let t=this.appDataHints.length;if(t>0){let e=(this.appStateTrayRotation%t+t)%t;this.appDataHints=this.appDataHints.slice(-e).concat(this.appDataHints.slice(0,-e))}}let t=this.appDataHints[0],e=this.appDataHints[1],a=this.appDataHints[2],s=this.appDataHints[3],i=this.appDataCards[0],r=this.appDataCards[1],n=this.appDataCards[2],o=this.appDataCards[3];switch(i.rotation=r.rotation=n.rotation=o.rotation=this.appStateTrayRotation,this.ResetCardsAfterRotation(!1),this.appStateTrayRotation){case-1:this.appDataHints[0]=t,this.appDataHints[1]=a,this.appDataHints[2]=s,this.appDataHints[3]=e,this.appDataCards[0]=r,this.appDataCards[2]=i,this.appDataCards[1]=o,this.appDataCards[3]=n;break;case 1:this.appDataHints[0]=s,this.appDataHints[1]=e,this.appDataHints[2]=t,this.appDataHints[3]=a,this.appDataCards[0]=n,this.appDataCards[1]=i,this.appDataCards[2]=o,this.appDataCards[3]=r;break;case 2:case-2:this.appDataHints[0]=e,this.appDataHints[1]=t,this.appDataHints[2]=s,this.appDataHints[3]=a,this.appDataCards[0]=o,this.appDataCards[1]=n,this.appDataCards[2]=r,this.appDataCards[3]=i;break;default:break}this.ConstructAndSetShareURLForCurrentGame(),this.CheckIfAnyCardsGuesssAlreadyTried()}this.appStateTrayRotation=0},GetScrollSize(){const t=document.getElementById("parking");return t.scrollWidth-t.clientWidth},ConvertToDateFromKey(t){let e=t.substring(2,4),a=t.substring(4,8),s=t.substring(0,2)-1;return new Date(a,s,e)},GetDateFormatted(t,e=!1){const a=e?0:1;let s=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+a).padStart(2,"0"),r=t.getFullYear(),n=i+s+r;if(e){let t=new Date(r,i,s),e={month:"short",day:"numeric"};n=new Intl.DateTimeFormat(void 0,e).format(t)}return n},GetIsAIGenerated(){if(this.currentDaily)return!0;if(window.location.search){let t=new URLSearchParams(window.location.search);return t.has("generated")&&"true"===t.get("generated").toString()}return!1},GetBoardFromURL(){let t=[];if(window.location.search){let e=new URLSearchParams(window.location.search);UseDebug=!!e.has("useDebug")||UseDebug;decodeURIComponent(window.location.search);t=e.has("board")?e.get("board").split(":"):[]}return t},GetTodaysDaily(){let t=new Date;return this.dailyGamesWithWordSetNames.find((e=>e.key===this.GetDateFormatted(t)))},async NewGame(e,a="",s=!0){note("NewGame()"),document.title="Facets!",this.appDataMessage=a,this.currentGameGuessCount=0,this.appCurrentDailyGameKey=-1,this.currentGameLanguage="",this.currentGameReviewIsFinal=!1,this.currentGameGuessersName="",this.appDataPlayerCurrent.role="creator",this.appDataPlayerCreator.id=this.appDataPlayerCurrent.id,this.appDataPlayerCreator.name=this.appDataPlayerCurrent.name,this.appDataPlayerSender.id=this.appDataPlayerCurrent.id,this.appDataPlayerSender.name=this.appDataPlayerCurrent.name,this.currentGameGuessingWordSet=this.currentGameWordSet,this.currentGameGuessingCardCount=this.userSettingsUseExtraCard?5:4,this.currentGameSolutionGuessing="",this.appStateTrayIsRotating=!1,this.appStateForceAutoCheck=!1,this.appStateShowMeta=!1,this.SetWordSetTheme(this.currentGameWordSet),this.appDataShareURL="",history.pushState(null,null,window.location.origin+window.location.pathname),this.appStateIsGuessing=!1,this.appDataCards=[],this.appDataCardsParked=[new t.CardObject({}),new t.CardObject({}),new t.CardObject({}),new t.CardObject({}),new t.CardObject({}),new t.CardObject({})],this.appDataHints=[new t.WordObject({}),new t.WordObject({}),new t.WordObject({}),new t.WordObject({})],await this.CreateCardsForPlayer(null),s&&this.RotateTray(-4)},async OnMount(){this.$nextTick((async()=>{await this.GetUserSettings(),this.LoadPage()}))},async LoadPage(){note("LoadPage()"),highlight(`Player ${this.appDataPlayerCurrent.id} has loaded version ${this.appDataVersion}`,!0),this.GetDailyGames(),this.GetRecentAnonymousGames(),this.appDataTransitionLong=parseInt(getComputedStyle(document.body).getPropertyValue("--longTransition").replace("ms","")),this.appDataTransitionShort=parseInt(getComputedStyle(document.body).getPropertyValue("--shortTransition").replace("ms",""));let t=this.GetBoardFromURL();try{t.length>=40?(document.title="Facets!",this.ToggleShowMeta(null),await this.RestoreGame(t)):this.appStateIsGuessing||(this.isAIGenerating&&(this.currentGameGuessingCardCount=4,this.appDataPlayerCurrent.id=0,this.currentGameWordSet=this.enabledWordSets.find((t=>"100"===t.id)),note(this.currentGameWordSet.name),this.SelectWordSet(null,this.currentGameWordSet),note(this.currentGameWordSet.name),setTimeout((()=>{this.GetAISolution()}),2e3)),0===this.appDataCards.length&&0===this.appDataCardsParked.length&&(this.NewGame(null,"",!1),this.ToggleShowMeta(null)))}catch(e){error(e.message),t=[],this.NewGame(null,"😕 - Something went wrong.",!1),this.ToggleShowMeta(null)}setTimeout((()=>{this.appStatePageHasLoaded=!0}),400),this.appStateUsePortraitLayout=document.body.offsetHeight>document.body.offsetWidth},DeregisterServiceWorkers(){"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then((function(t){for(let e of t)e.unregister()})).catch((function(t){}))},EnableDailyReminders(){return new Promise(((t,e)=>{"granted"===Notification.permission?t(!0):Notification.requestPermission().then((e=>{"granted"===e?(this.HandleServiceWorkerRegistration(),t(!0)):t(!1)})).catch((t=>{e(t)}))}))},HandleServiceWorkerRegistration(){note("HandleServiceWorkerRegistration()")},HandleVersionAvailable(){note("HandleVersionAvailable()")}},async mounted(){UseDebug=-1!=document.location.href.indexOf("local")||-1!=document.location.href.indexOf("debug=true"),await this.OnMount(),this.DeregisterServiceWorkers(),window.addEventListener("keydown",this.HandleKeyDownEvent),window.addEventListener("pointermove",this.HandlePointerMoveEvent),window.addEventListener("visibilitychange",this.HandlePageVisibilityChange),window.addEventListener("resize",this.HandleResize),window.addEventListener("popstate",this.HandlePopState)},beforeDestroy(){window.removeEventListener("keydown",this.HandleKeyDownEvent),window.removeEventListener("pointermove",this.HandlePointerMoveEvent),window.removeEventListener("visibilitychange",this.HandlePageVisibilityChange),window.removeEventListener("resize",this.HandleResize),window.removeEventListener("popstate",this.HandlePopState)},watch:{tempWordSetName(t){let e=this.enabledTempWordSet.find((e=>e.name===t));this.SetWordSetTheme(e)},tempUseWordSetThemes(t){this.SetWordSetTheme(this.currentGameWordSet)},tempUserSettingsHueIndex(t){this.documentCssRoot.style.setProperty("--hueTheme",this.currentHueSet[t]),this.tempUserSettingsUsesLightTheme?document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 92%)":document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 3%)"},tempUserSettingsUsesLightTheme(t){this.documentCssRoot.style.setProperty("--hueTheme",this.currentHueSet[this.tempUserSettingsHueIndex]),document.getElementById("themeColor").content=t?"hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 92%)":"hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 3%)"},userSettingsLanguage(){this.LoadTranslatedWords()},appStateFirstRunGuessingIndex:async function(e){e<=this.appDataGuessingFirstRunItems.length&&(await t.SaveData("appStateFirstRunGuessingIndex",e),setTimeout((()=>{requestAnimationFrame((()=>{this.UpdatePointerTargetLocation()}))}),100))},appStateFirstRunReviewingIndex:async function(e){e<=this.appDataReviewingFirstRunItems.length&&(await t.SaveData("appStateFirstRunReviewingIndex",e),setTimeout((()=>{requestAnimationFrame((()=>{this.UpdatePointerTargetLocation()}))}),100))},appStateFirstRunCreatingIndex:async function(e){e<=this.appDataCreatorFirstRunItems.length&&(await t.SaveData("appStateFirstRunCreatingIndex",e),setTimeout((()=>{requestAnimationFrame((()=>{this.UpdatePointerTargetLocation()}))}),100))},isAIGenerated(){return this.GetIsAIGenerated()},appStateIsGuessing(){this.appStateIsGuessing&&-1===this.appStateFirstRunGuessingIndex&&this.appStateFirstRunGuessingIndex++},pointerText(){requestAnimationFrame((()=>{this.UpdatePointerTargetLocation()}))}},computed:{selectedCard(){return this.appDataCards.concat(this.appDataCardsParked).find((t=>!0===t.isSelected))},allPlayerCards(t){return this.appDataCards.concat(this.appDataCardsParked).find((e=>e.id.indexOf(0===t)))},allCards(){let t=this.appDataCards.concat(this.appDataCardsParked).filter((t=>t.words.length>0));return t.forEach((t=>{t.id=this.GetUniqueCardId(t.words)})),t=t.sort(((t,e)=>t.id-e.id)),t},firstThreeParkedCards(){return this.appDataCardsParked.splice(0,3)},fullCardsInTray(){return this.appDataCards.filter((t=>t.words.length>0))},emptyCardsInTray(){return this.appDataCards.filter((t=>0===t.words.length))},numberOfCardsThatHaveBeenPlacedOnTray(){return void 0===this.appDataCards?0:this.fullCardsInTray.length},numberOfHintsThatHaveBeenFilled(){return void 0===this.appDataHints?0:this.appDataHints.filter((t=>""!=t.value)).length},uniqueCardId(t){return this.GetUniqueCardId(t)},firstAvailableParkingSpot(){return this.appDataCardsParked.find((t=>0===t.words.length))},playerMessage(){clearTimeout(this.appDataTimeoutNotification);let t=2200,e=this.currentGameGuessingWordSet.startsWithVowel?"an":"a",a=this.appStateForceAutoCheck?e:this.appDataPlayerCreator.name+"'s ",s="";if(""!==this.appDataMessage)s=this.appDataMessage,this.currentDaily&&this.currentDaily.solved&&(t=1e4);else if(this.appStateIsGuessing||-1===this.appDataPlayerCurrent.id)if(this.appDataPlayerCurrent.id===this.appDataPlayerSender.id&&-1!==this.appDataPlayerCurrent.id&&this.appDataPlayerCurrent.id===this.appDataPlayerCreator.id)s=`${this.appDataPlayerCurrent.name}, this is your own puzzle!`,t=1700;else if(this.currentGameReviewIsFinal&&-1!==this.appDataPlayerCurrent.id)s=`${this.appDataPlayerCurrent.name}, here's the solution.`;else if(this.appDataPlayerCurrent.id!==this.appDataPlayerSender.id&&this.appDataPlayerCurrent.id===this.appDataPlayerCreator.id&&-1!==this.appDataPlayerCurrent.id)s=`You are reviewing ${this.appDataPlayerSender.name}'s guess!`,t=1700;else if(this.currentDaily){new Date;s=`<name>The Daily Facet – ${this.currentDaily.date.split(",")[0]}</name><subtitle>Puzzle category – "${this.currentGameGuessingWordSet.name}"</subtitle>`,this.currentDaily.key===this.todaysDaily.key&&(s=`The Daily Facet – Today<subtitle>Puzzle category –  "${this.currentGameGuessingWordSet.name}"</subtitle>`)}else s=`You are guessing ${a} "${this.currentGameGuessingWordSet.name}" puzzle!`;else s=`You are creating a new "${this.currentGameGuessingWordSet.name}" puzzle!`,t=1700;return 2e4!==t&&(this.appDataTimeoutNotification=setTimeout((()=>{this.appStateShowNotification=!1}),t)),s},enabledWordSets(){return this.appDataWordSets.filter((t=>t.enabled))},enabledTempWordSets(){return this.tempWordSets.filter((t=>t.enabled))},enabledTempWordSetNames(){let t=[];return this.appDataWordSets.forEach((e=>{e.enabled&&t.push(e.name)})),t.sort(((t,e)=>t.localeCompare(e,void 0,{sensitivity:"base"})))},enabledTempWordSet(){let t=[];return this.appDataWordSets.forEach((e=>{e.enabled&&t.push(e)})),t.sort(((t,e)=>t.name.localeCompare(e.name,void 0,{sensitivity:"base"})))},enabledTempLanguages(){let t=[];return this.appDataLanguages.forEach((e=>{e.enabled&&t.push({name:e.name,tag:e.tag})})),t.sort(((t,e)=>t.name.localeCompare(e.name,void 0,{sensitivity:"base"})))},currentSelectedTempWordSetName(){return this.appDataWordSets.find((t=>t.isSelected)).name},submitButtonText(){let t=this.appDataActionButtonTexts.send;return this.appStateShareError?"Retry":("reviewer"===this.appDataPlayerCurrent.role?t=this.appDataActionButtonTexts.respond:"creator"===this.appDataPlayerCurrent.role&&(t=this.appDataActionButtonTexts.send),this.appDataPlayerCurrent.id!==this.appDataPlayerCreator.id&&(this.appStateForceAutoCheck&&(t=this.currentDaily&&!this.currentDaily.solved&&this.currentDaily.guesses>1&&4!==this.numberOfCardsThatHaveBeenPlacedOnTray?this.appDataActionButtonTexts.quit:this.appDataActionButtonTexts.guess),this.isChromeAndiOSoriPadOS&&this.appDataShareURL.includes("facets.bigtentgames.com/game/?")&&(t=this.appDataActionButtonTexts.copy),this.currentGameSolutionGuessing===this.currentGameSolutionActual&&(t=this.currentDaily?this.appDataActionButtonTexts.share:this.appDataActionButtonTexts.create)),t)},createdGamesWithWordSetNames(){return this.appDataGlobalCreatedGames.map((t=>{const e=this.appDataWordSets.find((e=>e.id===t.wordSetID));return e?{...t,name:e.name}:t}))},todaysKey(){let t=new Date;return this.GetDateFormatted(t)},todaysDaily(){return this.GetTodaysDaily()},currentDaily(){let t=this.dailyGamesWithWordSetNames.find((t=>t.key===this.appCurrentDailyGameKey));return t||null},dailyIsFreshToday(){if(void 0===this.todaysDaily)return!1;const t=0===this.todaysDaily.guesses&&!this.HasUserStartedGame(this.todaysDaily)&&!this.appStateIsGettingDailyGames&&!this.appStateIsGettingUserStats;return this.isBadgeSupported&&(t?navigator.setAppBadge():navigator.clearAppBadge()),t},dailyGamesWithWordSetNames(){return this.appDataDailyGames.map((t=>{t.date=this.GetDateFormatted(this.ConvertToDateFromKey(t.key),!0);const e=this.appDataWordSets.find((e=>e.id===t.wordSetID));return e&&(t.name=e.name),t}))},isChromeAndiOSoriPadOS(){note("isChromeAndiOSoriPadOS()");var t=navigator.userAgent||window.opera,e=/CriOS/.test(t)&&/iPhone|iPad|iPod/.test(t);return t=t.toLowerCase(),e||t.includes("firefox")&&t.includes("android")},isAIGenerating:()=>-1!==window.location.href.indexOf(window.location.origin+"/generate.html"),isAIGenerated(){return this.GetIsAIGenerated()},actionButtonState(){let t=!1;return 4!==this.numberOfCardsThatHaveBeenPlacedOnTray&&this.currentDaily&&this.currentDaily.guesses>1&&!this.currentDaily.quit?t=!1:(4!==this.numberOfHintsThatHaveBeenFilled&&"creator"===this.appDataPlayerCurrent.role||4!==this.numberOfCardsThatHaveBeenPlacedOnTray&&"reviewer"!==this.appDataPlayerCurrent.role&&this.appDataPlayerCurrent.id!==this.appDataPlayerCreator.id)&&(t=!0),t},correctCalIconClass(){let t=this.currentDaily.date,e=parseInt(t.split(" ")[1]);const a=new Date;let s=new Date(a.getFullYear(),a.getMonth()+1,0).getDate()/12;return`cal${Math.ceil(e/s)}`},resumeText(){let t="";switch(this.appDataPlayerCurrent.role){case"creator":t="Creating";break;case"reviewer":t="Reviewing";break;case"guesser":t="Guessing";break}return t},isSyncSupported:()=>!!UseDebug||"SyncManager"in window,isNotificationSupported:()=>!!UseDebug||"Notification"in window,isBadgeSupported:()=>void 0!==navigator.setAppBadge&&null!==navigator.setAppBadge,isPWAOnHomeScreen:()=>window.matchMedia("(display-mode: standalone)").matches,isUserFocusedOnGame(){return!(this.appStateShowNotification||this.appStateIsModalShowing||this.appStateShowMeta||this.appStateShowTutorial||this.appStateShowConfirmation||this.appStateShowIntro||this.appStateShowInfo||this.appStateShowCatChooser||this.appStateShowSettings||this.appStateShowGlobalCreated||this.appStateShowDailyGames)},isPlayerCreating(){return"creator"===this.appDataPlayerCurrent.role},isPlayerGuessing(){return"guesser"===this.appDataPlayerCurrent.role},isPlayerReviewing(){return"reviewer"===this.appDataPlayerCurrent.role},hidePointer(){return!this.isUserFocusedOnGame||this.isPlayerReviewing&&this.appStateFirstRunReviewingIndex>=this.appDataReviewingFirstRunItems.length||this.isPlayerCreating&&this.appStateFirstRunCreatingIndex>=this.appDataCreatorFirstRunItems.length||this.isPlayerGuessing&&this.appStateFirstRunGuessingIndex>=this.appDataGuessingFirstRunItems.length||!this.isPlayerCreating&&!this.isPlayerReviewing&&this.isSolved},pointerInPlay(){return this.appStateFirstRunGuessingIndex>0&&this.appStateFirstRunGuessingIndex<this.appDataGuessingFirstRunItems.length&&this.isPlayerGuessing||this.appStateFirstRunCreatingIndex>0&&this.appStateFirstRunCreatingIndex<this.appDataCreatorFirstRunItems.length&&this.isPlayerCreating||this.appStateFirstRunReviewingIndex>0&&this.appStateFirstRunReviewingIndex<this.appDataReviewingFirstRunItems.length&&this.isPlayerReviewing},isSolved(){return this.currentGameSolutionGuessing===this.currentGameSolutionActual},pointerText(){let t="",e=this.isAIGenerated||0===this.appDataPlayerCreator.id?1:0;switch(this.appDataPlayerCurrent.role){case"guesser":this.appDataGuessingFirstRunItems[this.appStateFirstRunGuessingIndex]&&(e=1===this.appDataGuessingFirstRunItems[this.appStateFirstRunGuessingIndex].length?0:e,t=this.appDataGuessingFirstRunItems[this.appStateFirstRunGuessingIndex][e]);break;case"creator":this.appDataCreatorFirstRunItems[this.appStateFirstRunCreatingIndex]&&(e=1===this.appDataCreatorFirstRunItems[this.appStateFirstRunCreatingIndex].length?0:e,t=this.appDataCreatorFirstRunItems[this.appStateFirstRunCreatingIndex][e],this.appDataCards.length>0&&this.appDataCards[0].words.length>0&&this.appDataCards[1].words.length>0&&(t=t.replace("word1",this.appDataCards[0].words[0].value),t=t.replace("word2",this.appDataCards[1].words[0].value)));break;case"reviewer":this.appDataReviewingFirstRunItems[this.appStateFirstRunReviewingIndex]&&(e=1===this.appDataReviewingFirstRunItems[this.appStateFirstRunReviewingIndex].length?0:e,t=this.appDataReviewingFirstRunItems[this.appStateFirstRunReviewingIndex][e]);break}return t},tipSubmitText(){let t="Next";return(this.isPlayerGuessing&&this.appStateFirstRunGuessingIndex===this.appDataGuessingFirstRunItems.length-1||this.isPlayerCreating&&this.appStateFirstRunCreatingIndex===this.appDataCreatorFirstRunItems.length-1||this.isPlayerReviewing&&this.appStateFirstRunReviewingIndex===this.appDataReviewingFirstRunItems.length-1)&&(t="Okay"),t},resumeText(){return this.isPlayerCreating?"Continue Creating":this.isPlayerGuessing?"Resume Guessing":this.isPlayerReviewing?"Resume Reviewing":void 0},tipsHaveBeenIncremented(){return this.appStateFirstRunGuessingIndex>0||this.appStateFirstRunCreatingIndex>0||this.appStateFirstRunReviewingIndex>0},currentYear:()=>(new Date).getFullYear(),tempIDisInvalid(){return this.tempID.toString().length<8||0===this.tempID.toString().indexOf("0")},tooSmall:()=>window.innerHeight<602,loadSimplifiedTheme(){return this.appStateUseFlower||this.userSettingsUsesSimplifiedTheme},currentHueSet(){return this.appDataHues},bottomParkingCards(){let t=[];for(let e=0;e<this.appDataCardsParked.length;e++)e<this.currentGameGuessingCardCount&&t.push(this.appDataCardsParked[e]);return t},leftParkingCards(){let t=[];for(let e=0;e<this.appDataCardsParked.length;e++)e<this.currentGameGuessingCardCount/2&&t.push(this.appDataCardsParked[e]);return t},rightParkingCards(){let t=[];for(let e=0;e<this.appDataCardsParked.length;e++)e>=this.currentGameGuessingCardCount/2&&e<this.currentGameGuessingCardCount&&t.push(this.appDataCardsParked[e]);return t}}});e.config.compilerOptions.isCustomElement=t=>["app","pointer","arrow","splash","preload","notification","message","icon","subtitle","badge","modal","controls","confirmation","checkbox","toggle","legal","credit","version","categories","category","leftright","small","callout","instructions","gamelinks","gamelink","stats","stat","value","flogo","count","rotators","ghost","card","words","word","parking","spot","tray","diamond","hints","hint","cards","cta","dot","clues","hues","hue"].includes(t),window.app=e.mount("#app")}));