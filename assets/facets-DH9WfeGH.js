import{_ as v,o as U,l as k}from"./gameplay-D8WbgvML.js";const A="2.5.49";function b(r={}){const{immediate:S=!1,onNeedRefresh:e,onOfflineReady:t,onRegistered:a,onRegisteredSW:s,onRegisterError:i}=r;let n,o,l;const h=async(p=!0)=>{await o,l?.()};async function d(){if("serviceWorker"in navigator){if(n=await v(async()=>{const{Workbox:p}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:p}},[]).then(({Workbox:p})=>new p("/sw.js",{scope:"/",type:"classic"})).catch(p=>{i?.(p)}),!n)return;l=()=>{n?.messageSkipWaiting()};{let p=!1;const c=()=>{p=!0,n?.addEventListener("controlling",u=>{u.isUpdate&&window.location.reload()}),e?.()};n.addEventListener("installed",u=>{typeof u.isUpdate>"u"?typeof u.isExternal<"u"&&u.isExternal?c():!p&&t?.():u.isUpdate||t?.()}),n.addEventListener("waiting",c)}n.register({immediate:S}).then(p=>{s?s("/sw.js",p):a?.(p)}).catch(p=>{i?.(p)})}}return o=d(),h}async function x(){const{SaveData:r,GetData:S,RemoveData:e,ClearStore:t}=await v(async()=>{const{SaveData:i,GetData:n,RemoveData:o,ClearStore:l}=await import("./db-helper.min-BQEKyS0D.js");return{SaveData:i,GetData:n,RemoveData:o,ClearStore:l}},[]),{GetUniqueWords:a,GetJustWords:s}=await v(async()=>{const{GetUniqueWords:i,GetJustWords:n}=await import("./word-helper.min-D0IcAM_Z.js");return{GetUniqueWords:i,GetJustWords:n}},[]);return{SaveData:r,GetData:S,RemoveData:e,ClearStore:t,GetUniqueWords:a,GetJustWords:s}}async function H(){const r=await k();return{...await x(),...r}}H().then(r=>{console.log("Modules loaded:",r);const S=U({data(){return{appDataVersion:A,appDataGuessingFirstRunItems:r.firstRunGuessingMessages,appDataCreatorFirstRunItems:r.firstRunCreatingMessages,appDataReviewingFirstRunItems:r.firstRunReviewingMessages,appDataActionButtonTexts:{send:"Send",guess:"Guess",reply:"Reply",copy:"Copy",respond:"Respond",create:"Create",share:"Share",quit:"Give up"},appDataCards:[],appDataCardsParked:[],appDataLanguages:r.allLanguages,appDataConfirmationObject:{message:"Did they have the right answer?",target:"correct"},appDataDraggedCard:new r.CardObject({}),appDataDraggedCardStartedInParkingLot:!1,appDataEmptyCard:new r.CardObject({id:"ghost"}),appDataGameCatchphrase:"A Puzzle Game of Words and Wits!",appDataGameName:"Facets",appDataGhostX:0,appDataGhostY:0,appDataParkingScrollLeft:0,appDataGlobalCreatedGames:[],appDataDailyGames:[],appDataUserDailyGamesStarted:[],appDataHints:[],appDataMessage:"",appDataParkingInputValue:"",appDataPlayerCurrent:new r.PlayerObject({}),appDataPlayerCreator:new r.PlayerObject({}),appDataPlayerSender:new r.PlayerObject({}),appDataPlayerStats:{g1:0,g2:0,beyond2:0,quit:0,total:0},appDataShareURL:"",appDataTimeoutCardRotation:null,appDataTimeoutTrayRotation:null,appDataTimeoutNotification:null,appDataTransitionLong:0,appDataTransitionShort:0,appDataWordSets:[...r.wordSets],appCurrentDailyGameKey:-1,appDailyIsFreshToday:!0,appDataNumberOfNewDailies:1,appDataDailyGamesStats:[],appDataInc:0,appDataAIResult:null,appDataHues:[215,265,315,355,25,140,184],appStateForceAutoCheck:!1,debounceTimeout:null,appStateAutoAdvanceTips:!0,appStateIsDragging:!1,appStateIsGettingTinyURL:!1,appStateIsGettingAnonymousGames:!1,appStateIsGettingDailyGames:!1,appStateIsGettingDailyGameStats:!1,appStateIsGettingUserStats:!1,appStateSolving:!1,appStateIsGuessing:!1,appStateIsModalShowing:!1,appStateIsNewVersionAvailable:!1,appStatePageHasLoaded:!1,appStateUserHasCreatedAGame:!1,appStateShowCatChooser:!1,appStateShowConfirmation:!1,appStateShowGlobalCreated:!1,appStateShowDailyGames:!1,appStateDailyCongrats:!1,appStateShowInfo:!1,appStateShowIntro:!1,appStateShowOOBE:!1,appStatePointerLocation:{left:-4e4,top:-4e4},appStatePointerArrowLocation:{x:-4e4,y:-4e4,arrowRotate:0},appStateFirstRunGuessingIndex:-1,appStateFirstRunCreatingIndex:-1,appStateFirstRunReviewingIndex:-1,appStateShowStats:!1,appStateShowSettings:!1,appStateShowTutorial:!1,appStateTrayIsRotating:!1,appStateTrayRotation:0,appStateUseNotifications:UseDebug,appStateUsePortraitLayout:!1,appStateShowNotification:!1,appParkingRightButtonDisabled:!1,appStateShowMeta:!0,vsShowDaily:!0,appStateUseFlower:!1,appStateBrowserNotificationInterval:null,appStateShareError:!1,appStatePWAHasUpdate:!1,appStateShowUpdateButton:!1,updateButtonTimeout:null,isOnline:!0,isAuthenticated:!1,userToken:null,userEmail:"",playerName:"Player",playerId:"",authLoading:!1,hasPlayedAsBTGAccountBefore:!1,authCheckInterval:null,facetsChannel:null,windowId:Math.random().toString(36).substr(2,9),currentGameGuessCount:0,currentGameGuessersName:"",currentGameLanguage:"",currentGameGuessingCardCount:4,currentGameGuessingWordSet:r.wordSets.find(e=>e.id==="100"),currentGameReviewIsFinal:!1,currentGameSolutionActual:"",currentGameSolutionGuessing:[],currentGameWordSet:r.wordSets.find(e=>e.id==="100"),userSettingsUseExtraCard:!1,userSettingsHideStats:!1,userSettingsUsesLightTheme:!1,userSettingsHueIndex:0,userSettingsUsesSimplifiedTheme:!1,userSettingsUseMultiColoredGems:!0,userSettingsUseWordSetThemes:!0,userSettingsUserWantsDailyReminder:!1,userSettingsShowAllCards:!0,userSettingsHideReviewAids:!1,appStateShowCreateOOBE:!1,userSettingsStreaks:[],vsUseFocus:!0,userSettingsLanguage:"en-us",userSettingsLegalAccepted:!1,userSettingsNoSnark:!1,tempName:"",tempID:0,tempShareURLCode:"",tempUseMultiColoredGems:!0,tempUserSettingsUsesLightTheme:!1,tempUserSettingsHueIndex:0,tempUserSettingsUsesSimplifiedTheme:!1,tempUserSettingsShowAllCards:!1,tempUserSettingsHideReviewAids:!1,tempUseWordSetThemes:!0,tempUserWantsDailyReminder:!1,tempUserSettingsHideStats:!1,tempWordSetName:"",tempUsePortraitLayout:!1,tempUseExtraCard:!1,tempWordSets:[],tempUserSettingsLanguage:"en-us",tempUserSettingsNoSnark:!1,documentCssRoot:document.querySelector(":root"),cssStyles:window.getComputedStyle(document.querySelector(":root")),facetsChannel:new BroadcastChannel("facets_main"),windowId:Math.random().toString(36).substr(2,9)}},methods:{ToggleShowTutorial(e){note("ToggleShowTutorial()"),e!=null&&(e.stopPropagation(),e.preventDefault()),this.appStateShowTutorial=!this.appStateShowTutorial,this.appStateShowCreateOOBE=!1},ToggleUseLightTheme(e){note("ToggleUseLightTheme()"),this.userSettingsUsesLightTheme=e,this.userSettingsUsesLightTheme?document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 92%)":document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 3%)"},ToggleUseSimplifedTheme(e){note("ToggleUseSimplifedTheme()"),this.userSettingsUsesSimplifiedTheme=e,this.userSettingsUsesSimplifiedTheme&&(this.tempUseMultiColoredGems=!0)},ToggleShowAllCards(e){note("ToggleShowAllCards()"),this.userSettingsShowAllCards=e},ToggleUnaidedReview(e){note("ToggleUnaidedReview()"),this.userSettingsHideReviewAids=e},ToggleFocus(){note("ToggleFocus()"),window.innerWidth<=660&&(this.vsUseFocus=!this.vsUseFocus)},async ToggleShowGlobalCreated(e){note("ToggleShowGlobalCreated()"),e!=null&&(e.stopPropagation(),e.preventDefault()),this.appStateShowGlobalCreated=!this.appStateShowGlobalCreated,this.appDataGlobalCreatedGames.length===0&&this.GetRecentAnonymousGames()},async ToggleShowDailyGames(e){note("ToggleShowDailyGames()"),e!=null&&(e.stopPropagation(),e.preventDefault()),this.appStateShowDailyGames=!this.appStateShowDailyGames},ToggleShowInfo(e){note("ToggleShowInfo()"),e!=null&&(e.stopPropagation(),e.preventDefault()),this.appStateShowInfo=!this.appStateShowInfo},ToggleShowMeta(e){note("ToggleShowMeta()"),e!=null&&(e.stopPropagation(),e.preventDefault()),this.appStateShowMeta=!this.appStateShowMeta},SetTempLanguage(e){note("SetTempLanguage()"),this.tempUserSettingsLanguage=e},ToggleTempUseWordSetThemes(){note("ToggleTempUseWordSetThemes()"),this.tempUseWordSetThemes=!this.tempUseWordSetThemes},ToggleTempNoSnark(){note("ToggleTempNoSnark()"),this.tempUserSettingsNoSnark=!this.tempUserSettingsNoSnark},async ToggleTempUserWantsDailyReminder(){note("ToggleTempUserWantsDailyReminder()"),this.tempUserWantsDailyReminder=!this.tempUserWantsDailyReminder,this.tempUserWantsDailyReminder&&this.isNotificationSupported&&(await this.EnableDailyReminders()?this.userSettingsUserWantsDailyReminder=this.tempUserWantsDailyReminder=!0:this.userSettingsUserWantsDailyReminder=this.tempUserWantsDailyReminder=!1)},SetHueIndex(e){note("SetHueIndex()"),this.tempUserSettingsHueIndex=e},ToggleTempUseLightTheme(){note("ToggleTempUseLightTheme()"),this.tempUserSettingsUsesLightTheme=!this.tempUserSettingsUsesLightTheme},ToggleTempHideStats(){note("ToggleTempHideStats()"),this.tempUserSettingsHideStats=!this.tempUserSettingsHideStats},ToggleTempUseSimplifiedTheme(){note("ToggleTempUseSimplifiedTheme()"),this.tempUserSettingsUsesSimplifiedTheme=!this.tempUserSettingsUsesSimplifiedTheme},ToggleTempShowAllCards(){note("ToggleTempShowAllCards()"),this.tempUserSettingsShowAllCards=!this.tempUserSettingsShowAllCards},ToggleTempUnaidedReview(){note("ToggleTempUnaidedReview()"),this.tempUserSettingsHideReviewAids=!this.tempUserSettingsHideReviewAids},ToggleTempUsePortraitLayout(){note("ToggleTempUsePortraitLayout()"),this.tempUsePortraitLayout=!this.tempUsePortraitLayout},ToggleTempUseMultiColoredGems(){note("ToggleTempUseMultiColoredGems()"),this.tempUseMultiColoredGems=!this.tempUseMultiColoredGems},ToggleTempUseExtraCard(){note("ToggleTempâ‰ˆUseExtraCard()"),this.tempUseExtraCard=!this.tempUseExtraCard},ShowCategoryPicker(){note("ShowCategoryPicker()"),this.tempWordSetName=this.currentSelectedTempWordSetName},ShowSettings(e){note("ShowSettings()"),e!=null&&(e.stopPropagation(),e.preventDefault()),this.appStateIsModalShowing=!0,this.appStateShowSettings=!0,this.GetCategoryNames()},GetCategoryNames(){this.tempWordSets=[],this.tempWordSetName=this.currentSelectedTempWordSetName,this.appDataWordSets.forEach(e=>{this.tempWordSets.push(new r.WordSetObject(e))}),this.tempName=this.appDataPlayerCurrent.name},AdvanceFirstRunIndexes(){if(this.isUserFocusedOnGame&&!this.appStateTipIsAnimating)switch(note("AdvanceFirstRunIndexes()"),this.appDataPlayerCurrent.role){case"guesser":this.isPlayerGuessing&&this.appStateFirstRunGuessingIndex<this.appDataGuessingFirstRunItems.length&&!this.isSolved&&(this.appStateTipIsAnimating=!0,setTimeout(()=>{this.appStateFirstRunGuessingIndex++,this.appStateTipIsAnimating=!1},240));break;case"creator":this.isPlayerCreating&&this.appStateFirstRunCreatingIndex<this.appDataCreatorFirstRunItems.length&&(this.appStateTipIsAnimating=!0,setTimeout(()=>{this.appStateFirstRunCreatingIndex++,requestAnimationFrame(()=>{this.isPlayerCreating&&this.appStateFirstRunCreatingIndex===3?document.getElementById("hint0").select():document.getElementById("hint0").blur(),this.appStateTipIsAnimating=!1})},240));break;case"reviewer":this.isPlayerReviewing&&this.appStateFirstRunReviewingIndex<this.appDataReviewingFirstRunItems.length&&(this.appStateTipIsAnimating=!0,setTimeout(()=>{this.appStateFirstRunReviewingIndex++,this.appStateTipIsAnimating=!1},240));break}},RetreatFirstRunIndexes(){if(this.isUserFocusedOnGame&&!this.appStateTipIsAnimating)switch(note("RetreatFirstRunIndexes()"),this.appDataPlayerCurrent.role){case"guesser":this.isPlayerGuessing&&this.appStateFirstRunGuessingIndex>0&&!this.isSolved&&(this.appStateTipIsAnimating=!0,setTimeout(()=>{this.appStateTipIsAnimating=!1,this.appStateFirstRunGuessingIndex--},240));break;case"creator":this.isPlayerCreating&&this.appStateFirstRunCreatingIndex>0&&(this.appStateTipIsAnimating=!0,setTimeout(()=>{this.appStateTipIsAnimating=!1,this.appStateFirstRunCreatingIndex--},240));break;case"reviewer":this.isPlayerReviewing&&this.appStateFirstRunReviewingIndex>0&&(this.appStateTipIsAnimating=!0,setTimeout(()=>{this.appStateTipIsAnimating=!1,this.appStateFirstRunReviewingIndex--},240));break}},async ResetFirstRun(){note("ResetFirstRun()"),this.ClearTrayOfCards(),this.appStateFirstRunCreatingIndex=0,this.appStateFirstRunReviewingIndex=0,this.appStateFirstRunGuessingIndex=this.isPlayerGuessing&&this.fullCardsInTray.length===4?1:0,await r.RemoveData("appStateFirstRunCreatingIndex"),await r.RemoveData("appStateFirstRunReviewingIndex"),await r.RemoveData("appStateFirstRunGuessingIndex")},EndAllFirstRunTips(){this.isUserFocusedOnGame&&!this.appStateTipIsAnimating&&(this.appStateFirstRunGuessingIndex=this.appDataGuessingFirstRunItems.length,this.appStateFirstRunCreatingIndex=this.appDataCreatorFirstRunItems.length,this.appStateFirstRunReviewingIndex=this.appDataReviewingFirstRunItems.length)},ReloadApp(){window.location.reload()},SetWordSetTheme(e){if(note("SetWordSetTheme()"),this.tempUseWordSetThemes)this.documentCssRoot.style.setProperty("--texture2","url("+e.textureImage+")"),this.documentCssRoot.style.setProperty("--textureSize",e.textureSize),this.documentCssRoot.style.setProperty("--textureBlendMode",e.textureBlendMode),this.documentCssRoot.style.setProperty("--textureHue",e.textureHue);else{let t=this.documentCssRoot.style.getPropertyValue("--textureSource");this.documentCssRoot.style.setProperty("--texture2",t),this.documentCssRoot.style.setProperty("--textureSize","cover"),this.documentCssRoot.style.setProperty("--textureBlendMode","normal");let a=this.documentCssRoot.style.getPropertyValue("--textureHueSource");this.documentCssRoot.style.setProperty("--textureHue",a)}this.documentCssRoot.style.setProperty("--wordScale",e.scale)},async LoadTranslatedWords(){note("LoadTranslatedWords()");let e=await this.GetCurrentGameWordSet(),t={};e.forEach(a=>{t[a.id]=a}),this.appDataCards.forEach(a=>{a.words.forEach(s=>{t[s.id]&&(s.value=t[s.id].value)})}),this.appDataCardsParked.forEach(a=>{a.words.forEach(s=>{t[s.id]&&(s.value=t[s.id].value)})})},async GetCurrentGameWordSet(){note("GetCurrentGameWordSet()");let e=[],t=this.userSettingsLanguage===""?"":this.userSettingsLanguage+"/";this.currentGameLanguage!==""&&(t=this.currentGameLanguage);let a=await this.currentGameWordSet.data.map(async s=>{let i=s.toString().replace("./data/","./data/"+t);return this.currentGameWordSet.noLanguage&&(i=s.toString().replace("./data/","./data/common/")),await(await fetch(i)).json()});try{let s=await Promise.all(a);e=[].concat(...s)}catch(s){error(s)}return e},async GetGuessingGameWordSet(){note("GetGuessingGameWordSet()");let e=this.userSettingsLanguage===""?"":this.userSettingsLanguage+"/";this.currentGameLanguage!==""&&(e=this.currentGameLanguage+"/");let t=[],a=this.currentGameGuessingWordSet.data.map(async s=>{let i=s.toString().replace("./data/","./data/"+e);return this.currentGameGuessingWordSet.noLanguage&&(i=s.toString().replace("./data/","./data/common/")),await(await fetch(i)).json()});try{let s=await Promise.all(a);t=[].concat(...s)}catch(s){error(s)}return t},async UpdateGameGuessesCount(e,t=!1){note("UpdateGameGuessesCount()");let a=this.GetUserStartedGame(e)??e;a&&!a.solved&&(a.solved=t,this.currentDaily.quit?a.quit=!0:a.guesses++,this.appDataPlayerCurrent.id!==1e7&&await r.SaveData("dailyGames",JSON.stringify(this.appDataUserDailyGamesStarted))),this.UpdateDailyGameFromStartedGameData(a)},async UpdateDailyGameFromStartedGameData(e){note("UpdateDailyGameFromStartedGameData()"),this.ResetTrayAfterRotation();let t=this.appDataDailyGames.find(a=>a.key===e.key);t.guesses=e.guesses,t.solved=e.solved,this.currentDaily.quit&&(t.quit=!0),t.solved&&await this.SendGameStatsToServer(t),this.RotateTray(8)},async SendGameStatsToServer(e){if(!this.appStateSolving&&this.appDataPlayerCurrent.id!==1e7){note("SendGameStatsToServer()");let t=`id=${this.appDataPlayerCurrent.id}&key=${e.key}&guesses=${e.guesses}`;e.quit&&(t=`id=${this.appDataPlayerCurrent.id}&key=${e.key}&guesses=${e.guesses}&quit=true`);const a=`https://facets-save-gamestats.bigtentgames.workers.dev/${t}`;await fetch(a,{method:"GET",headers:{Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then(s=>(s.ok||error(s.status),s.json())).catch(s=>{error(s)}).finally(()=>{this.GetDailyGameStats()})}},async IsCurrentGuessCorrect(e=!0){if(note("IsCurrentGuessCorrect()"),this.numberOfCardsThatHaveBeenPlacedOnTray===4){this.currentGameGuessCount++;let t=[];this.appDataHints.forEach(n=>{t.push(n.value)}),this.appDataCards.forEach(n=>{n.failedCheckAlready=!1}),this.appDataCardsParked.forEach(n=>{n.failedCheckAlready=!1});let a=this.currentGameSolutionActual.split(":"),s=this.GetCurrentSolutionParamString().split(":"),i=[];for(let n=0;n<a.length;n+=3)for(let o=0;o<s.length;o+=3)if(a[n]===s[o]){i.push(s[o],s[o+1],s[o+2]);break}if(this.currentGameSolutionGuessing=i.join(":"),e&&this.currentGameSolutionActual===this.currentGameSolutionGuessing&&(this.RotateTray(8),window.history.pushState({},document.title,window.location.pathname)),this.currentDaily&&await this.UpdateGameGuessesCount(this.currentDaily,this.currentGameSolutionActual===this.currentGameSolutionGuessing),i[1]!==a[1]){let n=this.appDataCards.find(o=>o.words.some(l=>l.id===parseInt(i[1])));n.wrongGuesses[0].includes(i[1])||n.wrongGuesses[0].push(i[1]),e&&this.SwapCards(n,this.firstAvailableParkingSpot)}if(i[2]!==a[2]){let n=this.appDataCards.find(o=>o.words.some(l=>l.id===parseInt(i[2])));n.wrongGuesses[1].includes(i[2])||n.wrongGuesses[1].push(i[2]),e&&this.SwapCards(n,this.firstAvailableParkingSpot)}if(i[10]!==a[10]){let n=this.appDataCards.find(o=>o.words.some(l=>l.id===parseInt(i[10])));n.wrongGuesses[2].includes(i[10])||n.wrongGuesses[2].push(i[10]),e&&this.SwapCards(n,this.firstAvailableParkingSpot)}if(i[11]!==a[11]){let n=this.appDataCards.find(o=>o.words.some(l=>l.id===parseInt(i[11])));n.wrongGuesses[3].includes(i[11])||n.wrongGuesses[3].push(i[11]),e&&this.SwapCards(n,this.firstAvailableParkingSpot)}return e&&(this.appDataMessage=this.GetMessageBasedOnTrayCount(!0,""),this.appStateShowNotification=!0,this.appDataTimeoutNotification=setTimeout(()=>{this.appStateShowNotification=!1},1700)),this.CheckIfAnyCardsGuesssAlreadyTried(),this.ScrollParking(null,"beginning"),!1}},CheckIfAnyCardsGuesssAlreadyTried(){let e=this.currentGameSolutionActual.split(":"),t=this.GetCurrentSolutionParamString().split(":");if(t.length===12&&this.appDataPlayerCurrent.role!=="creator"){note("CheckIfAnyCardsGuesssAlreadyTried()");let a=[];for(let s=0;s<e.length;s+=3)for(let i=0;i<t.length;i+=3)if(e[s]===t[i]){a.push(t[i],t[i+1],t[i+2]);break}if(this.appDataCards.forEach(s=>{s.failedCheckAlready=!1}),this.appDataCardsParked.forEach(s=>{s.failedCheckAlready=!1}),a[1]!=="-1"&&a[1]!==e[1]){let s=this.appDataCards.find(i=>i.words.some(n=>n.id===parseInt(a[1])));s.wrongGuesses[0].includes(a[1])&&(s.failedCheckAlready=s.wrongGuesses[0].includes(a[1]))}if(a[2]!=="-1"&&a[2]!==e[2]){let s=this.appDataCards.find(i=>i.words.some(n=>n.id===parseInt(a[2])));s.wrongGuesses[1].includes(a[2])&&(s.failedCheckAlready=s.wrongGuesses[1].includes(a[2]))}if(a[10]!=="-1"&&a[10]!==e[10]){let s=this.appDataCards.find(i=>i.words.some(n=>n.id===parseInt(a[10])));s.wrongGuesses[2].includes(a[10])&&(s.failedCheckAlready=s.wrongGuesses[2].includes(a[10]))}if(a[11]!=="-1"&&a[11]!==e[11]){let s=this.appDataCards.find(i=>i.words.some(n=>n.id===parseInt(a[11])));s.wrongGuesses[3].includes(a[11])&&(s.failedCheckAlready=s.wrongGuesses[3].includes(a[11]))}}},async FillParkingLot(){note("FillParkingLot()"),this.appDataPlayerCreator.id=this.appDataPlayerCurrent.id,this.appStateIsGuessing=!0;let e=[new r.CardObject({}),new r.CardObject({}),new r.CardObject({}),new r.CardObject({})],t=0;this.currentGameSolutionActual=this.GetCurrentSolutionParamString(),this.appDataCards.concat(this.appDataCardsParked).forEach(i=>{i.id=this.appDataPlayerCurrent.value+t++,i.rotation=(getRandomInt(0,1)===1?1:-1)*getRandomInt(0,4)}),this.ResetCardsAfterRotation(!1),this.appDataCardsParked=this.appDataCards;for(let i=this.appDataCardsParked.length-1;i>0;i--){let n=Math.floor(Math.random()*(i+1));[this.appDataCardsParked[i],this.appDataCardsParked[n]]=[this.appDataCardsParked[n],this.appDataCardsParked[i]]}let a=[];this.appDataCards.forEach(i=>{i.words.forEach(n=>{a.push(n)})});let s=await this.GetCurrentGameWordSet();if(this.currentGameGuessingCardCount===5&&(this.appDataCardsParked.push(new r.CardObject({words:r.GetUniqueWords(s,4,r.GetJustWords(a))})),UseDebug)){this.appDataCards.forEach(i=>{note(JSON.stringify(i.words))});for(let i=this.appDataCardsParked.length-1;i>0;i--){let n=Math.floor(Math.random()*(i+1));[this.appDataCardsParked[i],this.appDataCardsParked[n]]=[this.appDataCardsParked[n],this.appDataCardsParked[i]]}}this.currentGameGuessingCardCount===4&&this.appDataCardsParked.push(new r.CardObject({})),this.appDataCardsParked.push(new r.CardObject({})),this.appDataCards=e,await this.ShareBoard(!1,!0),this.GetRecentAnonymousGames()},async RestoreGame(e){note("RestoreGame()");var t=new URLSearchParams(window.location.search);this.appStateUserHasCreatedAGame=!1,this.appDataPlayerSender.name=t.has("sendingName")?t.get("sendingName"):this.appDataPlayerSender.name,this.currentGameGuessersName=this.appDataPlayerSender.name,this.currentGameLanguage=t.has("lang")?t.get("lang"):"en-us",this.appDataPlayerCreator.name=t.has("puzzleName")?t.get("puzzleName"):this.appDataPlayerCreator.name,this.appDataPlayerSender.id=t.has("sendingID")?parseInt(t.get("sendingID")):this.appDataPlayerSender.id,this.appDataPlayerCreator.id=t.has("puzzleID")?parseInt(t.get("puzzleID")):this.appDataPlayerCreator.id,this.appCurrentDailyGameKey=t.has("key")?t.get("key").toString():this.appCurrentDailyGameKey,this.currentGameGuessingWordSet=t.has("wordSetID")?this.appDataWordSets.find(s=>s.id===t.get("wordSetID")):this.currentGameWordSet,this.currentGameGuessingCardCount=t.has("useExtraCard")&&JSON.parse(t.get("useExtraCard"))?5:4,this.appStateForceAutoCheck=this.appDataPlayerCreator.id===0;let a=!1;if(e.length>=40){this.appDataShareURL=window.location.href;let s=await this.GetGuessingGameWordSet();this.appDataCards=[new r.CardObject({}),new r.CardObject({}),new r.CardObject({}),new r.CardObject({})],this.appDataCardsParked=[new r.CardObject({}),new r.CardObject({}),new r.CardObject({}),new r.CardObject({}),new r.CardObject({}),new r.CardObject({})],this.appDataHints=[new r.WordObject({}),new r.WordObject({}),new r.WordObject({}),new r.WordObject({})];let i=0;this.appDataCards.forEach(o=>{for(let l=0;l<4;l++){if(e[i]!==""){let h=s.find(d=>d.id===parseInt(e[i]));h===void 0&&(a=!0),o.words.push(h)}i++}}),this.appDataCardsParked.forEach(o=>{for(let l=0;l<4;l++){if(e[i]!==""){let h=s.find(d=>d.id===parseInt(e[i]));h===void 0&&(a=!0),o.words.push(h)}i++}});let n=t.has("wg")?t.get("wg"):"";if(n!=""&&(n=decodeURIComponent(n),n.indexOf("[")===-1&&n.indexOf("]")===-1&&n.indexOf(":")!==-1)){let o=n.split(" ").map(l=>l.split(":").map(h=>h===""?[]:h.split(",").filter(d=>d!=="").map(String)));if(o.length===10){for(let l=0;l<6;l++)this.appDataCardsParked[l].wrongGuesses=o[l];for(let l=0;l<4;l++)this.appDataCards[l].wrongGuesses=o[l+6]}}this.appDataHints.forEach(o=>{o.value=e[i++]}),t.has("sol")?(this.currentGameSolutionActual=decodeURIComponent(t.get("sol")),t.has("final")&&(this.currentGameSolutionGuessing=this.currentGameSolutionActual,this.appDataMessage=`${this.appDataPlayerCurrent.name}, here's the solution to ${this.appDataPlayerSender.name}'s puzzle.`,this.currentGameReviewIsFinal=!0)):this.currentGameSolutionActual=[],this.SetWordSetTheme(this.currentGameGuessingWordSet),this.documentCssRoot.style.setProperty("--wordScale",this.currentGameGuessingWordSet.scale),this.appDataPlayerCurrent.role=this.appDataPlayerCreator.id===this.appDataPlayerCurrent.id&&this.appDataPlayerCurrent.id!==this.appDataPlayerSender.id?"reviewer":"guesser",this.isPlayerReviewing&&this.appDataPlayerCreator.id!==0&&(this.appDataReviewingFirstRunItems[0][0]=this.appDataReviewingFirstRunItems[0][0].replace("Your friend ",this.appDataPlayerSender.name+" "),this.IsCurrentGuessCorrect(!1)),this.isPlayerGuessing&&(this.appDataPlayerCreator.id!==0||this.isAIGenerated)?this.appDataGuessingFirstRunItems[0][0]=this.appDataGuessingFirstRunItems[0][0].replace("Your friend ",this.appDataPlayerSender.name+" "):this.isPlayerGuessing&&this.appDataPlayerCreator.id===0&&!this.isAIGenerated&&(this.appDataGuessingFirstRunItems[0][1]="Hi, An anonymous player created this puzzle for their friends to solve. Can you solve it too?")}this.appStateIsGuessing=!0,a&&this.NewGame(null,"ðŸ˜• - Something went wrong.")},async CreateCardsForPlayer(e){note("CreateCardsForPlayer()");let t=await this.GetCurrentGameWordSet(),a=r.GetUniqueWords(t);for(let s=0;s<4;s++){const i=new r.CardObject({position:s});s===3&&(i.position=2),s===2&&(i.position=3),i.words=a.slice(0+s*4,4+s*4),this.appDataCards.push(i)}},async GetAISolution(){note("GetAISolution()");let e,t;e=[],t=document.getElementsByTagName("word"),note(`wordElements.length = ${t.length}`);for(let i=0;i<t.length;i++){const n=t[i];e.push(n.innerHTML)}console.log(`
words = ${e.join(", ")}

It's your job to come up with single word clues that describe the following 4 word combinations taken from the original "words" array:

${e[0]} ${e[4]}
${e[5]} ${e[13]}
${e[11]} ${e[3]}
${e[14]} ${e[10]}`),e=e.join(",");const s=`https://facets-get-ai-solution.bigtentgames.workers.dev/?${encodeURIComponent(e)}`;try{const i=await fetch(s,{method:"GET",headers:{Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}});i.ok||error(i.status);const n=await i.text();this.SetAIHints(JSON.parse(n).result),this.FillParkingLot()}catch(i){error(i)}this.ToggleShowMeta(null)},SetAIHints(e){if(note("SetAIHints()"),!Array.isArray(e))this.appDataAIResult=e,this.appDataHints[0].value=e.clue1[0],this.appDataHints[1].value=e.clue2[0],this.appDataHints[2].value=e.clue3[0],this.appDataHints[3].value=e.clue4[0];else for(let a=0;a<this.appDataHints.length;a++){const s=this.appDataHints[a];s.value=e[a]}},SelectWordSet(e,t){note("SelectWordSet()"),e!==null&&(e.preventDefault(),e.stopPropagation()),this.tempWordSets.forEach(a=>{a.isSelected=!1}),t.isSelected=!0,this.documentCssRoot.style.setProperty("--wordScale",t.scale)},GetCurrentSolutionParamString(){note("GetCurrentSolutionParamString()");let e=[];return this.appDataHints.forEach(a=>{a.value=a.value.trim()}),e.push(this.appDataHints[0].value),e.push(this.appDataCards[0].words.length===4?this.appDataCards[0].words[0].id:-1),e.push(this.appDataCards[1].words.length===4?this.appDataCards[1].words[0].id:-1),e.push(this.appDataHints[1].value),e.push(this.appDataCards[1].words.length===4?this.appDataCards[1].words[1].id:-1),e.push(this.appDataCards[3].words.length===4?this.appDataCards[3].words[1].id:-1),e.push(this.appDataHints[2].value),e.push(this.appDataCards[2].words.length===4?this.appDataCards[2].words[3].id:-1),e.push(this.appDataCards[0].words.length===4?this.appDataCards[0].words[3].id:-1),e.push(this.appDataHints[3].value),e.push(this.appDataCards[3].words.length===4?this.appDataCards[3].words[2].id:-1),e.push(this.appDataCards[2].words.length===4?this.appDataCards[2].words[2].id:-1),e.join(":")},GetUniqueCardId(e){if(note("GetUniqueCardId()"),e.length===0)return 0;let t="";e.forEach(i=>{t+=i.value.toLowerCase()}),t=t.split(""),t=t.sort(),t=t.join("");let a=1000000007,s=0;for(let i=0;i<t.length;i++)s=(s*26+(t.charCodeAt(i)-97+1))%a;return s},CheckIfCardIsInTray(e){return note("CheckIfCardIsInTray()"),!e.words||e.words.length===0||this.appDataCards.forEach(t=>{if(this.GetUniqueCardId(t.words)===this.GetUniqueCardId(e.words))return!0}),!1},async GetRecentAnonymousGames(){if(!this.appStateIsGettingAnonymousGames&&(note("GetRecentAnonymousGames()"),window.location.href!==window.location.origin+"/generate.html?generated=true")){this.appStateIsGettingAnonymousGames=!0,this.appDataGlobalCreatedGames=[];var e="https://facets-get-recent-anonymous-games.bigtentgames.workers.dev/";await fetch(e,{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then(t=>(t.ok||error(t.status),t.text())).then(t=>{this.appDataGlobalCreatedGames=JSON.parse(t)}).catch(t=>{error(t)}).finally(()=>{this.appStateIsGettingAnonymousGames=!1})}},async GetDailyGames(){if(note("GetDailyGames()"),!this.appStateIsGettingDailyGames&&!this.GetTodaysDaily()){if(note("fetching daily games"),this.vsShowDaily&&window.location.href!==window.location.origin+"/generate.html?generated=true"){this.appStateIsGettingDailyGames=!0,this.appStateIsGettingUserStats=!this.userSettingsHideStats;let t=[];var e="https://facets-get-last-10-daily-games.bigtentgames.workers.dev/";await fetch(e,{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then(a=>(a.ok||error(a.status),a.text())).then(a=>{t=JSON.parse(a),t.forEach(s=>{let i=this.GetUserStartedGame(s);s.guesses=0,i&&(s.solved=i.solved,s.guesses=i.guesses,i.quit&&(s.quit=i.quit))}),this.GetDailyGameStats(),this.appDataDailyGames=t}).catch(a=>{error(a)}).finally(()=>{this.appStateIsGettingDailyGames=!1})}}else this.appStateIsGettingDailyGames=!1,this.appStateIsGettingUserStats=!this.userSettingsHideStats,this.GetDailyGameStats()},async GetDailyGameStats(){if(!this.appStateIsGettingDailyGameStats){note("GetDailyGameStats()"),this.appStateIsGettingDailyGameStats=!0;var e="https://facets-get-daily-gamestats.bigtentgames.workers.dev/";await fetch(e,{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then(t=>(t.ok||error(t.status),t.text())).then(t=>{this.appDataDailyGamesStats=JSON.parse(t),this.appDataDailyGames.forEach(a=>{a.showStats=!1,a.stats={guesscounts:{beyond2:0}};for(const s of this.appDataDailyGamesStats)if(s.hasOwnProperty(a.key)){a.stats=s[a.key];break}(a.stats&&a.stats.avg===void 0||a.stats.avg===null)&&(a.stats.avg=0),(a.stats.guesscounts.beyond2===void 0||a.stats.guesscounts.beyond2===null)&&(a.stats.guesscounts.beyond2=0)})}).catch(t=>{error(t)}).finally(()=>{this.GetUsersStats(),this.appStateIsGettingDailyGameStats=!1})}},async GetUsersStats(){note("GetUsersStats()"),this.appStateIsGettingUserStats=!0;const e=this.appDataDailyGames.map(s=>s.key).filter(s=>s);if(e.length===0){note("No daily games loaded, skipping user stats fetch"),this.appStateIsGettingUserStats=!1;return}const t=e.join(",");var a=`https://facets-get-users-stats.bigtentgames.workers.dev/${this.appDataPlayerCurrent.id}?keys=${encodeURIComponent(t)}`;await fetch(a,{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then(s=>(s.ok||error(s.status),s.status===204?null:s.text())).then(s=>{if(!s){this.appDataPlayerStats={g1:0,g2:0,beyond2:0,quit:0,total:0};return}const i=JSON.parse(s),n=i.games||[],o=i.summary;n.forEach(l=>{for(const h of this.appDataDailyGames)l.key===h.key&&(h.guesses=l.guesses,l.quit!==null&&l.quit!==void 0&&(h.quit=l.quit),h.solved=!0)}),this.appDataPlayerStats=o||{g1:0,g2:0,beyond2:0,quit:0,total:0}}).catch(s=>{error(s),this.appDataPlayerStats={g1:0,g2:0,beyond2:0,quit:0,total:0}}).finally(()=>{this.appStateIsGettingUserStats=!1})},GetCookie(e){const a=`; ${document.cookie}`.split(`; ${e}=`);return a.length===2?a.pop().split(";").shift():null},async GetAvailableFacetsPlayerId(){note("GetAvailableFacetsPlayerId() called");try{const e=getRandomInt(1e7,1e15),t=await fetch(`https://facets-check-player-id.bigtentgames.workers.dev/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Origin:window.location.origin}});if(t.ok){const a=await t.json(),s=parseInt(a.available);return a.isGenerated?note(`Original ID ${e} was taken, worker generated new ID: ${s}`):note(`Original ID ${e} is available`),s}else return note(`Error from player ID worker: ${t.status}, using fallback`),this.GenerateLocalFallbackId()}catch(e){return note(`Failed to contact player ID worker: ${e}, using fallback`),this.GenerateLocalFallbackId()}},GenerateLocalFallbackId(){const e=getRandomInt(1e7,1e15);return note(`Generated local fallback ID: ${e}`),e},async CheckBTGAuthStatus(e=!1){note("CheckBTGAuthStatus() called");let t=localStorage.getItem("btg_auth_token");const a=this.GetCookie("btg_auth_token"),s=this.isAuthenticated;if(t&&!a)return note("Token exists in localStorage but not in cookie - user logged out externally"),await this.ClearBTGAuth(),!1;if(!t&&a){note("Syncing cookie token to localStorage"),t=a;try{localStorage.setItem("btg_auth_token",t)}catch(i){note("localStorage setItem failed: "+i)}}if(!t)return s?(note("No BTG auth token found but user was previously authenticated - clearing auth state"),await this.ClearBTGAuth()):note("No BTG auth token found in localStorage or cookies"),!1;if(note("BTG auth token found: "+(t?"present":"missing")),this.isAuthenticated&&this.userToken===t&&!e)return note("Already authenticated with same token; skipping validation/profile reload"),!0;this.authLoading=!0;try{const i=await fetch("https://btg-accounts-worker.bigtentgames.workers.dev/auth/validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});return i.ok?(note("BTG auth token is valid"),!this.isAuthenticated||this.userToken!==t||e?this.SetBTGAuthToken(t):note("Token valid but already in-use; skipping SetBTGAuthToken"),!0):(note("BTG auth token is invalid (status: "+i.status+")"),await this.ClearBTGAuth(),!1)}catch(i){return i("BTG auth validation failed: "+i),this.isAuthenticated&&await this.ClearBTGAuth(),!1}finally{this.authLoading=!1}},SetBTGAuthToken(e){note("SetBTGAuthToken() called"),this.userToken=e,this.isAuthenticated=!0,localStorage.setItem("btg_auth_token",e);const t=window.location.hostname.includes("local")?".bigtentgames.local":".bigtentgames.com";document.cookie=`btg_auth_token=${e}; domain=${t}; path=/; max-age=${10080*60}`,this.LoadBTGUserProfile()},async ClearBTGAuth(){note("ClearBTGAuth() called"),this.isAuthenticated&&(this.hasPlayedAsBTGAccountBefore=!0,await r.SaveData("hasPlayedAsBTGAccountBefore",!0),note("Set hasPlayedAsBTGAccountBefore flag"),this.facetsChannel&&(this.facetsChannel.postMessage({type:"BTG_LOGOUT",senderId:this.windowId,timestamp:Date.now()}),note("Broadcasted BTG logout to other tabs")));try{if(window.CrossSubdomainAuth&&typeof window.CrossSubdomainAuth.clearAuthData=="function")window.CrossSubdomainAuth.clearAuthData(!0),note("Called CrossSubdomainAuth.clearAuthData()");else{const e=window.location.hostname.includes("local")?".bigtentgames.local":".bigtentgames.com";document.cookie=`btg_auth_token=; domain=${e}; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT`;try{localStorage.removeItem("btg_auth_token")}catch(t){note("Could not remove btg_auth_token from localStorage: "+t)}try{new BroadcastChannel("btg_auth_logout").postMessage("logout")}catch(t){note("Could not post logout broadcast: "+t)}note("Performed fallback auth clear")}}catch(e){error("Error clearing cross-subdomain auth: "+e)}this.isAuthenticated=!1,this.userToken=null,this.userEmail="",this.playerName="Player",this.playerId="";try{r&&typeof r.ClearStore=="function"?(await r.ClearStore(),note("Cleared IndexedDB via modules.ClearStore()")):r&&typeof r.RemoveData=="function"?(await r.RemoveData("btgProfile").catch(()=>{}),note("Cleared btgProfile via modules.RemoveData() (fallback)")):note("No IndexedDB helper available to clear storage (skipping)")}catch(e){error("Error clearing IndexedDB during ClearBTGAuth(): "+e)}},async LoadBTGUserProfile(){if(note("LoadBTGUserProfile() called"),!(!this.isAuthenticated||!this.userToken))try{const e=await fetch("https://btg-accounts-worker.bigtentgames.workers.dev/account/profile",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.userToken}`}}),t=await e.json();if(e.ok){this.userEmail=t.profile.email||"",this.playerName=t.profile.playerName||"Player",this.playerId=t.profile.playerId||"",note("BTG user profile loaded: "+JSON.stringify({email:this.userEmail,playerName:this.playerName,playerId:this.playerId})),note("Loading user data from cloud...");const a=await this.LoadUserDataFromCloud();a&&(a.settings||a.dailyStats)?(note("Applying cloud data to local storage (cloud overrides local)"),await this.ApplyCloudDataToLocal(a),a.settings||(note("No cloud settings found, saving current local data to cloud"),await this.SaveUserDataToCloud())):(note("No cloud data found, saving current local data to cloud"),await this.SaveUserDataToCloud()),await r.SaveData("btgProfile",{email:this.userEmail,playerName:this.playerName,playerId:this.playerId,linkedAt:new Date().toISOString()}),this.hasPlayedAsBTGAccountBefore=!0,await r.SaveData("hasPlayedAsBTGAccountBefore",!0),this.appStateShowIntro&&this.playerName&&(!this.appDataPlayerCurrent.name||this.appDataPlayerCurrent.name==="Player")?(note("First-run authentication detected, updating tempName to BTG player name: "+this.playerName+" (current Facets name: "+(this.appDataPlayerCurrent.name||"empty")+")"),this.tempName=this.playerName):this.appStateShowIntro&&this.playerName&&note("First-run authentication detected, but keeping existing Facets name: "+this.appDataPlayerCurrent.name)}}catch(e){error("Failed to load BTG user profile: "+e)}},async SaveUserDataToCloud(){const e=Math.random().toString(36).substr(2,9);if(note(`SaveUserDataToCloud() called [${e}]`),!this.isAuthenticated||!this.userToken||!this.playerId){note(`Not authenticated or missing playerId, skipping cloud save [${e}]`);return}try{const t=await r.GetData("userHasSeenFirstTimeCreatingTutorial"),a={userSettingsLanguage:this.userSettingsLanguage,userSettingsUsesLightTheme:this.userSettingsUsesLightTheme,userSettingsUsesSimplifiedTheme:this.userSettingsUsesSimplifiedTheme,userSettingsUseMultiColoredGems:this.userSettingsUseMultiColoredGems,userSettingsShowAllCards:this.userSettingsShowAllCards,userSettingsHideStats:this.userSettingsHideStats,userSettingsNoSnark:this.userSettingsNoSnark,userSettingsHideReviewAids:this.userSettingsHideReviewAids,userSettingsHueIndex:this.userSettingsHueIndex,userSettingsUseWordSetThemes:this.userSettingsUseWordSetThemes,userSettingsUserWantsDailyReminder:this.userSettingsUserWantsDailyReminder,userSettingsUseExtraCard:this.userSettingsUseExtraCard,wordSet:this.currentGameWordSet.id,playerName:this.appDataPlayerCurrent.name,facetsPlayerId:this.appDataPlayerCurrent.id,userHasSeenFirstTimeCreatingTutorial:t||!1,appStateFirstRunGuessingIndex:this.appStateFirstRunGuessingIndex,appStateFirstRunCreatingIndex:this.appStateFirstRunCreatingIndex,appStateFirstRunReviewingIndex:this.appStateFirstRunReviewingIndex},s="https://facets-save-user-settings.bigtentgames.workers.dev/";note(`Saving user settings [${e}]`);const i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.userToken}`},body:JSON.stringify({playerId:this.playerId,settings:a})});if(!i.ok)throw new Error(`Settings save failed: ${i.status} ${i.statusText}`);note(`User settings saved successfully [${e}]`);let n=[];try{if(note(`About to load daily stats from IndexedDB [${e}]`),note(`Looking for key: userDailyStats_${this.appDataPlayerCurrent.id} [${e}]`),!r||typeof r.GetData!="function")throw new Error("modules.GetData is not available");const o=await r.GetData(`userDailyStats_${this.appDataPlayerCurrent.id}`);note(`Raw IndexedDB result [${e}]: `+JSON.stringify(o)),n=o||[],note(`Processed daily stats [${e}]: ${n.length} entries`)}catch(o){error(`Failed to load daily stats from IndexedDB [${e}]: `+o),error(`Error type [${e}]: `+typeof o),error(`Error message [${e}]: `+(o?.message||"No message")),error(`Error stack [${e}]: `+(o?.stack||"No stack")),n=[]}if(n.length>0){note(`Saving daily stats [${e}]: ${n.length} entries`);const l=await fetch("https://facets-save-daily-stats.bigtentgames.workers.dev/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.userToken}`},body:JSON.stringify({playerId:this.playerId,facetsPlayerId:this.appDataPlayerCurrent.id,dailyStats:n})});if(!l.ok)throw new Error(`Daily stats save failed: ${l.status} ${l.statusText}`);note(`Daily stats saved successfully [${e}]`)}else note(`No daily stats to save [${e}]`);note(`User data successfully saved to cloud [${e}]`)}catch(t){throw error(`Failed to save user data to cloud [${e}]: `+t),t}},async LoadUserDataFromCloud(){if(note("LoadUserDataFromCloud() called"),note(`Auth status: authenticated=${this.isAuthenticated}, token=${!!this.userToken}, playerId=${this.playerId}`),!this.isAuthenticated||!this.userToken||!this.playerId)return note("Not authenticated or missing playerId, skipping cloud load"),null;try{const e=`https://facets-get-user-settings.bigtentgames.workers.dev/${this.playerId}`;note(`Fetching from URL: ${e}`);const t=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${this.userToken}`}});let a={settings:null,dailyStats:null};if(t.ok&&t.status!==204){const s=await t.json();a.settings=s.settings}if(a.settings&&a.settings.facetsPlayerId){const s=`https://facets-get-users-stats.bigtentgames.workers.dev/${a.settings.facetsPlayerId}`,i=await fetch(s,{method:"GET",headers:{Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}});if(i.ok&&i.status!==204){const n=await i.text();n&&(a.dailyStats=JSON.parse(n))}}return note("User data loaded from cloud: "+JSON.stringify(a)),a}catch(e){return error("Failed to load user data from cloud: "+e),null}},async ApplyCloudDataToLocal(e){if(note("ApplyCloudDataToLocal() called"),!!e)try{if(e.settings){const t=e.settings;if(t.userSettingsLanguage&&(this.userSettingsLanguage=t.userSettingsLanguage,this.tempUserSettingsLanguage=t.userSettingsLanguage),t.userSettingsUsesLightTheme!==void 0&&(this.ToggleUseLightTheme(t.userSettingsUsesLightTheme),this.tempUserSettingsUsesLightTheme=t.userSettingsUsesLightTheme),t.userSettingsUsesSimplifiedTheme!==void 0&&(this.ToggleUseSimplifedTheme(t.userSettingsUsesSimplifiedTheme),this.tempUserSettingsUsesSimplifiedTheme=t.userSettingsUsesSimplifiedTheme),t.userSettingsUseMultiColoredGems!==void 0&&(this.userSettingsUseMultiColoredGems=t.userSettingsUseMultiColoredGems,this.tempUseMultiColoredGems=t.userSettingsUseMultiColoredGems),t.userSettingsShowAllCards!==void 0&&(this.ToggleShowAllCards(t.userSettingsShowAllCards),this.tempUserSettingsShowAllCards=t.userSettingsShowAllCards),t.userSettingsHideStats!==void 0&&(this.userSettingsHideStats=t.userSettingsHideStats,this.tempUserSettingsHideStats=t.userSettingsHideStats),t.userSettingsNoSnark!==void 0&&(this.userSettingsNoSnark=t.userSettingsNoSnark,this.tempUserSettingsNoSnark=t.userSettingsNoSnark),t.userSettingsHideReviewAids!==void 0&&(this.ToggleUnaidedReview(t.userSettingsHideReviewAids),this.tempUserSettingsHideReviewAids=t.userSettingsHideReviewAids),t.userSettingsHueIndex!==void 0&&(this.userSettingsHueIndex=t.userSettingsHueIndex,this.tempUserSettingsHueIndex=t.userSettingsHueIndex),t.userSettingsUseWordSetThemes!==void 0&&(this.userSettingsUseWordSetThemes=t.userSettingsUseWordSetThemes,this.tempUseWordSetThemes=t.userSettingsUseWordSetThemes),t.userSettingsUserWantsDailyReminder!==void 0&&(this.userSettingsUserWantsDailyReminder=t.userSettingsUserWantsDailyReminder,this.tempUserWantsDailyReminder=t.userSettingsUserWantsDailyReminder),t.userSettingsUseExtraCard!==void 0&&(this.userSettingsUseExtraCard=t.userSettingsUseExtraCard,this.tempUseExtraCard=t.userSettingsUseExtraCard),t.wordSet){const a=this.appDataWordSets.find(s=>s.id===t.wordSet);a&&(this.appDataWordSets.forEach(s=>{s.isSelected=!1}),a.isSelected=!0,this.currentGameWordSet=a,note("Applied wordSet from cloud: "+t.wordSet))}t.playerName&&(this.appDataPlayerCurrent.name=t.playerName,this.tempName=t.playerName),t.facetsPlayerId&&(this.appDataPlayerCurrent.id=t.facetsPlayerId,this.tempID=parseInt(t.facetsPlayerId)),t.userHasSeenFirstTimeCreatingTutorial!==void 0&&(await r.SaveData("userHasSeenFirstTimeCreatingTutorial",t.userHasSeenFirstTimeCreatingTutorial),note("Applied userHasSeenFirstTimeCreatingTutorial from cloud: "+t.userHasSeenFirstTimeCreatingTutorial)),t.appStateFirstRunGuessingIndex!==void 0&&(this.appStateFirstRunGuessingIndex=parseInt(t.appStateFirstRunGuessingIndex),await r.SaveData("appStateFirstRunGuessingIndex",this.appStateFirstRunGuessingIndex),note("Applied appStateFirstRunGuessingIndex from cloud: "+this.appStateFirstRunGuessingIndex)),t.appStateFirstRunCreatingIndex!==void 0&&(this.appStateFirstRunCreatingIndex=parseInt(t.appStateFirstRunCreatingIndex),await r.SaveData("appStateFirstRunCreatingIndex",this.appStateFirstRunCreatingIndex),note("Applied appStateFirstRunCreatingIndex from cloud: "+this.appStateFirstRunCreatingIndex)),t.appStateFirstRunReviewingIndex!==void 0&&(this.appStateFirstRunReviewingIndex=parseInt(t.appStateFirstRunReviewingIndex),await r.SaveData("appStateFirstRunReviewingIndex",this.appStateFirstRunReviewingIndex),note("Applied appStateFirstRunReviewingIndex from cloud: "+this.appStateFirstRunReviewingIndex)),note("OOBE/Tutorial state restored from cloud - GuessingIndex: "+this.appStateFirstRunGuessingIndex+", CreatingIndex: "+this.appStateFirstRunCreatingIndex+", ReviewingIndex: "+this.appStateFirstRunReviewingIndex),await r.SaveData("userSettingsLanguage",this.userSettingsLanguage),await r.SaveData("userSettingsUsesLightTheme",this.userSettingsUsesLightTheme),await r.SaveData("userSettingsUsesSimplifiedTheme",this.userSettingsUsesSimplifiedTheme),await r.SaveData("userSettingsUseMultiColoredGems",this.userSettingsUseMultiColoredGems),await r.SaveData("userSettingsShowAllCards",this.userSettingsShowAllCards),await r.SaveData("userSettingsHideStats",this.userSettingsHideStats),await r.SaveData("userSettingsNoSnark",this.userSettingsNoSnark),await r.SaveData("userSettingsHideReviewAids",this.userSettingsHideReviewAids),await r.SaveData("userSettingsHueIndex",this.userSettingsHueIndex),await r.SaveData("useWordSetThemes",this.userSettingsUseWordSetThemes),await r.SaveData("userSettingsUserWantsDailyReminder",this.userSettingsUserWantsDailyReminder),await r.SaveData("useExtraCard",this.userSettingsUseExtraCard),await r.SaveData("wordSet",this.currentGameWordSet.id),await r.SaveData("playerName",this.appDataPlayerCurrent.name),await r.SaveData("playerID",this.appDataPlayerCurrent.id),await r.SaveData("name",this.appDataPlayerCurrent.name),await r.SaveData("userID",this.appDataPlayerCurrent.id),await r.SaveData("useWordSetThemes",this.userSettingsUseWordSetThemes),await r.SaveData("userSettingsUserWantsDailyReminder",this.userSettingsUserWantsDailyReminder),await r.SaveData("useExtraCard",this.userSettingsUseExtraCard),note("Applied cloud settings: "+JSON.stringify({language:this.userSettingsLanguage,lightTheme:this.userSettingsUsesLightTheme,simplifiedTheme:this.userSettingsUsesSimplifiedTheme,multiColoredGems:this.userSettingsUseMultiColoredGems,showAllCards:this.userSettingsShowAllCards,hideStats:this.userSettingsHideStats,noSnark:this.userSettingsNoSnark,hideReviewAids:this.userSettingsHideReviewAids,hueIndex:this.userSettingsHueIndex,useWordSetThemes:this.userSettingsUseWordSetThemes,userWantsDailyReminder:this.userSettingsUserWantsDailyReminder,useExtraCard:this.userSettingsUseExtraCard,playerName:this.appDataPlayerCurrent.name,playerId:this.appDataPlayerCurrent.id}))}e.dailyStats&&Array.isArray(e.dailyStats)&&(await r.SaveData(`userDailyStats_${this.appDataPlayerCurrent.id}`,e.dailyStats),note(`Saved ${e.dailyStats.length} daily stats from cloud`)),note("Cloud data successfully applied to local storage")}catch(t){error("Failed to apply cloud data to local storage: "+t)}},SetupFacetsChannel(){note("SetupFacetsChannel() called"),this.facetsChannel&&this.facetsChannel.close(),this.facetsChannel=new BroadcastChannel("facets_main"),this.facetsChannel.onmessage=e=>{e.data.type==="PARK_THIS_TAB"&&e.data.senderId!==this.windowId&&(window.location.href="/game/close.html"),e.data.type==="BTG_LOGOUT"&&e.data.senderId!==this.windowId&&(note("Received BTG logout message from another tab"),this.isAuthenticated&&this.ClearBTGAuth())},this.facetsChannel.postMessage({type:"PARK_THIS_TAB",senderId:this.windowId})},HandleDonateButtonPress(){note("HandleDonateButtonPress()"),window.open("https://www.buymeacoffee.com/wilvoss","_blank")},HandleHintClick(e,t){note("HandleHintClick() with index: "+e+" and hint: "+t),(e>0||this.appDataPlayerCurrent.role==="creator")&&this.RotateTrayBasedOnInputFocus(e)},HandleLoginClick(){note("HandleLoginClick() - Redirecting to BTG account page with return URL");const e=window.location.hostname.replace(/^[^.]+\./,""),t=encodeURIComponent(window.location.href),a=`https://${e}/#account?returnUrl=${t}`;window.location.href=a},async HandleLogOutClick(){note("HandleLogOutClick() - Performing complete logout and app reset");try{await this.ClearBTGAuth(),await r.ClearStore(),note("Cleared all IndexedDB data"),localStorage.clear(),note("Cleared all localStorage data");const e=window.location.hostname.includes("local")?".bigtentgames.local":".bigtentgames.com";["btg_auth_token"].forEach(a=>{document.cookie=`${a}=; domain=${e}; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT`}),note("Cleared all cookies"),note("Refreshing app for clean first-run experience"),window.location.reload()}catch(e){console.error("Error during logout cleanup:",e),window.location.reload()}},SetupPeriodicAuthCheck(){note("SetupPeriodicAuthCheck() called"),this.authCheckInterval&&clearInterval(this.authCheckInterval),this.authCheckInterval=setInterval(async()=>{if(this.isAuthenticated){const e=this.isAuthenticated,t=await this.CheckBTGAuthStatus();e&&!t&&note("User logged out externally - clearing local auth state")}},30*1e3)},HandleSubmitButtonPress(){note("HandleSubmitButtonPress()"),this.appDataPlayerCurrent.role==="reviewer"&&this.numberOfCardsThatHaveBeenPlacedOnTray===4?(this.appStateIsModalShowing=!0,this.appDataConfirmationObject={message:`Did ${this.appDataPlayerSender.name} have the right answer?`,target:"correct"},this.appStateShowConfirmation=!0):this.appStateIsGuessing?this.currentGameSolutionGuessing===this.currentGameSolutionActual?this.GetIsAIGenerated()?this.ShareWin(null):this.HandleNewGameClick():this.currentDaily||this.appStateForceAutoCheck?this.submitButtonText===this.appDataActionButtonTexts.quit?(this.appDataConfirmationObject={message:"Give up and see the solution?",target:"quit"},this.appStateShowConfirmation=!0):this.IsCurrentGuessCorrect():this.ShareBoard():this.FillParkingLot()},GetUserStartedGame(e){return this.appDataUserDailyGamesStarted.find(t=>t.key===e.key)},HasUserStartedGame(e){let t=!1;return t=!!this.GetUserStartedGame(e),t},async HandleOldGameClick(e,t,a=!1){note("HandleOldGameClick()"),e!==null&&(e.preventDefault(),e.stopPropagation());let s=["?"];if(this.currentGameSolutionGuessing="",this.appDataMessage="",s.push("sendingName=Player 1"),s.push("&generated="+encodeURIComponent(this.isAIGenerating?this.isAIGenerating:t.generated)),s.push("&key="+encodeURIComponent(t.key)),s.push("&puzzleName=Player 1"),s.push("&puzzleID="+encodeURIComponent(t.puzzleID)),s.push("&lang="+encodeURIComponent(t.lang)),s.push("&wordSetID="+encodeURIComponent(t.wordSetID)),s.push("&useExtraCard="+encodeURIComponent(t.useExtraCard)),s.push("&sol="+encodeURIComponent(t.sol)),s.push("&board="+encodeURIComponent(t.board)),this.appCurrentDailyGameKey=-1,t.date&&t.key){if(s.push("&key="+encodeURIComponent(t.key)),!this.HasUserStartedGame(t)){let o={key:t.key,guesses:0,solved:!1};this.appDataUserDailyGamesStarted.push(o),this.appDataPlayerCurrent.id!==1e7&&await r.SaveData("dailyGames",JSON.stringify(this.appDataUserDailyGamesStarted))}this.appCurrentDailyGameKey=t.key}let i=s.join(""),n=location.origin+i;note(n),history.pushState(null,null,n),this.appStateShowDailyGames&&this.ToggleShowDailyGames(e),this.appStateShowMeta||this.ToggleShowMeta(e),this.appStateShowGlobalCreated&&this.ToggleShowGlobalCreated(e),await this.LoadPage(),this.appStateShowNotification=!0,this.RotateTray(-4)},async HandleGoButtonClick(e){note("HandleGoButtonClick()"),this.SubmitSettings(e),this.appStateShowCreateOOBE=!1,await r.SaveData("userHasSeenFirstTimeCreatingTutorial",!0),this.appStateShowCatChooser=!1},HandleNewGameClick(){note("HandleNewGameClick()"),this.GetCategoryNames(),this.appStateShowCatChooser=!0,this.appStateUserHasCreatedAGame=!0},HandleGameLinkClick(e,t){note("HandleGameLinkClick()"),e.stopPropagation(),e.preventDefault(),t.solved&&t.guesses>0?this.HandleSolvedPuzzleButtonClick(e,t):this.HandleOldGameClick(e,t)},async HandleSolvedPuzzleButtonClick(e,t){note("HandleSolvedPuzzleButtonClick()"),e.stopPropagation(),e.preventDefault(),this.appStateSolving=!0,await this.HandleOldGameClick(e,t,!0),this.appStateShowNotification=!1,this.SolvePuzzleCurrent(),this.appStateSolving=!1,this.appStateShowNotification=!1,history.pushState(null,null,window.location.origin+window.location.pathname)},ClearTrayOfCards(){if(this.isPlayerGuessing)for(let e=0;e<this.appDataCards.length;e++){const t=this.appDataCards[e];if(t.words.length!==0){let a=this.appDataCardsParked.find(s=>s.words.length===0);this.SwapCards(t,a)}}},SolvePuzzleCurrent(){note("SolvePuzzleCurrent()");let e=this.currentGameSolutionActual.split(":"),t=e[0],a=this.appDataHints.findIndex(i=>i.value===t);this.RotateTrayBasedOnInputFocus(a,!1);let s=[parseInt(e[1]),parseInt(e[4]),parseInt(e[7]),parseInt(e[10])];this.ClearTrayOfCards();for(let i=0;i<this.appDataCards.length;i++){const n=this.appDataCards[i];if(n.words.length===0){let o=this.appDataCardsParked.find(l=>l.words.find(h=>h.id===s[i]));if(o){let l=o.words.findIndex(d=>d.id===s[i]),h=0;switch(i){case 1:h=1;break;case 2:h=-1;break;case 3:h=2;break}o.rotation=4-l+h,this.SwapCards(n,o)}}}this.ResetCardsAfterRotation(),this.IsCurrentGuessCorrect()},async HandleYesNo(e,t){switch(note("HandleYesNo()"),e){case"quit":if(t){this.currentDaily.quit=!0,this.SolvePuzzleCurrent();break}case"correct":this.ShareBoard(t);break;case"newgame":t&&this.NewGame(null);break}this.appStateShowConfirmation=!1,this.appStateIsModalShowing=!1},HandlePointerMoveEvent(e){this.appDataGhostX=e.clientX,this.appDataGhostY=e.clientY},HandlePreviousTipButtonPointerUp(e){e.preventDefault(),e.stopPropagation(),this.RetreatFirstRunIndexes()},HandleAdvanceTipButtonPointerUp(e){e.preventDefault(),e.stopPropagation(),this.AdvanceFirstRunIndexes()},HandleBodyPointerUp(e,t){this.appStateShareError=!1,this.appStateIsModalShowing?this.appDataDraggedCard.isSelected=!1:(this.appStateIsDragging=!1,this.appDataDraggedCard=this.appDataEmptyCard)},HandleBodyPointerDown(e){this.appDataGhostX=e.clientX,this.appDataGhostY=e.clientY},HandleCardPointerDown(e,t){this.appStateIsGuessing&&this.currentGameSolutionGuessing===this.currentGameSolutionActual&&this.appDataPlayerCurrent.role!=="reviewer"||(e!==null&&(e.preventDefault(),e.stopPropagation(),this.appDataGhostX=e.clientX,this.appDataGhostY=e.clientY,e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)),this.appDataDraggedCard=t,this.appStateIsDragging=!0)},HandleCardPointerUp(e,t,a="tray"){if(!(this.appStateIsGuessing&&this.currentGameSolutionGuessing===this.currentGameSolutionActual&&this.appDataPlayerCurrent.role!=="reviewer")){if(e.preventDefault(),e.stopPropagation(),this.appDataMessage="",this.selectedCard&&this.selectedCard===t){this.appDataDraggedCard=this.appDataEmptyCard,this.appStateIsDragging=!1;return}this.appDataDraggedCard.words.length>0&&this.SwapCards(t,this.appDataDraggedCard),this.CheckIfAnyCardsGuesssAlreadyTried()}},ScrollParking(e,t){note("ScrollParking()");const a=document.getElementById("parking"),s=parseInt(this.cssStyles.getPropertyValue("--cardSize")),i=parseFloat(this.cssStyles.getPropertyValue("--scale"));t==="left"?this.appDataParkingScrollLeft=a.scrollLeft+i*2*s:t==="right"?this.appDataParkingScrollLeft=a.scrollLeft-i*2*s:t==="beginning"&&(this.appDataParkingScrollLeft=0),a&&a.scrollTo({left:this.appDataParkingScrollLeft,behavior:"smooth"}),setTimeout(()=>{a&&a.scrollWidth&&(this.appParkingRightButtonDisabled=a.scrollWidth-a.clientWidth<=a.scrollLeft)},300)},async HandlePageVisibilityChange(){note("HandlePageVisibilityChange()"),document.hidden||(this.GetDailyGames(),this.HandleOnlineStatusChange(),await this.CheckBTGAuthStatus(),this.LoadBTGUserProfile(),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(e=>{e&&(note("Manually checking for service worker update on visibility change"),e.update())}))},CancelSettings(e){note("CancelSettings()"),e!==null&&(e.preventDefault(),e.stopPropagation()),this.appStateShowCatChooser=!1,this.appStateIsModalShowing=!1,this.appStateShowSettings=!1,this.appStateShowIntro=!1,this.tempID=this.appDataPlayerCurrent.id,this.tempUseMultiColoredGems=this.userSettingsUseMultiColoredGems,this.tempUseWordSetThemes=this.userSettingsUseWordSetThemes,this.tempUserWantsDailyReminder=this.userSettingsUserWantsDailyReminder,this.tempUserSettingsLanguage=this.userSettingsLanguage,this.tempUserSettingsNoSnark=this.userSettingsNoSnark,this.tempUserSettingsUsesLightTheme=this.userSettingsUsesLightTheme,this.tempUserSettingsHueIndex=this.userSettingsHueIndex,this.tempUseExtraCard=this.userSettingsUseExtraCard,this.tempUserSettingsHideStats=this.userSettingsHideStats,this.tempUserSettingsUsesSimplifiedTheme=this.userSettingsUsesSimplifiedTheme,this.tempUserSettingsShowAllCards=this.userSettingsShowAllCards,this.tempUserSettingsHideReviewAids=this.userSettingsHideReviewAids},HandleIntroButtonClick(e){note("HandleIntroButtonClick()"),this.SubmitSettings(null),this.appStateShowOOBE=!0},async SubmitSettings(e){if(note("SubmitSettings()"),e!==null&&(e.preventDefault(),e.stopPropagation()),this.appDataPlayerCurrent.name=this.tempName!==""?this.tempName.trim():this.appDataPlayerCurrent.name,this.appStateIsGuessing||(this.appDataPlayerCreator.name=this.appDataPlayerCurrent.name),await r.SaveData("name",this.appDataPlayerCurrent.name),this.appStateShowSettings||this.appStateShowCatChooser){this.userSettingsLanguage=this.tempUserSettingsLanguage;let a=this.tempWordSets.find(i=>i.name===this.tempWordSetName);this.SelectWordSet(e,a);let s=!1;s=this.appDataWordSets.find(i=>i.isSelected===!0).id!==this.tempWordSets.find(i=>i.isSelected===!0).id,this.appDataWordSets=this.tempWordSets,this.currentGameWordSet=this.appDataWordSets.find(i=>i.isSelected===!0),(s&&!this.appStateIsGuessing||this.appStateShowCatChooser)&&(this.NewGame(),this.SetWordSetTheme(this.currentGameGuessingWordSet))}let t=this.appDataPlayerCurrent.id!==this.tempID;this.appDataPlayerCurrent.id=this.tempID,this.userSettingsUseWordSetThemes=this.tempUseWordSetThemes,this.userSettingsUserWantsDailyReminder=this.tempUserWantsDailyReminder,this.userSettingsUseExtraCard=this.tempUseExtraCard,this.userSettingsHideStats=this.tempUserSettingsHideStats,this.userSettingsNoSnark=this.tempUserSettingsNoSnark,this.ToggleUseSimplifedTheme(this.tempUserSettingsUsesSimplifiedTheme),this.ToggleShowAllCards(this.tempUserSettingsShowAllCards),this.ToggleUnaidedReview(this.tempUserSettingsHideReviewAids),this.userSettingsUseMultiColoredGems=this.tempUseMultiColoredGems,this.appDataPlayerCurrent.role==="creator"&&(this.currentGameGuessingCardCount=this.userSettingsUseExtraCard?5:4),this.ToggleUseLightTheme(this.tempUserSettingsUsesLightTheme),this.userSettingsHueIndex=this.tempUserSettingsHueIndex,this.SetWordSetTheme(this.currentGameGuessingWordSet),await r.SaveData("userID",this.appDataPlayerCurrent.id),await r.SaveData("useWordSetThemes",this.userSettingsUseWordSetThemes),await r.SaveData("userSettingsUserWantsDailyReminder",this.userSettingsUserWantsDailyReminder),await r.SaveData("userSettingsLanguage",this.userSettingsLanguage),await r.SaveData("userSettingsUsesLightTheme",this.userSettingsUsesLightTheme),await r.SaveData("userSettingsHueIndex",this.userSettingsHueIndex),await r.SaveData("userSettingsUsesSimplifiedTheme",this.userSettingsUsesSimplifiedTheme),await r.SaveData("userSettingsShowAllCards",this.userSettingsShowAllCards),await r.SaveData("userSettingsHideReviewAids",this.userSettingsHideReviewAids),await r.SaveData("useMultiColoredGems",this.userSettingsUseMultiColoredGems),await r.SaveData("useExtraCard",this.userSettingsUseExtraCard),await r.SaveData("userSettingsHideStats",this.userSettingsHideStats),await r.SaveData("userSettingsNoSnark",this.userSettingsNoSnark),await r.SaveData("wordSet",this.currentGameWordSet.id),t&&(localStorage.removeItem("dailyGames"),await this.GetDailyGameStats(),window.location.reload()),this.appStateIsModalShowing=!1,this.appStateShowSettings=!1,this.appStateShowIntro=!1,this.isAuthenticated&&this.userToken&&this.playerId&&this.SaveUserDataToCloud().catch(a=>{error("Background cloud sync failed after SubmitSettings: "+a)})},async GetUserSettings(){if(note("GetUserSettings()"),localStorage.getItem("userID")!==null){note("Migrating user settings from localStorage to IndexedDB");const g=["wordSet","appStateFirstRunCreatingIndex","appStateFirstRunGuessingIndex","appStateFirstRunReviewingIndex","dailyGames","name","useExtraCard","useMultiColoredGems","userHasSeenFirstTimeCreatingTutorial","userID","userSettingsHideStats","userSettingsLanguage","userSettingsShowAllCards","userSettingsUserWantsDailyReminder","userSettingsUsesLightTheme","userSettingsUsesSimplifiedTheme","useWordSetThemes"];for(const R of g){let P=localStorage.getItem(R);P!==null&&(await r.SaveData(R,P),localStorage.removeItem(R))}note("Migration complete. LocalStorage data transferred to IndexedDB.")}let t=await r.GetData("appStateFirstRunGuessingIndex");t?this.appStateFirstRunGuessingIndex=parseInt(t):this.appStateFirstRunGuessingIndex=-1;let a=await r.GetData("appStateFirstRunCreatingIndex");a?this.appStateFirstRunCreatingIndex=parseInt(a):this.appStateFirstRunCreatingIndex=this.isPlayerGuessing?-1:0;let s=await r.GetData("appStateFirstRunReviewingIndex");s?this.appStateFirstRunReviewingIndex=parseInt(s):this.appStateFirstRunReviewingIndex=this.isPlayerReviewing?-1:0,this.AdvanceFirstRunIndexes();let i=await r.GetData("userID");i!=null?(i=JSON.parse(i),this.appDataPlayerCurrent.id=i):(this.appDataPlayerCurrent.id=await this.GetAvailableFacetsPlayerId(),await r.SaveData("userID",this.appDataPlayerCurrent.id),this.appStateShowOOBE=window.location.search!==""),this.tempID=parseInt(this.appDataPlayerCurrent.id);let n=await r.GetData("dailyGames");n!=null&&(this.appDataUserDailyGamesStarted=JSON.parse(n));let o=await r.GetData("hasPlayedAsBTGAccountBefore");o!=null&&(this.hasPlayedAsBTGAccountBefore=JSON.parse(o),note(`Loaded hasPlayedAsBTGAccountBefore: ${this.hasPlayedAsBTGAccountBefore}`));let l=await r.GetData("name");l!=null?this.appDataPlayerCurrent.name=l:(this.appStateIsModalShowing=!0,this.appStateShowIntro=!0,setTimeout(()=>{document.getElementById("nameInput").focus()},410)),this.appDataWordSets.forEach(g=>{g.isSelected=!1});let h=await r.GetData("wordSet");h!=null&&this.appDataWordSets.find(g=>g.id===h)?this.currentGameWordSet=this.appDataWordSets.find(g=>g.id===h):this.currentGameWordSet=r.wordSets.find(g=>g.id==="100"),this.currentGameWordSet.isSelected=!0;let d=await r.GetData("userSettingsLanguage");d!=null&&(this.userSettingsLanguage=d,this.tempUserSettingsLanguage=this.userSettingsLanguage);let p=await r.GetData("useWordSetThemes");p!=null&&(this.userSettingsUseWordSetThemes=JSON.parse(p),this.tempUseWordSetThemes=this.userSettingsUseWordSetThemes,this.SetWordSetTheme(this.currentGameWordSet));let c=await r.GetData("userSettingsUserWantsDailyReminder");c!=null&&(this.userSettingsUserWantsDailyReminder=JSON.parse(c),this.tempUserWantsDailyReminder=this.userSettingsUserWantsDailyReminder),this.appStateIsGuessing?this.documentCssRoot.style.setProperty("--wordScale",this.currentGameGuessingWordSet.scale):this.documentCssRoot.style.setProperty("--wordScale",this.currentGameWordSet.scale);let u=await r.GetData("useExtraCard");u!=null&&(this.userSettingsUseExtraCard=JSON.parse(u),this.tempUseExtraCard=this.userSettingsUseExtraCard);let f=await r.GetData("userSettingsHideStats");f!=null&&(this.userSettingsHideStats=JSON.parse(f),this.tempUserSettingsHideStats=this.userSettingsHideStats);let w=await r.GetData("userSettingsNoSnark");w!=null&&(this.userSettingsNoSnark=JSON.parse(w),this.tempUserSettingsNoSnark=this.userSettingsNoSnark);let C=await r.GetData("userSettingsUsesLightTheme");C!=null&&(this.ToggleUseLightTheme(JSON.parse(C)),this.tempUserSettingsUsesLightTheme=this.userSettingsUsesLightTheme);let m=await r.GetData("userSettingsHueIndex");m==null&&(m=0),this.tempUserSettingsHueIndex=this.userSettingsHueIndex=m;let y=await r.GetData("userSettingsUsesSimplifiedTheme");y!=null&&(this.ToggleUseSimplifedTheme(JSON.parse(y)),this.tempUserSettingsUsesSimplifiedTheme=this.userSettingsUsesSimplifiedTheme);let D=await r.GetData("userSettingsShowAllCards");D!=null&&(this.ToggleShowAllCards(JSON.parse(D)),this.tempUserSettingsShowAllCards=this.userSettingsShowAllCards);let G=await r.GetData("userSettingsHideReviewAids");G!=null&&(this.ToggleUnaidedReview(JSON.parse(G)),this.tempUserSettingsHideReviewAids=this.userSettingsHideReviewAids);let T=await r.GetData("useMultiColoredGems");T!=null&&(this.userSettingsUseMultiColoredGems=JSON.parse(T),this.tempUseMultiColoredGems=this.userSettingsUseMultiColoredGems);let I=await r.GetData("userHasSeenFirstTimeCreatingTutorial");I!=null&&note("User has seen first time creating tutorial: "+I)},HandleKeyDownEvent(e){if(!e.metaKey&&!e.ctrlKey&&!e.altKey)switch(note(e.key),e.key){case"Enter":note("HandleKeyDownEvent()"),e.preventDefault(),this.appStateAutoAdvanceTips&&this.AdvanceFirstRunIndexes(),!this.appStateShowSettings&&!this.appStateShowTutorial&&!this.appStateShowIntro&&!this.appStateShowInfo&&!this.appStateShowConfirmation&&!this.appStateIsGuessing&&this.numberOfHintsThatHaveBeenFilled===4&&this.FillParkingLot(),this.appStateShowIntro?this.HandleIntroButtonClick(null):this.appStateShowSettings?this.SubmitSettings(e):this.appStateShowTutorial?(this.appStateShowOOBE=!1,this.ToggleShowTutorial(null)):this.appStateShowConfirmation?this.HandleYesNo(this.appDataConfirmationObject.target,!0):this.appStateShowInfo?this.appStateShowInfo=!1:this.appStateShowGlobalCreated?this.appStateShowGlobalCreated=!1:this.appStateShowCatChooser&&this.HandleGoButtonClick(e);break;case"Tab":note("HandleKeyDownEvent()"),e.preventDefault(),this.appStateTrayIsRotating||this.RotateTray(e.shiftKey?1:-1);break;case":":case"=":note("HandleKeyDownEvent()"),e.preventDefault(),e.stopPropagation();break;case"Escape":this.appStateShowOOBE=!1,this.appStateShowSettings?this.CancelSettings(null):this.appStateShowDailyGames?this.ToggleShowDailyGames(null):this.appStateShowTutorial?this.ToggleShowTutorial(null):this.appStateShowCatChooser?this.appStateShowCatChooser=!1:this.appStateShowConfirmation?this.HandleYesNo(this.appDataConfirmationObject.target,!1):this.appStateShowInfo?this.appStateShowInfo=!1:this.appStateShowGlobalCreated?this.appStateShowGlobalCreated=!1:this.appStateShowNotification?this.appStateShowNotification=!1:this.appStateShowMeta?this.appStateShowMeta=!1:this.appStateShowMeta||(this.appStateShowMeta=!0);break;case"\\":this.tempUserSettingsUsesLightTheme=!this.tempUserSettingsUsesLightTheme,this.SubmitSettings(null);break;case"/":this.tempUseWordSetThemes=!this.tempUseWordSetThemes,this.SubmitSettings(null);break}if(e.shiftKey)switch(e.key){case"ArrowRight":this.tempUserSettingsHueIndex=this.tempUserSettingsHueIndex===this.appDataHues.length-1?0:this.tempUserSettingsHueIndex+1,this.SubmitSettings(null);break;case"ArrowLeft":this.tempUserSettingsHueIndex=this.tempUserSettingsHueIndex===0?this.appDataHues.length-1:this.tempUserSettingsHueIndex-1,this.SubmitSettings(null);break}e.ctrlKey&&e.key==="r"&&!e.metaKey&&this.ResetFirstRun()},HandleResize(){this.appStateUsePortraitLayout=document.body.offsetWidth/document.body.offsetHeight<.75},HandlePopState(){note("HandlePopState()"),window.location.search?this.LoadPage():this.NewGame(null)},UpdatePointerTargetLocation(){note("UpdatePointerTargetLocation()");const e=document.getElementsByTagName("pointer")[0];let t=-4e4,a=-4e4,s=!0,i=-4e4,n=-4e4,o=0;if(e){const l=e.getBoundingClientRect(),h=10,d=document.getElementsByClassName("pointout")[0];if(d){const p=d.getBoundingClientRect();a=p.top+window.scrollY-l.height-h-10,s=a>=20,o=s?o:180,a=s?a:p.top+p.height+10,t=p.left+window.scrollX,n=s?a+l.height+1:a-10,i=s?p.left-1+p.width/2-18:p.left+p.width/2-19,t>window.innerWidth-l.width+20?t=window.innerWidth-l.width-20:t=t,a=a,s?i>t+l.width-44&&(i=t+l.width-36):i>t+l.width-44&&(i=t+l.width-44)}else t=window.innerWidth/2-l.width/2,a=window.innerHeight/2-l.height/2-40}this.appStatePointerLocation={left:t,top:a},this.appStatePointerArrowLocation={x:i,y:n,rotate:o}},ShareWin(e,t=this.currentDaily){if(e!==null&&(e.stopPropagation(),e.preventDefault()),note("ShareWin()"),t.solved){let a=t&&this.todaysDaily===t?"Today's":`The ${t.date}`,s=`I solved ${a} Daily Facet in ${t.guesses} tries! ðŸ˜€
Can you do better?

<https://facets.bigtentgames.com>`;this.ConstructAndSetShareURLForCurrentGame(),t.guesses===1&&(s=`ðŸ¥³ I solved ${a} Daily Facet in 1 try! Can you?

<https://facets.bigtentgames.com>`),t.quit&&(s=`ðŸ˜± I gave up on ${a} Daily Facet! Can you solve it?

<https://facets.bigtentgames.com>`),this.ShareText(s,""),history.pushState(null,null,window.location.origin+window.location.pathname)}},async CopyTextToClipboard(e,t=!0){const a=String(e);if(this.isIOS){const s=this.CopyToClipboardViaExecCommand(a);highlight("iOS or iPadOS copy was "+(s?"successful":"unsuccessful")),s?(this.appDataMessage=`"${a.replace(/\n/g,"<br />")}" copied to the clipboard.`,this.appStateShowNotification=t):(this.appDataMessage="Unable to copy to clipboard on this device.",this.appStateShowNotification=t);return}if(navigator.clipboard)if(window.ClipboardItem)try{await navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([a],{type:"text/plain"})})]),note("Attempting to copy via navigator.clipboard.write");let s=a.replace(/<((https?:\/\/)[^>]+)>/gi,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');s=s.replace(/(^|\s)(https?:\/\/[^\s<]+)/gi,'$1<a href="$2" target="_blank" rel="noopener noreferrer">$2</a>'),this.appDataMessage=`<sharetext>"${s}"</sharetext><br /><br >
Message copied to the clipboard.`,a===this.appDataHints[0].value&&(this.appDataMessage=`"${s}" copied to the clipboard.`),this.appStateShowNotification=t}catch(s){error(s),this.CopyToClipboardViaExecCommand(a)}else try{await navigator.clipboard.writeText(a),note("Attempting to copy via navigator.clipboard.writeText");let s=a.replace(/<((https?:\/\/)[^>]+)>/gi,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');s=s.replace(/(^|\s)(https?:\/\/[^\s<]+)/gi,'$1<a href="$2" target="_blank" rel="noopener noreferrer">$2</a>'),this.appDataMessage=`<sharetext>"${s}"</sharetext><br /><br >
Message copied to the clipboard.`,this.appStateShowNotification=!0}catch(s){error(s),this.CopyToClipboardViaExecCommand(a)}else this.CopyToClipboardViaExecCommand(a)},CopyToClipboardViaExecCommand(e){note("CopyToClipboardViaExecCommand()");const t=document.createElement("input");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="2em",t.style.height="2em",t.style.padding="0",t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",document.body.appendChild(t),t.focus(),t.setSelectionRange(0,99999);let a=!1;try{a=document.execCommand("copy")}catch{a=!1}return document.body.removeChild(t),a},async ShareText(e,t){if(note("ShareText()"),!this.isAIGenerating){this.appDataMessage="";let a=t===""?"":"<"+t+">",s={text:`${e}
${a}`};const i=navigator.userAgent,n=i.includes("Windows"),o=i.includes("Edg/");if(n||o){this.CopyTextToClipboard(`${e}
${a}`);return}navigator.canShare&&!navigator.canShare(s)&&(a=t===""?window.location.origin:t,s={text:e,url:a}),navigator.share&&navigator.canShare(s)?await navigator.share(s).then(l=>{note("Message shared via navigator.share()")}).catch(l=>{this.CopyTextToClipboard(`${e}
${a}`),error("Failed to share via navigator.share(): ",l)}):this.CopyTextToClipboard(`${e}
${a}`)}},async ShareBoard(e=!1,t=!1){if(note("ShareBoard()"),!this.isAIGenerating&&this.isChromeAndiOSoriPadOS&&this.appDataShareURL.indexOf("facets.bigtentgames.com/game/?")!==-1)this.CopyTextToClipboard(this.GetShareTextBasedOnContext(e)+" <"+this.appDataShareURL+">"),note("Shortened URL exists, copying to clipboard");else{let i=this.appDataPlayerCurrent.role==="reviewer"&&this.numberOfCardsThatHaveBeenPlacedOnTray===4,n=this.GetShareTextBasedOnContext(e);this.ConstructAndSetShareURLForCurrentGame(i,t),this.appStateIsGettingTinyURL=!0;var a=this.isAIGenerating?"https://facets-save-ai-game.bigtentgames.workers.dev/":"https://facets-shorturl-api.bigtentgames.workers.dev/",s=a+location.search.substring(1);note("Fetching short url"),await fetch(s,{method:"GET",headers:{Host:window.location.hostname,Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type"}}).then(o=>o.ok?o.text():o.text().then(l=>{const h=JSON.parse(l);error("("+h.statusCode+") "+h.message)})).then(o=>{this.appDataShareURL=location.origin+"/game/?"+o,this.ShareText(n,this.appDataShareURL)}).catch(o=>{error(o),UseDebug||(this.appStateShareError=!0)}).finally(()=>{this.appStateIsGettingTinyURL=!1}),UseDebug&&this.ShareText(n,this.appDataShareURL)}},ReportPuzzle(e,t){e.preventDefault(),e.stopPropagation(),note("ReportPuzzle()"),location.href="mailto:bigtentgames@icloud.com?subject=Facets Puzzle Reported&body=Puzzle ID# "+t.key+"%0D%0A This puzzle contains offensive language.%0D%0A"+t.hints},ConstructAndSetShareURLForCurrentGame(e,t=!1){if(note("ConstructAndSetShareURLForCurrentGame()"),this.appStateIsGuessing){this.currentGameSolutionGuessing!==this.currentGameSolutionActual&&(this.currentGameSolutionGuessing="");let a="",s="";this.appDataCards.concat(this.appDataCardsParked).forEach(i=>{i.words.length===0&&(s+="::::"),i.words.forEach(n=>{s+=n.id+":"})}),this.appDataHints.forEach((i,n)=>{i.value=i.value.trim();let o=encodeURIComponent(i.value);s+=o+(n===this.appDataHints.length-1?"":":")}),a=encodeURIComponent(a),a+="?sendingName="+encodeURIComponent(this.appDataPlayerCurrent.name),a+="&generated="+encodeURIComponent(this.currentDaily?!0:this.isAIGenerating),this.currentDaily&&(a+="&key="+encodeURIComponent(this.currentDaily.key),this.currentDaily.quit&&(a+="&quit=true")),a+="&puzzleName="+encodeURIComponent(this.appDataPlayerCreator.name),a+="&puzzleID="+encodeURIComponent(this.appDataPlayerCreator.id),a+="&lang="+encodeURIComponent(t===!1?this.currentGameLanguage:this.userSettingsLanguage),a+="&wordSetID="+encodeURIComponent(this.currentGameGuessingWordSet.id),t&&(a+="&isNew=true"),a+="&sendingID="+encodeURIComponent(this.appDataPlayerCurrent.id),a+="&useExtraCard="+encodeURIComponent(this.currentGameGuessingCardCount===5),a+="&sol="+encodeURIComponent(this.currentGameSolutionActual),a+="&wg=";for(let i=0;i<this.appDataCardsParked.length;i++){let n=this.appDataCardsParked[i],o=[];a+=i>0?"+":"",o.push(n.wrongGuesses[0].join(",")),o.push(n.wrongGuesses[1].join(",")),o.push(n.wrongGuesses[2].join(",")),o.push(n.wrongGuesses[3].join(",")),a+=o.join(":")}for(let i=0;i<this.appDataCards.length;i++){let n=this.appDataCards[i],o=[];a+="+",o.push(n.wrongGuesses[0].join(",")),o.push(n.wrongGuesses[1].join(",")),o.push(n.wrongGuesses[2].join(",")),o.push(n.wrongGuesses[3].join(",")),a+=o.join(":")}e&&(a+="&final=true"),a=window.location.origin+window.location.pathname+a+"&board="+s,this.appDataShareURL=a,history.pushState(null,null,this.appDataShareURL)}},GetMessageBasedOnTrayCount(e,t){note("GetMessageBasedOnTrayCount()");let a=this.numberOfCardsThatHaveBeenPlacedOnTray,s="";this.numberOfCardsThatHaveBeenPlacedOnTray<4&&(s=a+"/4 "),a===4&&this.appDataPlayerCurrent.role==="reviewer"&&!e&&(a=5);let i=r.levelMessage[a][getRandomInt(0,r.levelMessage[a].length)],n=t!=="",o=n?t+", ":"";i=n&&i.indexOf("I ")!==0?i.charAt(0).toLowerCase()+i.slice(1):i;let h=r.levelEmoji[a][getRandomInt(0,r.levelEmoji[a].length)]+" ";if(this.userSettingsNoSnark)switch(a){case 0:case 1:case 2:case 3:h="ðŸ¤ª",i="you've got this!";break;case 5:h="ðŸ›‘",i="here's the solution.";break}let d=s+h+" "+o+i;return a===4&&this.currentDaily&&this.currentDaily.quit&&(d=`AI is hard! 
We're working hard to make these Daily Facets better to play.`),d},GetShareTextBasedOnContext(e){note("GetShareTextBasedOnContext()");let t="",a=this.currentGameGuessingWordSet.startsWithVowel?"an ":"a ";if(a=this.currentGameGuessingCardCount===5?"a ":a,this.appDataPlayerCurrent.id===this.appDataPlayerSender.id&&this.appDataPlayerCurrent.id===this.appDataPlayerCreator.id){let s=this.currentGameGuessingCardCount===5?" â­ï¸":"";this.currentGameGuessingCardCount,t=`ðŸ§ ${this.currentGameGuessingWordSet.emoji}${s} ${this.GetSolutionWords()}
I created this word puzzle!`}else this.appDataPlayerCurrent.role==="reviewer"?t=`${this.GetMessageBasedOnTrayCount(e,this.currentGameGuessersName)}
${this.GetSolutionWords()}`:t=`ðŸ¤” ${this.appDataPlayerCreator.name}, here's my guess!
${this.GetSolutionWords()}`;return t},GetSolutionWords(){note("GetSolutionWords()");let e=this.currentGameSolutionActual.split(":");return`(${e[0]} â€¢ ${e[3]} â€¢ ${e[6]} â€¢ ${e[9]})`},SwapCards(e,t){note("SwapCards()");let a=new r.CardObject(e),s=new r.CardObject(t);e.words=s.words,e.rotation=s.rotation,e.isSelected=!1,e.justDropped=!0,e.wrongGuesses=s.wrongGuesses,t.words=a.words,t.rotation=a.rotation,t.isSelected=!1,t.justDropped=!0,t.wrongGuesses=a.wrongGuesses,setTimeout(()=>{this.appDataCards.concat(this.appDataCardsParked).forEach(i=>{i.justDropped=!1})},this.appDataTransitionLong),this.appStateIsDragging=!1,this.appDataDraggedCard=this.appDataEmptyCard,this.ConstructAndSetShareURLForCurrentGame()},HandleCardClick(e,t){e.preventDefault(),e.stopPropagation(),this.ToggleCardSelection(t)},ToggleCardSelection(e){if(this.appStateIsGuessing&&this.currentGameSolutionGuessing===this.currentGameSolutionActual)return;if(note("ToggleCardSelection()"),this.selectedCard&&this.selectedCard!==e){this.SwapCards(this.selectedCard,e);return}let t=!e.isSelected;this.appDataCards.forEach(a=>{a.isSelected=!1,a.isInTray=!0,a.justDropped=!1}),this.appDataCardsParked.forEach(a=>{a.isSelected=!1,a.isInTray=!1,a.justDropped=!1}),e.isSelected=e.words.length===0?!1:t,document.body.offsetHeight<=660&&!this.appStateIsModalShowing&&(this.appStateIsModalShowing=!0),e.isSelected&&(this.appDataDraggedCard=e)},RotateCard(e,t,a){note("RotateCard()"),e.preventDefault(),e.stopPropagation(),this.appDataTransitionShort=parseInt(getComputedStyle(document.body).getPropertyValue("--mediumTransition").replace("ms","")),this.appStateIsGuessing&&(!this.vsUseFocus||this.vsUseFocus&&e.target.parentElement.parentElement.id!=="parking")&&(this.appDataMessage="",this.appDataTimeoutCardRotation&&(clearTimeout(this.appDataTimeoutCardRotation),this.appDataTimeoutCardRotation=null),t.isSelected=!1,t.rotation=t.rotation+a,t.isRotating=!0,this.appDataTimeoutCardRotation=setTimeout(()=>{this.ResetCardsAfterRotation()},this.appDataTransitionShort))},ResetCardsAfterRotation(e=!0){note("ResetCardsAfterRotation()"),this.appDataCards.concat(this.appDataCardsParked).forEach(t=>{if(t.rotation!==0){t.isRotating=!1;let a=t.words.length;if(a>0){let s=(t.rotation%a+a)%a;t.words=t.words.slice(-s).concat(t.words.slice(0,-s))}t.rotation=0}}),this.appStateIsGuessing&&e&&(this.ConstructAndSetShareURLForCurrentGame(),this.CheckIfAnyCardsGuesssAlreadyTried())},RotateTrayBasedOnInputFocus(e,t=!0){if(note("RotateTrayBasedOnInputFocus()"),e!=0)switch(e){case 0:this.RotateTray(0,t);break;case 1:this.RotateTray(-1,t);break;case 2:this.RotateTray(1,t);break;case 3:this.RotateTray(-2,t);break}},RotateTray(e,t=!0){if(note("RotateTray()"),!this.appStateTrayIsRotating){if(this.appDataMessage="",this.appStateTrayIsRotating=!0,this.appDataTimeoutTrayRotation&&(clearTimeout(this.appDataTimeoutTrayRotation),this.appDataTimeoutTrayRotation=null),this.selectedCard&&(this.selectedCard.isSelected=!1),this.appStateTrayRotation=this.appStateTrayRotation+e,document.getElementById("parkingInput").focus(),t&&!this.appStateSolving)this.appDataTimeoutTrayRotation=setTimeout(()=>{this.ResetTrayAfterRotation()},this.appDataTransitionLong),this.appStateIsGuessing||setTimeout(()=>{let a=document.getElementById("hint0");this.appDataParkingInputValue="",a.focus()},this.appDataTransitionLong);else if(this.ResetTrayAfterRotation(),!this.appStateIsGuessing){let a=document.getElementById("hint0");this.appDataParkingInputValue="",a.focus()}}},ResetTrayAfterRotation(){if(note("ResetTrayAfterRotation()"),this.appStateTrayIsRotating=!1,this.appDataParkingInputValue="",this.appStateTrayRotation<3){if(this.appStateTrayRotation!==0){let h=this.appDataHints.length;if(h>0){let d=(this.appStateTrayRotation%h+h)%h;this.appDataHints=this.appDataHints.slice(-d).concat(this.appDataHints.slice(0,-d))}}let e=this.appDataHints[0],t=this.appDataHints[1],a=this.appDataHints[2],s=this.appDataHints[3],i=this.appDataCards[0],n=this.appDataCards[1],o=this.appDataCards[2],l=this.appDataCards[3];switch(i.rotation=n.rotation=o.rotation=l.rotation=this.appStateTrayRotation,this.ResetCardsAfterRotation(!1),this.appStateTrayRotation){case-1:this.appDataHints[0]=e,this.appDataHints[1]=a,this.appDataHints[2]=s,this.appDataHints[3]=t,this.appDataCards[0]=n,this.appDataCards[2]=i,this.appDataCards[1]=l,this.appDataCards[3]=o;break;case 1:this.appDataHints[0]=s,this.appDataHints[1]=t,this.appDataHints[2]=e,this.appDataHints[3]=a,this.appDataCards[0]=o,this.appDataCards[1]=i,this.appDataCards[2]=l,this.appDataCards[3]=n;break;case 2:case-2:this.appDataHints[0]=t,this.appDataHints[1]=e,this.appDataHints[2]=s,this.appDataHints[3]=a,this.appDataCards[0]=l,this.appDataCards[1]=o,this.appDataCards[2]=n,this.appDataCards[3]=i;break}this.ConstructAndSetShareURLForCurrentGame(),this.CheckIfAnyCardsGuesssAlreadyTried()}this.appStateTrayRotation=0,document.getElementById("hint0").focus()},GetScrollSize(){const e=document.getElementById("parking");return e.scrollWidth-e.clientWidth},ConvertToDateFromKey(e){let t=e.substring(2,4),a=e.substring(4,8),s=e.substring(0,2)-1;return new Date(a,s,t)},GetDateFormatted(e,t=!1){const a=t?0:1;let s=String(e.getDate()).padStart(2,"0"),i=String(e.getMonth()+a).padStart(2,"0"),n=e.getFullYear(),o=i+s+n;if(t){let l=new Date(n,i,s),h={month:"short",day:"numeric"};o=new Intl.DateTimeFormat(void 0,h).format(l)}return o},GetIsAIGenerated(){if(this.currentDaily)return!0;if(window.location.search){let e=new URLSearchParams(window.location.search);return e.has("generated")&&e.get("generated").toString()==="true"}else return!1},GetBoardFromURL(){let e=[];if(window.location.search){let t=new URLSearchParams(window.location.search);UseDebug=t.has("useDebug")?!0:UseDebug,e=t.has("board")?t.get("board").split(":"):[]}return e},GetTodaysDaily(){let e=new Date;return this.dailyGamesWithWordSetNames.find(a=>a.key===this.GetDateFormatted(e))},async NewGame(e,t="",a=!0){note("NewGame()"),document.title="Facets!",this.appDataMessage=t,this.currentGameGuessCount=0,this.appCurrentDailyGameKey=-1,this.currentGameLanguage="",this.currentGameReviewIsFinal=!1,this.currentGameGuessersName="",this.appDataPlayerCurrent.role="creator",this.appDataPlayerCreator.id=this.appDataPlayerCurrent.id,this.appDataPlayerCreator.name=this.appDataPlayerCurrent.name,this.appDataPlayerSender.id=this.appDataPlayerCurrent.id,this.appDataPlayerSender.name=this.appDataPlayerCurrent.name,this.currentGameGuessingWordSet=this.currentGameWordSet,this.currentGameGuessingCardCount=this.userSettingsUseExtraCard?5:4,this.currentGameSolutionGuessing="",this.appStateTrayIsRotating=!1,this.appStateForceAutoCheck=!1,this.appStateShowMeta=!1,this.SetWordSetTheme(this.currentGameWordSet),this.appDataShareURL="",history.pushState(null,null,window.location.origin+window.location.pathname),this.appStateIsGuessing=!1,this.appDataCards=[],this.appDataCardsParked=[new r.CardObject({}),new r.CardObject({}),new r.CardObject({}),new r.CardObject({}),new r.CardObject({}),new r.CardObject({})],this.appDataHints=[new r.WordObject({}),new r.WordObject({}),new r.WordObject({}),new r.WordObject({})],await this.CreateCardsForPlayer(null),a&&this.RotateTray(-4)},async OverRideAllCardWords(e){if(e.length===16){this.tempWordSetName="All Words",await this.SubmitSettings(null);let t=await this.GetCurrentGameWordSet(),a=0;if(this.appDataPlayerCurrent.role==="creator")for(let s=0;s<this.appDataCards.length;s++){const i=this.appDataCards[s];for(let n=0;n<i.words.length;n++){let o=t.filter(l=>l.id===parseInt(e[a]))[0];a=a+1,i.words[n]=o}}}},async OnMount(){this.$nextTick(async()=>{try{const e=await r.GetData("btgProfile");e&&(note("Restoring BTG profile from IndexedDB: "+JSON.stringify(e)),this.userEmail=e.email||"",this.playerName=e.playerName||"Player",this.playerId=e.playerId||"")}catch(e){error("Error loading BTG profile from IndexedDB: "+e)}try{note("Checking BTG authentication on startup...");const e=await this.CheckBTGAuthStatus();await this.GetUserSettings()}catch(e){error("Error during startup authentication/settings loading: "+e);try{await this.GetUserSettings()}catch(t){error("Critical error loading user settings: "+t)}}this.LoadPage(),this.SetupPeriodicAuthCheck()})},async LoadPage(){note("LoadPage()"),this.HandleOnlineStatusChange(),note(`Player ${this.appDataPlayerCurrent.id} has loaded version ${this.appDataVersion}`),this.GetDailyGames(),this.GetRecentAnonymousGames(),this.appDataTransitionLong=parseInt(getComputedStyle(document.body).getPropertyValue("--longTransition").replace("ms","")),this.appDataTransitionShort=parseInt(getComputedStyle(document.body).getPropertyValue("--shortTransition").replace("ms",""));let e=this.GetBoardFromURL();try{e.length>=40?(document.title="Facets!",this.ToggleShowMeta(null),await this.RestoreGame(e)):this.appStateIsGuessing||(this.isAIGenerating&&(this.currentGameGuessingCardCount=4,this.appDataPlayerCurrent.id=0,this.currentGameWordSet=this.enabledWordSets.find(t=>t.id==="100"),note(this.currentGameWordSet.name),this.SelectWordSet(null,this.currentGameWordSet),note(this.currentGameWordSet.name),setTimeout(()=>{this.GetAISolution()},2e3)),this.appDataCards.length===0&&this.appDataCardsParked.length===0&&(this.NewGame(null,"",!1),this.ToggleShowMeta(null)))}catch(t){error(t.message),e=[],this.NewGame(null,"ðŸ˜• - Something went wrong.",!1),this.ToggleShowMeta(null)}finally{}setTimeout(()=>{this.appStatePageHasLoaded=!0},400),this.appStateUsePortraitLayout=document.body.offsetHeight>document.body.offsetWidth},DeregisterServiceWorkers(){"serviceWorker"in navigator?navigator.serviceWorker.getRegistrations().then(function(e){for(let t of e)t.unregister()}).catch(function(e){console.error("Error deregistering service workers:",e)}):console.log("Service workers are not supported in this browser.")},RegisterServiceWorker(){b({onRegistered:e=>{e&&(note("checking for service worker update"),e.update())},onNeedRefresh:()=>{this.appStatePWAHasUpdate=!0,this.appStateShowUpdateButton=!0,this.updateButtonTimeout&&clearTimeout(this.updateButtonTimeout),this.updateButtonTimeout=setTimeout(()=>{this.appStateShowUpdateButton=!1,this.updateButtonTimeout=null},5e3)},onOfflineReady:()=>{}})},async ActivatePWAUpdate(){if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistration();e&&e.waiting?(e.waiting.postMessage({type:"SKIP_WAITING"}),e.waiting.addEventListener("statechange",t=>{t.target.state==="activated"&&window.location.reload()})):window.location.reload()}},HandleOnlineStatusChange(){note("HandleOnlineStatusChange()"),this.isOnline=navigator.onLine},HandleWindowFocus(){note("HandleWindowFocus() - checking auth status on window focus"),this.isAuthenticated&&this.CheckBTGAuthStatus()},HandlePWAUpdate(){note("HandlePWAUpdate()"),this.appStatePWAHasUpdate=!1,this.appStateShowUpdateButton=!1,this.updateButtonTimeout&&(clearTimeout(this.updateButtonTimeout),this.updateButtonTimeout=null),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(e=>{e&&e.waiting?(e.waiting.postMessage({type:"SKIP_WAITING"}),e.waiting.addEventListener("statechange",t=>{t.target.state==="activated"&&window.location.reload()})):window.location.reload()})}},async mounted(){UseDebug=document.location.href.indexOf("local")!=-1||document.location.href.indexOf("debug=true")!=-1,await this.OnMount(),window.addEventListener("keydown",this.HandleKeyDownEvent),window.addEventListener("pointermove",this.HandlePointerMoveEvent),window.addEventListener("visibilitychange",this.HandlePageVisibilityChange),window.addEventListener("resize",this.HandleResize),window.addEventListener("popstate",this.HandlePopState),window.addEventListener("online",this.HandleOnlineStatusChange),window.addEventListener("offline",this.HandleOnlineStatusChange),window.addEventListener("focus",this.HandleWindowFocus),this.RegisterServiceWorker(),this.SetupFacetsChannel()},beforeDestroy(){window.removeEventListener("keydown",this.HandleKeyDownEvent),window.removeEventListener("pointermove",this.HandlePointerMoveEvent),window.removeEventListener("visibilitychange",this.HandlePageVisibilityChange),window.removeEventListener("resize",this.HandleResize),window.removeEventListener("popstate",this.HandlePopState),window.removeEventListener("online",this.HandleOnlineStatusChange),window.removeEventListener("offline",this.HandleOnlineStatusChange),window.removeEventListener("focus",this.HandleWindowFocus),this.facetsChannel&&this.facetsChannel.close(),this.appStateBrowserSWCheckInterval&&clearInterval(this.appStateBrowserSWCheckInterval),this.updateButtonTimeout&&clearTimeout(this.updateButtonTimeout),this.authCheckInterval&&clearInterval(this.authCheckInterval)},watch:{tempWordSetName(e){let t=this.enabledTempWordSet.find(a=>a.name===e);this.SetWordSetTheme(t)},tempUseWordSetThemes(e){this.SetWordSetTheme(this.currentGameWordSet)},tempUserSettingsHueIndex(e){this.documentCssRoot.style.setProperty("--hueTheme",this.currentHueSet[e]),this.tempUserSettingsUsesLightTheme?document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 92%)":document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 3%)"},tempUserSettingsUsesLightTheme(e){this.documentCssRoot.style.setProperty("--hueTheme",this.currentHueSet[this.tempUserSettingsHueIndex]),e?document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 92%)":document.getElementById("themeColor").content="hsl("+this.appDataHues[this.tempUserSettingsHueIndex]+", 100%, 3%)"},userSettingsLanguage(){this.LoadTranslatedWords()},appStateFirstRunGuessingIndex:async function(e){e<=this.appDataGuessingFirstRunItems.length&&(await r.SaveData("appStateFirstRunGuessingIndex",e),setTimeout(()=>{requestAnimationFrame(()=>{this.UpdatePointerTargetLocation()})},100))},appStateFirstRunReviewingIndex:async function(e){e<=this.appDataReviewingFirstRunItems.length&&(await r.SaveData("appStateFirstRunReviewingIndex",e),setTimeout(()=>{requestAnimationFrame(()=>{this.UpdatePointerTargetLocation()})},100))},appStateFirstRunCreatingIndex:async function(e){e<=this.appDataCreatorFirstRunItems.length&&(await r.SaveData("appStateFirstRunCreatingIndex",e),setTimeout(()=>{requestAnimationFrame(()=>{this.UpdatePointerTargetLocation()})},100))},isAIGenerated(){return this.GetIsAIGenerated()},appStateIsGuessing(){this.appStateIsGuessing&&this.appStateFirstRunGuessingIndex===-1&&this.appStateFirstRunGuessingIndex++},pointerText(){requestAnimationFrame(()=>{this.UpdatePointerTargetLocation()})}},computed:{selectedCard(){return this.appDataCards.concat(this.appDataCardsParked).find(e=>e.isSelected===!0)},allPlayerCards(e){return this.appDataCards.concat(this.appDataCardsParked).find(t=>t.id.indexOf(e===0))},allCards(){let e=this.appDataCards.concat(this.appDataCardsParked).filter(t=>t.words.length>0);return e.forEach(t=>{t.id=this.GetUniqueCardId(t.words)}),e=e.sort((t,a)=>t.id-a.id),e},firstThreeParkedCards(){return this.appDataCardsParked.splice(0,3)},fullCardsInTray(){return this.appDataCards.filter(e=>e.words.length>0)},emptyCardsInTray(){return this.appDataCards.filter(e=>e.words.length===0)},numberOfCardsThatHaveBeenPlacedOnTray(){return this.appDataCards===void 0?0:this.fullCardsInTray.length},numberOfHintsThatHaveBeenFilled(){return this.appDataHints===void 0?0:this.appDataHints.filter(e=>e.value!="").length},uniqueCardId(e){return this.GetUniqueCardId(e)},firstAvailableParkingSpot(){return this.appDataCardsParked.find(e=>e.words.length===0)},playerMessage(){clearTimeout(this.appDataTimeoutNotification);let e=2200,t=this.currentGameGuessingWordSet.startsWithVowel?"an":"a",a=this.appStateForceAutoCheck?t:this.appDataPlayerCreator.name+"'s ",s="";return this.appDataMessage!==""?(s=this.appDataMessage,this.currentDaily&&this.currentDaily.solved&&(e=1e4)):!this.appStateIsGuessing&&this.appDataPlayerCurrent.id!==-1?(s=`You are creating a new "${this.currentGameGuessingWordSet.name}" puzzle!`,e=1700):this.appDataPlayerCurrent.id===this.appDataPlayerSender.id&&this.appDataPlayerCurrent.id!==-1&&this.appDataPlayerCurrent.id===this.appDataPlayerCreator.id?(s=`${this.appDataPlayerCurrent.name}, this is your own puzzle!`,e=1700):this.currentGameReviewIsFinal&&this.appDataPlayerCurrent.id!==-1?s=`${this.appDataPlayerCurrent.name}, here's the solution.`:this.appDataPlayerCurrent.id!==this.appDataPlayerSender.id&&this.appDataPlayerCurrent.id===this.appDataPlayerCreator.id&&this.appDataPlayerCurrent.id!==-1?(s=`You are reviewing ${this.appDataPlayerSender.name}'s guess!`,e=1700):this.currentDaily?(s=`<name>The Daily Facet â€“ ${this.currentDaily.date.split(",")[0]}</name><subtitle>Puzzle category â€“ "${this.currentGameGuessingWordSet.name}"</subtitle>`,this.currentDaily.key===this.todaysDaily.key&&(s=`The Daily Facet â€“ Today<subtitle>Puzzle category â€“  "${this.currentGameGuessingWordSet.name}"</subtitle>`)):s=`You are guessing ${a} "${this.currentGameGuessingWordSet.name}" puzzle!`,e!==2e4&&(this.appDataTimeoutNotification=setTimeout(()=>{this.appStateShowNotification=!1},e)),s},enabledWordSets(){return this.appDataWordSets.filter(e=>e.enabled)},enabledTempWordSets(){return this.tempWordSets.filter(e=>e.enabled)},enabledTempWordSetNames(){let e=[];return this.appDataWordSets.forEach(t=>{t.enabled&&e.push(t.name)}),e.sort((t,a)=>t.localeCompare(a,void 0,{sensitivity:"base"}))},enabledTempWordSet(){let e=[];return this.appDataWordSets.forEach(t=>{t.enabled&&e.push(t)}),e.sort((t,a)=>t.name.localeCompare(a.name,void 0,{sensitivity:"base"}))},enabledTempLanguages(){let e=[];return this.appDataLanguages.forEach(t=>{t.enabled&&e.push({name:t.name,tag:t.tag})}),e.sort((t,a)=>t.name.localeCompare(a.name,void 0,{sensitivity:"base"}))},currentSelectedTempWordSetName(){return this.appDataWordSets.find(e=>e.isSelected).name},submitButtonText(){let e=this.appDataActionButtonTexts.send;return this.appStateShareError?"Retry":(this.appDataPlayerCurrent.role==="reviewer"?e=this.appDataActionButtonTexts.respond:this.appDataPlayerCurrent.role==="creator"&&(e=this.appDataActionButtonTexts.send),this.appDataPlayerCurrent.id!==this.appDataPlayerCreator.id&&(this.appStateForceAutoCheck&&(this.currentDaily&&!this.currentDaily.solved&&this.currentDaily.guesses>1&&this.numberOfCardsThatHaveBeenPlacedOnTray!==4?e=this.appDataActionButtonTexts.quit:e=this.appDataActionButtonTexts.guess),this.isChromeAndiOSoriPadOS&&this.appDataShareURL.includes("facets.bigtentgames.com/game/?")&&(e=this.appDataActionButtonTexts.copy),this.currentGameSolutionGuessing===this.currentGameSolutionActual&&(this.currentDaily?e=this.appDataActionButtonTexts.share:e=this.appDataActionButtonTexts.create)),e)},createdGamesWithWordSetNames(){return this.appDataGlobalCreatedGames.map(e=>{const t=this.appDataWordSets.find(a=>a.id===e.wordSetID);return t?{...e,name:t.name}:e})},todaysKey(){let e=new Date;return this.GetDateFormatted(e)},todaysDaily(){return this.GetTodaysDaily()},currentDaily(){let e=this.dailyGamesWithWordSetNames.find(t=>t.key===this.appCurrentDailyGameKey);return e||null},dailyIsFreshToday(){if(this.todaysDaily===void 0)return!1;const e=this.todaysDaily.guesses===0&&!this.HasUserStartedGame(this.todaysDaily)&&!this.appStateIsGettingDailyGames&&!this.appStateIsGettingUserStats;return this.isBadgeSupported&&(e?navigator.setAppBadge():navigator.clearAppBadge()),e},dailyGamesWithWordSetNames(){return this.appDataDailyGames.map(e=>{e.date=this.GetDateFormatted(this.ConvertToDateFromKey(e.key),!0);const t=this.appDataWordSets.find(a=>a.id===e.wordSetID);return t&&(e.name=t.name),e})},isOldIOS(){const e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,t=!!(navigator.clipboard&&navigator.clipboard.writeText);return e&&!t},isChromeAndiOSoriPadOS(){note("isChromeAndiOSoriPadOS()");var e=navigator.userAgent||window.opera,t=/CriOS/.test(e)&&/iPhone|iPad|iPod/.test(e);return e=e.toLowerCase(),t||e.includes("firefox")&&e.includes("android")},isAIGenerating(){return window.location.href.indexOf(window.location.origin+"/generate.html")!==-1},isAIGenerated(){return this.GetIsAIGenerated()},actionButtonState(){let e=!1;return this.numberOfCardsThatHaveBeenPlacedOnTray!==4&&this.currentDaily&&this.currentDaily.guesses>1&&!this.currentDaily.quit?e=!1:(this.numberOfHintsThatHaveBeenFilled!==4&&this.appDataPlayerCurrent.role==="creator"||this.numberOfCardsThatHaveBeenPlacedOnTray!==4&&this.appDataPlayerCurrent.role!=="reviewer"&&this.appDataPlayerCurrent.id!==this.appDataPlayerCreator.id)&&(e=!0),e},correctCalIconClass(){let e=this.currentDaily.date,t=parseInt(e.split(" ")[1]);const a=new Date;let s=new Date(a.getFullYear(),a.getMonth()+1,0).getDate()/12;return`cal${Math.ceil(t/s)}`},resumeText(){let e="";switch(this.appDataPlayerCurrent.role){case"creator":e="Creating";break;case"reviewer":e="Reviewing";break;case"guesser":e="Guessing";break}return e},isSyncSupported(){return UseDebug?!0:"SyncManager"in window},isNotificationSupported(){return UseDebug?!0:"Notification"in window},isBadgeSupported(){return navigator.setAppBadge!==void 0&&navigator.setAppBadge!==null},isPWAOnHomeScreen(){return window.matchMedia("(display-mode: standalone)").matches},isUserFocusedOnGame(){return!this.appStateShowNotification&&!this.appStateIsModalShowing&&!this.appStateShowMeta&&!this.appStateShowTutorial&&!this.appStateShowConfirmation&&!this.appStateShowIntro&&!this.appStateShowInfo&&!this.appStateShowCatChooser&&!this.appStateShowSettings&&!this.appStateShowGlobalCreated&&!this.appStateShowDailyGames},isPlayerCreating(){return this.appDataPlayerCurrent.role==="creator"},isPlayerGuessing(){return this.appDataPlayerCurrent.role==="guesser"},isPlayerReviewing(){return this.appDataPlayerCurrent.role==="reviewer"},hidePointer(){return!this.isUserFocusedOnGame||this.isPlayerReviewing&&this.appStateFirstRunReviewingIndex>=this.appDataReviewingFirstRunItems.length||this.isPlayerCreating&&this.appStateFirstRunCreatingIndex>=this.appDataCreatorFirstRunItems.length||this.isPlayerGuessing&&this.appStateFirstRunGuessingIndex>=this.appDataGuessingFirstRunItems.length||!this.isPlayerCreating&&!this.isPlayerReviewing&&this.isSolved},pointerInPlay(){return this.appStateFirstRunGuessingIndex>0&&this.appStateFirstRunGuessingIndex<this.appDataGuessingFirstRunItems.length&&this.isPlayerGuessing||this.appStateFirstRunCreatingIndex>0&&this.appStateFirstRunCreatingIndex<this.appDataCreatorFirstRunItems.length&&this.isPlayerCreating||this.appStateFirstRunReviewingIndex>0&&this.appStateFirstRunReviewingIndex<this.appDataReviewingFirstRunItems.length&&this.isPlayerReviewing},isSolved(){return this.currentGameSolutionGuessing===this.currentGameSolutionActual},pointerText(){let e="",t=this.isAIGenerated||this.appDataPlayerCreator.id===0?1:0;switch(this.appDataPlayerCurrent.role){case"guesser":this.appDataGuessingFirstRunItems[this.appStateFirstRunGuessingIndex]&&(t=this.appDataGuessingFirstRunItems[this.appStateFirstRunGuessingIndex].length===1?0:t,e=this.appDataGuessingFirstRunItems[this.appStateFirstRunGuessingIndex][t],e=e.replace("hint1",this.appDataHints[0].value));break;case"creator":this.appDataCreatorFirstRunItems[this.appStateFirstRunCreatingIndex]&&(t=this.appDataCreatorFirstRunItems[this.appStateFirstRunCreatingIndex].length===1?0:t,e=this.appDataCreatorFirstRunItems[this.appStateFirstRunCreatingIndex][t],this.appDataCards.length>0&&this.appDataCards[0].words.length>0&&this.appDataCards[1].words.length>0&&(e=e.replace("word1",this.appDataCards[0].words[0].value),e=e.replace("word2",this.appDataCards[1].words[0].value)));break;case"reviewer":this.appDataReviewingFirstRunItems[this.appStateFirstRunReviewingIndex]&&(t=this.appDataReviewingFirstRunItems[this.appStateFirstRunReviewingIndex].length===1?0:t,e=this.appDataReviewingFirstRunItems[this.appStateFirstRunReviewingIndex][t]);break}return e},tipSubmitText(){let e="Next";return(this.isPlayerGuessing&&this.appStateFirstRunGuessingIndex===this.appDataGuessingFirstRunItems.length-1||this.isPlayerCreating&&this.appStateFirstRunCreatingIndex===this.appDataCreatorFirstRunItems.length-1||this.isPlayerReviewing&&this.appStateFirstRunReviewingIndex===this.appDataReviewingFirstRunItems.length-1)&&(e="Okay"),e},resumeText(){if(this.isPlayerCreating)return"Continue Creating";if(this.isPlayerGuessing)return"Resume Guessing";if(this.isPlayerReviewing)return"Resume Reviewing"},tipsHaveBeenIncremented(){return this.appStateFirstRunGuessingIndex>0||this.appStateFirstRunCreatingIndex>0||this.appStateFirstRunReviewingIndex>0},currentYear(){return new Date().getFullYear()},tempIDisInvalid(){return this.tempID.toString().length<8||this.tempID.toString().indexOf("0")===0},tooSmall(){return window.innerHeight<602},loadSimplifiedTheme(){return this.appStateUseFlower||this.userSettingsUsesSimplifiedTheme},currentHueSet(){return this.appDataHues},bottomParkingCards(){let e=[];for(let t=0;t<this.appDataCardsParked.length;t++)t<this.currentGameGuessingCardCount&&e.push(this.appDataCardsParked[t]);return e},leftParkingCards(){let e=[];for(let t=0;t<this.appDataCardsParked.length;t++)t<this.currentGameGuessingCardCount/2&&e.push(this.appDataCardsParked[t]);return e},rightParkingCards(){let e=[];for(let t=0;t<this.appDataCardsParked.length;t++)t>=this.currentGameGuessingCardCount/2&&t<this.currentGameGuessingCardCount&&e.push(this.appDataCardsParked[t]);return e},unaided(){return this.userSettingsHideReviewAids&&this.appDataPlayerCurrent.role==="reviewer"}}});S.config.compilerOptions.isCustomElement=e=>!0,window.app=S.mount("#app")});
